(function(){"use strict";function n(){$(function(){var n=window.jQuery,i=function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(t){var i="",o,s,h="",c,f,r,e="",u=0;/[^A-Za-z0-9\+\/\=]/g.exec(t)&&console.log('There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, "+", "/",and "="\nExpect errors in decoding.');t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do c=n.indexOf(t.charAt(u++)),f=n.indexOf(t.charAt(u++)),r=n.indexOf(t.charAt(u++)),e=n.indexOf(t.charAt(u++)),o=c<<2|f>>4,s=(f&15)<<4|r>>2,h=(r&3)<<6|e,i=i+String.fromCharCode(o),r!=64&&(i=i+String.fromCharCode(s)),e!=64&&(i=i+String.fromCharCode(h)),o=s=h="",c=f=r=e="";while(u<t.length);return unescape(i)};return{decode:t}}(),r=function(){var t=function(t,i,r,u){var f=window.epmLive;n.ajax({type:"POST",url:f.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: '"+t+"', Dataxml: '"+i+"' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var i=f.parseJson(n.d),t=i.Result;f.responseIsSuccess(t)?r(t):u(n)}else u(n)},error:function(n){u(n)}})};return{execute:t}}(),t=function(){function nt(){for(var t,n=0;n<f.length;n++)if(t=f[n],t.selected()){t.closeNav();break}}function y(t){var f=["s4-ribbonrow","s4-workspace"],e,i,r;for(e in f)i=n("#"+f[e]),i.removeClass("epm-nav-pinned"),i.removeClass("epm-nav-unpinned"),i.addClass("epm-nav-"+t);r=n("#epm-nav-pin");r.removeClass("epm-nav-pin-pinned");r.removeClass("epm-nav-pin-unpinned");r.addClass("epm-nav-pin-"+t);t==="unpinned"&&nt();u.data("pinstate",t);n.cookie(v,t,c)}function ot(){u.data("pinstate")==="pinned"?y("unpinned"):y("pinned")}function tt(){return(n.cookie(d)||"epm-nav-top-ql").replace("epm-nav-top-","epm-nav-sub-")}function l(t){return n("#"+t).find(".epm-nav-sub-menu").find("div[id^=E]")}function st(){var u=n.parseJSON(n.cookie(g)),i,r,f,e,t;if(u&&(i=u.index,r=u.uri,window.location.href.indexOf(r)!==-1))if(f=n("#"+tt()),i&&i!==-1){for(e=l(f.parent().attr("id")),t=0;t<e.length;t++)if(t===i){n(e[t]).find('a[href="'+r+'"]:first').parents("table").addClass(o);break}}else f.find('a[href="'+r+'"]:first').parents("table").addClass(o)}function ht(t){var i={};t.find(".epm-nav-cat").each(function(){var t=n(this);i[t.text()]=n(t.find("span")[0]).hasClass(e)});it(t.get(0).id,i)}function it(t,i){var r=n.parseJSON(n.cookie(h))||{};r[t]=i;n.cookie(h,JSON.stringify(r),c)}function rt(t){var w=n.parseJSON(n.cookie(h)),i,r,s,u,c,o,a,v,y;if(w){if(i=tt(),t)for(r=0;r<f.length;r++)if(s=f[r],s.provider===t){i=s.id.replace("epm-nav-top-","epm-nav-sub-");break}if(u=w[i],u)if(i==="epm-nav-sub-ql")for(c=l("epm-nav-sub-ql"),o=0;o<c.length;o++)a=c[o],v=a.id.replace("Nodes",""),u[n("#"+v.replace("EPMLiveNavn","EPMLiveNavt")).text()]&&TreeView_ToggleNode(window.EPMLiveNav_Data,0,document.getElementById(v)," ",document.getElementById(a.id));else y=n("#"+i).find(".epm-nav-cat"),i==="epm-nav-sub-settings"&&y.each(function(){p(n(this))}),y.each(function(){var t=n(this),r=t.text(),i=u[r];n(t.find("span")[0]).hasClass(e)?i||p(t):i&&ut(t)})}}function ut(t){var u=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+u+"-links");i.removeClass(s);i.addClass(e);r.removeClass(s);r.addClass(e)}function p(t){var u=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+u+"-links");i.removeClass(e);i.addClass(s);r.removeClass(e);r.addClass(s)}function ct(){n(".epm-nav-cat").click(function(){var t=n(this),i=n(t.find("span")[0]);i.hasClass(s)?ut(t):p(t);ht(t.parent())})}function lt(){var o=window.TreeView_HoverNode,s=window.TreeView_UnhoverNode,a=window.TreeView_ToggleNode,r,f,i,t,e;window.TreeView_HoverNode=function(t,i){var r=n(i);r.hasClass(b)?r.parent().parent().parent().addClass(k):o(t,i)};window.TreeView_UnhoverNode=function(t){var i=n(t);i.hasClass(b)?n(t).parent().parent().parent().removeClass(k):s(t)};window.TreeView_ToggleNode=function(t,i,r,u,f){var w=null,e=n.parseJSON(n.cookie(h)),o,v,d,y,s;e&&(e=n.parseJSON(n.cookie(h))["epm-nav-sub-ql"],e&&(w=e));var b=w||{},c=null,k=n(r).parents("div");for(o=0;o<k.length;o++)if(v=k[o],d=n(v),d.hasClass("epm-nav-sub")){for(c=v.id,y=l(c),s=0;s<y.length;s++){var g=y[s],p=n(g).is(":visible"),nt=g.id.replace("Nodes","");nt===r.id&&(p=!p);b[n("#"+nt.replace("EPMLiveNavn","EPMLiveNavt")).text()]=p}break}it(c,b);a(t,i,r,u,f)};r=["suiteBar","s4-ribbonrow","s4-workspace"];for(f in r)n("#"+r[f]).click(function(){u.data("pinstate")==="unpinned"&&nt()});i=n("#epm-nav-pin");i.click(function(){ot()});u.hover(function(){i.show()},function(){i.hide()});u.slimScroll({height:u.height(),width:u.width()});t=n("#epm-nav").find(".slimScrollDiv");e=t.find(".slimScrollBar");t.css("position","absolute");t.css("left","50px");u.css("left","0");e.css("z-index",1001);n(window).resize(function(){var i=n("#epm-nav-top").height();t.height(i);u.height(i)});n("a.epm-nav-node").click(function(){var r=-1,u=n(this),f=u.parents("div")[0],e=n(f).siblings("div"),i,t,o;if(e)for(i=l(n(e[0]).parent().parent().attr("id")),t=0;t<i.length;t++)o=i[t],o.id===f.id&&(r=t);n.cookie(g,JSON.stringify({index:r,uri:u.attr("href")}),c)})}function ft(n){var o=epmLive.currentWebUrl,h=o+window.location.href.split(o)[1],i,u,s,t,r,e;for(i in n.Nodes){u=n.Nodes[i].NavLink;for(s in u)for(t=u[s],r=0;r<f.length;r++)e=f[r],e.provider===i&&e.registerLink({id:t["@Id"],title:t["@Title"],url:t["#cdata"].replace(/{page}/g,h),category:t["@Category"],cssClass:t["@CssClass"],order:parseInt(t["@Order"]),external:t["@Exernal"]==="True",visible:t["@Visible"]==="True",seprator:t["@Separator"]==="True"});rt(i)}}function at(){for(var t=[],i,u,n=0;n<f.length;n++)i=f[n],i.selected()||(u=i.provider,u&&t.push(u));t.length>0&&r.execute("GetNavigationLinks",t.join(),function(n){ft(n);ct()},function(n){console.log(n)})}function vt(){t.staticProvider&&ft(i.decode(t.staticProvider))}function yt(){n("#epm-nav-top").find("[data-role='top-nav-node']").each(function(){f.push(new et(this))})}var w=300,b="epm-nav-node",k="epm-nav-node-hover",a="epm-nav-node-opened",o="epm-nav-node-selected",e="epm-nav-node-expanded",s="epm-nav-node-collapsed",d="epmnav-selected-tlnode",g="epmnav-selected-link",h="epmnav-expand-state",v="epmnav-pin-state",c={expires:365,path:"/"},u=n("#epm-nav-sub"),f=[],et=function(t){var e={},h=t,i=n(t),r=n("#epm-nav-sub-"+i.data("id")),s=h.id,nt=i.data("linkprovider"),l=function(){return i.parent().hasClass(o)},tt=function(){return i.parent().hasClass(a)},y=function(n){n?i.parent().addClass(o):i.parent().removeClass(o)},p=function(){r.hide();i.parent().removeClass(a)},b=function(){u.is(":visible")&&u.hide("slide",{direction:"left"},w);p()},it=function(n){n.seprator?ut(n.category):(ft(n.category),rt(n))},rt=function(t){var i=t.category,r;i||(i="__STATIC__");r='<li id="'+t.id+'" class="epm-nav-node" style="display:none;"><a id="epm-nav-link-'+t.id+'" href="'+t.url+'" alt="'+t.title+'">'+t.title+"<\/a><\/li>";e[i].$el.append(r);t.external&&n("#epm-nav-link-"+t.id).attr("target","_blank");t.visible&&n("#"+t.id).show()},ut=function(t){var i='<div class="epm-nav-sub-sep"><\/div>';t?n("#"+k(t)).append(i):r.append(i)},ft=function(t){if(t||(t="__STATIC__"),!e[t]){var i=k(t),u="epm-nav-node-expanded";t==="__STATIC__"&&(u="epm-nav-node-static");t!=="__STATIC__"&&r.append('<div id="'+i+'" class="epm-nav-node epm-nav-node-root epm-nav-cat"><span class="'+u+'">&nbsp;<\/span><span class="epm-nav-cat-title" alt="'+t+'">'+t+"<\/span><\/div>");r.append('<ul id="'+i+'-links" class="epm-nav-links '+u+'"><\/ul>');e[t]={id:i,$el:n("#"+i+"-links")}}},k=function(n){return r.get(0).id+"-"+n.toLowerCase().replace(/ /g,"-").replace(/_/g,"").replace(/[^\w-]+/g,"").replace(/--/g,"-")},et=function(){r.show();i.parent().addClass(a)},g=function(){et();u.is(":visible")||u.show("slide",{direction:"left"},w)};return i.click(function(){var i,t;if(l())tt()&&n.cookie(v)==="unpinned"?b():g();else{for(i in f)t=f[i],t.id!==s&&t.selected()&&(t.select(!1),t.close());y(!0);g();n.cookie(d,s,c)}}),{id:s,provider:nt,selected:l,select:y,close:p,closeNav:b,registerLink:it,el:h,$el:i,$menu:r}},pt=function(){yt();vt();y(n.cookie(v)||"pinned");rt();st();lt();ExecuteOrDelayUntilScriptLoaded(at,"EPMLive.js")};return{init:pt}}();t.init()})}function t(){ExecuteOrDelayUntilScriptLoaded(n,"EPMLiveNavigation")}ExecuteOrDelayUntilScriptLoaded(t,"jquery.min.js")})();
//@ sourceMappingURL=EPMLive.Navigation.min.js.map