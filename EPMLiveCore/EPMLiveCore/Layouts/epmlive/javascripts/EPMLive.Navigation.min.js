(function(){"use strict";function n(){$(function(){var n=window.jQuery,t=function(){var t=function(){return window.epmLiveNavigation.currentWebUrl},i=function(xml){return eval("("+window.xml2json(n.parseXML(xml),"")+")")},r=function(n){return n["@Status"]==0};return{currentWebUrl:t,parseJson:i,responseIsSuccess:r}}(),u=function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(t){var i="",o,s,h="",c,f,r,e="",u=0;/[^A-Za-z0-9\+\/\=]/g.exec(t)&&console.log('There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, "+", "/",and "="\nExpect errors in decoding.');t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do c=n.indexOf(t.charAt(u++)),f=n.indexOf(t.charAt(u++)),r=n.indexOf(t.charAt(u++)),e=n.indexOf(t.charAt(u++)),o=c<<2|f>>4,s=(f&15)<<4|r>>2,h=(r&3)<<6|e,i=i+String.fromCharCode(o),r!=64&&(i=i+String.fromCharCode(s)),e!=64&&(i=i+String.fromCharCode(h)),o=s=h="",c=f=r=e="";while(u<t.length);return unescape(i)};return{decode:t}}(),i=function(){var i=function(r,u,f,e){var o=t.currentWebUrl();o?n.ajax({type:"POST",url:o+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: '"+r+"', Dataxml: '"+u+"' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var r=t.parseJson(n.d),i=r.Result;t.responseIsSuccess(i)?f(i):e(n)}else e(n)},error:function(n){e(n)}}):window.setTimeout(function(){i(r,u,f,e)},1)};return{execute:i}}(),f=function(){function nt(){for(var t,n=0;n<f.length;n++)if(t=f[n],t.selected()){t.closeNav();break}}function y(t){var f=["s4-ribbonrow","s4-workspace"],e,i,u;for(e in f)i=n("#"+f[e]),i.removeClass("epm-nav-pinned"),i.removeClass("epm-nav-unpinned"),i.addClass("epm-nav-"+t);u=n("#epm-nav-pin");u.removeClass("epm-nav-pin-pinned");u.removeClass("epm-nav-pin-unpinned");u.addClass("epm-nav-pin-"+t);t==="unpinned"&&nt();r.data("pinstate",t);n.cookie(v,t,c)}function st(){r.data("pinstate")==="pinned"?y("unpinned"):y("pinned")}function tt(){return(n.cookie(d)||"epm-nav-top-ql").replace("epm-nav-top-","epm-nav-sub-")}function l(t){return n("#"+t).find(".epm-nav-sub-menu").find("div[id^=E]")}function ht(){var u=n.parseJSON(n.cookie(g)),i,r,f,e,t;if(u&&(i=u.index,r=u.uri,window.location.href.indexOf(r)!==-1))if(f=n("#"+tt()),i&&i!==-1){for(e=l(f.parent().attr("id")),t=0;t<e.length;t++)if(t===i){n(e[t]).find('a[href="'+r+'"]:first').parents("table").addClass(o);break}}else f.find('a[href="'+r+'"]:first').parents("table").addClass(o)}function ct(t){var i={};t.find(".epm-nav-cat").each(function(){var t=n(this);i[t.text()]=n(t.find("span")[0]).hasClass(e)});it(t.get(0).id,i)}function it(t,i){var r=n.parseJSON(n.cookie(h))||{};r[t]=i;n.cookie(h,JSON.stringify(r),c)}function rt(t){var w=n.parseJSON(n.cookie(h)),i,r,s,u,c,o,a,v,y;if(w){if(i=tt(),t)for(r=0;r<f.length;r++)if(s=f[r],s.provider===t){i=s.id.replace("epm-nav-top-","epm-nav-sub-");break}if(u=w[i],u)if(i==="epm-nav-sub-ql")for(c=l("epm-nav-sub-ql"),o=0;o<c.length;o++)a=c[o],v=a.id.replace("Nodes",""),u[n("#"+v.replace("EPMLiveNavn","EPMLiveNavt")).text()]&&TreeView_ToggleNode(window.EPMLiveNav_Data,0,document.getElementById(v)," ",document.getElementById(a.id));else y=n("#"+i).find(".epm-nav-cat"),i==="epm-nav-sub-settings"&&y.each(function(){p(n(this))}),y.each(function(){var t=n(this),r=t.text(),i=u[r];n(t.find("span")[0]).hasClass(e)?i||p(t):i&&ut(t)})}}function ut(t){var u=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+u+"-links");i.removeClass(s);i.addClass(e);r.removeClass(s);r.addClass(e)}function p(t){var u=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+u+"-links");i.removeClass(e);i.addClass(s);r.removeClass(e);r.addClass(s)}function lt(){n(".epm-nav-cat").click(function(){var t=n(this),i=n(t.find("span")[0]);i.hasClass(s)?ut(t):p(t);ct(t.parent())})}function at(){var o=window.TreeView_HoverNode,s=window.TreeView_UnhoverNode,a=window.TreeView_ToggleNode,u,f,i,t,e;window.TreeView_HoverNode=function(t,i){var r=n(i);r.hasClass(b)?r.parent().parent().parent().addClass(k):o(t,i)};window.TreeView_UnhoverNode=function(t){var i=n(t);i.hasClass(b)?n(t).parent().parent().parent().removeClass(k):s(t)};window.TreeView_ToggleNode=function(t,i,r,u,f){var w=null,e=n.parseJSON(n.cookie(h)),o,v,d,y,s;e&&(e=n.parseJSON(n.cookie(h))["epm-nav-sub-ql"],e&&(w=e));var b=w||{},c=null,k=n(r).parents("div");for(o=0;o<k.length;o++)if(v=k[o],d=n(v),d.hasClass("epm-nav-sub")){for(c=v.id,y=l(c),s=0;s<y.length;s++){var g=y[s],p=n(g).is(":visible"),nt=g.id.replace("Nodes","");nt===r.id&&(p=!p);b[n("#"+nt.replace("EPMLiveNavn","EPMLiveNavt")).text()]=p}break}it(c,b);a(t,i,r,u,f)};u=["suiteBar","s4-ribbonrow","s4-workspace"];for(f in u)n("#"+u[f]).click(function(){r.data("pinstate")==="unpinned"&&nt()});i=n("#epm-nav-pin");i.click(function(){st()});r.hover(function(){i.show()},function(){i.hide()});r.slimScroll({height:r.height(),width:r.width()});t=n("#epm-nav").find(".slimScrollDiv");e=t.find(".slimScrollBar");t.css("position","absolute");t.css("left","50px");r.css("left","0");e.css("z-index",1001);n(window).resize(function(){var i=n("#epm-nav-top").height();t.height(i);r.height(i)});n("a.epm-nav-node").click(function(){var r=-1,u=n(this),f=u.parents("div")[0],e=n(f).siblings("div"),i,t,o;if(e)for(i=l(n(e[0]).parent().parent().attr("id")),t=0;t<i.length;t++)o=i[t],o.id===f.id&&(r=t);n.cookie(g,JSON.stringify({index:r,uri:u.attr("href")}),c)})}function ft(n){var s=t.currentWebUrl,c=s+window.location.href.split(s)[1],u,r,h,i,e,o;for(u in n.Nodes){r=n.Nodes[u].NavLink;r.length||(r=[r]);for(h in r)for(i=r[h],e=0;e<f.length;e++)o=f[e],o.provider===u&&o.registerLink({id:i["@Id"],title:i["@Title"],url:(i["#cdata"]||"").replace(/{page}/g,c),category:i["@Category"],cssClass:i["@CssClass"],order:parseInt(i["@Order"]),siteId:i["@SiteId"],webId:i["@WebId"],listId:i["@ListId"],itemId:i["@ItemId"],external:i["@Exernal"]==="True",visible:i["@Visible"]==="True",seprator:i["@Separator"]==="True"});rt(u);window.SP.SOD.notifyScriptLoadedAndExecuteWaitingJobs("EPMLiveNavigation_"+u)}}function vt(){for(var t=[],r,u,n=0;n<f.length;n++)r=f[n],r.selected()||(u=r.provider,u&&t.push(u));t.length>0&&i.execute("GetNavigationLinks",t.join(),function(n){ft(n);lt()},function(n){console.log(n)})}function et(){var n=null;window.epmLiveNavigation&&(n=window.epmLiveNavigation.staticProvider);n?ft(t.parseJson(u.decode(n))):window.setTimeout(function(){et()},1)}function yt(){n("#epm-nav-top").find("[data-role='top-nav-node']").each(function(){f.push(new ot(this))})}var w=300,b="epm-nav-node",k="epm-nav-node-hover",a="epm-nav-node-opened",o="epm-nav-node-selected",e="epm-nav-node-expanded",s="epm-nav-node-collapsed",d="epmnav-selected-tlnode",g="epmnav-selected-link",h="epmnav-expand-state",v="epmnav-pin-state",c={expires:365,path:"/"},r=n("#epm-nav-sub"),f=[],ot=function(t){var e={},h=t,i=n(t),u=n("#epm-nav-sub-"+i.data("id")),s=h.id,tt=i.data("linkprovider"),l=function(){return i.parent().hasClass(o)},it=function(){return i.parent().hasClass(a)},y=function(n){n?i.parent().addClass(o):i.parent().removeClass(o)},p=function(){u.hide();i.parent().removeClass(a)},b=function(){r.is(":visible")&&r.hide("slide",{direction:"left"},w);p()},rt=function(n){n.seprator?et(n.category):n.url.toLowerCase()==="header"?(k(n.category),ut(n)):(k(n.category),ft(n))},ut=function(n){var t=n.category,i;t||(t="__STATIC__");i='<li class="epm-nav-sub-header">'+n.title+"<\/li>";e[t].$el.append(i);i='<li class="epm-nav-sub-header-bottom"><\/li>';e[t].$el.append(i)},ft=function(t){var i=t.category,r,u;i||(i="__STATIC__");r="";t.cssClass&&(r='<span class="epm-nav-icon '+t.cssClass+'"><\/span>');u='<li id="'+t.id+'" class="epm-nav-node" style="display:none;">'+r+'<a id="epm-nav-link-'+t.id+'" href="'+t.url+'" alt="'+t.title+'" data-siteid="'+t.siteId+'" data-webid="'+t.webId+'" data-listid="'+t.listId+'" data-itemid="'+t.itemId+'">'+t.title+"<\/a><\/li>";e[i].$el.append(u);t.external&&n("#epm-nav-link-"+t.id).attr("target","_blank");t.visible&&n("#"+t.id).show()},et=function(t){var i='<div class="epm-nav-sub-sep"><\/div>';t?n("#"+g(t)).append(i):u.append(i)},k=function(t){if(t||(t="__STATIC__"),!e[t]){var i=g(t),r="epm-nav-node-expanded";t==="__STATIC__"&&(r="epm-nav-node-static");t!=="__STATIC__"&&u.append('<div id="'+i+'" class="epm-nav-node epm-nav-node-root epm-nav-cat"><span class="'+r+'">&nbsp;<\/span><span class="epm-nav-cat-title" alt="'+t+'">'+t+"<\/span><\/div>");u.append('<ul id="'+i+'-links" class="epm-nav-links '+r+'"><\/ul>');e[t]={id:i,$el:n("#"+i+"-links")}}},g=function(n){return u.get(0).id+"-"+n.toLowerCase().replace(/ /g,"-").replace(/_/g,"").replace(/[^\w-]+/g,"").replace(/--/g,"-")},ot=function(){u.fadeIn(300);i.parent().addClass(a)},nt=function(){ot();r.is(":visible")||r.show("slide",{direction:"left"},w)};return i.click(function(){var i,t;if(l())it()&&n.cookie(v)==="unpinned"?b():nt();else{for(i in f)t=f[i],t.id!==s&&t.selected()&&(t.select(!1),t.close());y(!0);nt();n.cookie(d,s,c)}}),{id:s,provider:tt,selected:l,select:y,close:p,closeNav:b,registerLink:rt,el:h,$el:i,$menu:u}},pt=function(){yt();et();y(n.cookie(v)||"pinned");rt();ht();at();ExecuteOrDelayUntilScriptLoaded(vt,"EPMLive.js")};return{init:pt}}(),r;f.init();r=function(){var t=n("#epm-nav-sub-favorites-static-links"),r=function(){var r=[],u=0;t.find(".epm-nav-node").each(function(){r.push(n(this).get(0).id+":"+ ++u)});r.length&&i.execute("ReorderFavorites",r.join(),function(){},function(n){console.log(n)})};t.find(".epm-nav-node").each(function(){var t=n(this);t.prepend('<span class="epm-nav-dragger">&nbsp;<\/span>');t.hover(function(){n(n(this).find(".epm-nav-dragger").get(0)).css("visibility","visible")},function(){n(n(this).find(".epm-nav-dragger").get(0)).css("visibility","hidden")})});t.sortable({placeholder:"epm-nav-drag-placeholder",update:function(){r()}});t.disableSelection()};ExecuteOrDelayUntilScriptLoaded(r,"EPMLiveNavigation_Favorites")})}function t(){ExecuteOrDelayUntilScriptLoaded(n,"EPMLiveNavigation")}ExecuteOrDelayUntilScriptLoaded(t,"jquery.min.js")})();
//@ sourceMappingURL=EPMLive.Navigation.min.js.map