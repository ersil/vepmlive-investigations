(function(){"use strict";function n(){$(function(){var n=window.jQuery,t=function(){var t=function(){return window.epmLiveNavigation.currentWebUrl},i=function(xml){return eval("("+window.xml2json(n.parseXML(xml),"")+")")},r=function(n){return n["@Status"]==0};return{currentWebUrl:t,parseJson:i,responseIsSuccess:r}}(),f=function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(t){var i="",o,s,h="",c,f,r,e="",u=0;/[^A-Za-z0-9\+\/\=]/g.exec(t)&&console.log('There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, "+", "/",and "="\nExpect errors in decoding.');t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do c=n.indexOf(t.charAt(u++)),f=n.indexOf(t.charAt(u++)),r=n.indexOf(t.charAt(u++)),e=n.indexOf(t.charAt(u++)),o=c<<2|f>>4,s=(f&15)<<4|r>>2,h=(r&3)<<6|e,i=i+String.fromCharCode(o),r!=64&&(i=i+String.fromCharCode(s)),e!=64&&(i=i+String.fromCharCode(h)),o=s=h="",c=f=r=e="";while(u<t.length);return unescape(i)};return{decode:t}}(),r=function(){var i=function(r,u,f,e){var o=t.currentWebUrl();o?n.ajax({type:"POST",url:o+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: '"+r+"', Dataxml: '"+u+"' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var r=t.parseJson(n.d),i=r.Result;t.responseIsSuccess(i)?f(i):e(n)}else e(n)},error:function(n){e(n)}}):window.setTimeout(function(){i(r,u,f,e)},1)};return{execute:i}}(),u=n.cookie,i;n.cookie=function(n,t,i){if(n=n+"-u-"+window.epmLiveNavigation.currentUserId,!t)return u(n);u(n,t,i)};i=function(){function tt(){for(var t,n=0;n<u.length;n++)if(t=u[n],t.selected()){t.closeNav();break}}function p(t){var f=["s4-ribbonrow","s4-workspace"],e,r,u;for(e in f)r=n("#"+f[e]),r.removeClass("epm-nav-pinned"),r.removeClass("epm-nav-unpinned"),r.addClass("epm-nav-"+t);u=n("#epm-nav-pin");u.removeClass("epm-nav-pin-pinned");u.removeClass("epm-nav-pin-unpinned");u.addClass("epm-nav-pin-"+t);t==="unpinned"&&tt();i.data("pinstate",t);n.cookie(y,t,c)}function ot(){i.data("pinstate")==="pinned"?p("unpinned"):p("pinned")}function st(){return(n.cookie(nt)||"epm-nav-top-ql").replace("epm-nav-top-","epm-nav-sub-")}function l(t){return n("#"+t).find(".epm-nav-sub-menu").find("div[id^=E]")}function ht(){var t=n.parseJSON(n.cookie(v)),u,f,o,s,r;if(t)if(t.id)n(i.find("#"+t.id).get(0)).parent().addClass(e);else if(u=t.index,f=t.uri,window.location.href.indexOf(f)!==-1)if(o=n("#"+st()),u&&u!==-1){for(s=l(o.parent().attr("id")),r=0;r<s.length;r++)if(r===u){n(s[r]).find('a[href="'+f+'"]:first').parents("table").addClass(e);break}}else o.find('a[href="'+f+'"]:first').parents("table").addClass(e)}function ct(t){var i={};t.find(".epm-nav-cat").each(function(){var t=n(this);i[t.text()]=n(t.find("span")[0]).hasClass(o)});it(t.get(0).id,i)}function it(t,i){var r=n.parseJSON(n.cookie(h))||{};r[t]=i;n.cookie(h,JSON.stringify(r),c)}function w(t){var p=n.parseJSON(n.cookie(h)),i,r,s,f,c,e,a,v,y;if(p){if(i="epm-nav-sub-ql",t)for(r=0;r<u.length;r++)if(s=u[r],s.provider===t){i=s.id.replace("epm-nav-top-","epm-nav-sub-");break}if(f=p[i],f)if(i==="epm-nav-sub-ql")for(c=l("epm-nav-sub-ql"),e=0;e<c.length;e++)a=c[e],v=a.id.replace("Nodes",""),f[n("#"+v.replace("EPMLiveNavn","EPMLiveNavt")).text()]||TreeView_ToggleNode(window.EPMLiveNav_Data,0,document.getElementById(v)," ",document.getElementById(a.id));else y=n("#"+i).find(".epm-nav-cat"),i==="epm-nav-sub-settings"&&y.each(function(){b(n(this))}),y.each(function(){var t=n(this),r=t.text(),i=f[r];n(t.find("span")[0]).hasClass(o)?i||b(t):i&&rt(t)})}}function rt(t){var u=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+u+"-links");i.removeClass(s);i.addClass(o);r.removeClass(s);r.addClass(o)}function b(t){var u=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+u+"-links");i.removeClass(o);i.addClass(s);r.removeClass(o);r.addClass(s)}function lt(){n(".epm-nav-cat").click(function(){var t=n(this),i=n(t.find("span")[0]);i.hasClass(s)?rt(t):b(t);ct(t.parent())})}function at(){var s=window.TreeView_HoverNode,a=window.TreeView_UnhoverNode,y=window.TreeView_ToggleNode,u,f,r,t,o;window.TreeView_HoverNode=function(t,i){var r=n(i);r.hasClass(d)?r.parent().parent().parent().addClass(g):s(t,i)};window.TreeView_UnhoverNode=function(t){var i=n(t);i.hasClass(d)?n(t).parent().parent().parent().removeClass(g):a(t)};window.TreeView_ToggleNode=function(t,i,r,u,f){var w=null,e=n.parseJSON(n.cookie(h)),o,a,d,v,s;e&&(e=n.parseJSON(n.cookie(h))["epm-nav-sub-ql"],e&&(w=e));var b=w||{},c=null,k=n(r).parents("div");for(o=0;o<k.length;o++)if(a=k[o],d=n(a),d.hasClass("epm-nav-sub")){for(c=a.id,v=l(c),s=0;s<v.length;s++){var g=v[s],p=n(g).is(":visible"),nt=g.id.replace("Nodes","");nt===r.id&&(p=!p);b[n("#"+nt.replace("EPMLiveNavn","EPMLiveNavt")).text()]=p}break}it(c,b);y(t,i,r,u,f)};n("td.epm-nav-node-root").click(function(){var i=n(this),t=i.parent().find("a").get(0).id;TreeView_ToggleNode(EPMLiveNav_Data,0,document.getElementById(t)," ",document.getElementById(t+"Nodes"))});u=["suiteBar","s4-ribbonrow","s4-workspace"];for(f in u)n("#"+u[f]).click(function(){i.data("pinstate")==="unpinned"&&tt()});r=n("#epm-nav-pin");r.click(function(){ot()});i.hover(function(){r.show()},function(){r.hide()});i.slimScroll({height:i.height(),width:i.width()});t=n("#epm-nav").find(".slimScrollDiv");o=t.find(".slimScrollBar");t.css("position","absolute");t.css("left","50px");i.css("left","0");o.css("z-index",1001);n(window).resize(function(){var r=n("#epm-nav-top").height();t.height(r);i.height(r)});n("a.epm-nav-node").click(function(){var i=n(this),r,t,s;n("#epm-nav-sub-ql").find("a").each(function(){n(this).parent().parent().parent().parent().removeClass(e)});i.parent().parent().parent().parent().addClass(e);var u=-1,f=i.parents("div")[0],o=n(f).siblings("div");if(o)for(r=l(n(o[0]).parent().parent().attr("id")),t=0;t<r.length;t++)s=r[t],s.id===f.id&&(u=t);n.cookie(v,JSON.stringify({index:u,uri:i.attr("href")}),c)})}function ut(n){var s=t.currentWebUrl(),c=s+window.location.href.split(s)[1],r,f,h,i,e,o;for(r in n.Nodes){f=n.Nodes[r].NavLink;f.length||(f=[f]);for(h in f)for(i=f[h],e=0;e<u.length;e++)o=u[e],o.provider===r&&o.registerLink({id:i["@Id"],title:i["@Title"],url:(i["#cdata"]||"").replace(/{page}/g,c),category:i["@Category"],cssClass:i["@CssClass"],order:parseInt(i["@Order"]),siteId:i["@SiteId"],webId:i["@WebId"],listId:i["@ListId"],itemId:i["@ItemId"],external:i["@External"]==="True",visible:i["@Visible"]==="True",seprator:i["@Separator"]==="True"});window.SP.SOD.notifyScriptLoadedAndExecuteWaitingJobs("EPMLiveNavigation_"+r);r!=="Settings"&&w(r)}}function vt(){for(var t=[],i,f,n=0;n<u.length;n++)i=u[n],i.selected()||(f=i.provider,f&&t.push(f));t.length>0&&r.execute("GetNavigationLinks",t.join(),function(n){ut(n);lt()},function(n){console.log(n)})}function ft(){var n=null;window.epmLiveNavigation&&(n=window.epmLiveNavigation.staticProvider);n?ut(t.parseJson(f.decode(n))):window.setTimeout(function(){ft()},1)}function yt(){n("#epm-nav-top").find("[data-role='top-nav-node']").each(function(){u.push(new et(this))})}var k=300,d="epm-nav-node",g="epm-nav-node-hover",a="epm-nav-node-opened",e="epm-nav-node-selected",o="epm-nav-node-expanded",s="epm-nav-node-collapsed",nt="epmnav-selected-tlnode",v="epmnav-selected-link",h="epmnav-expand-state",y="epmnav-pin-state",c={expires:365,path:"/"},i=n("#epm-nav-sub"),u=[],et=function(t){var f={},h=t,r=n(t),o=n("#epm-nav-sub-"+r.data("id")),s=h.id,it=r.data("linkprovider"),l=function(){return r.parent().hasClass(e)},rt=function(){return r.parent().hasClass(a)},p=function(n){n?r.parent().addClass(e):r.parent().removeClass(e)},w=function(){o.hide();r.parent().removeClass(a)},b=function(){i.is(":visible")&&i.hide("slide",{direction:"left"},k);w()},ut=function(n){n.seprator?ot(n.category):n.url.toLowerCase()==="header"?(d(n.category),ft(n)):(d(n.category),et(n))},ft=function(n){var t=n.category,i;t||(t="__STATIC__");i='<li class="epm-nav-sub-header">'+n.title+"<\/li>";f[t].$el.append(i);i='<li class="epm-nav-sub-header-bottom"><\/li>';f[t].$el.append(i)},et=function(t){var r=t.category,u,o,h,s,l;r||(r="__STATIC__");u="";t.cssClass&&(u='<span class="epm-nav-icon '+t.cssClass+'"><\/span>');o="epm-nav-node epm-nav-trans";h=f[r].$el.parent().get(0).id;h==="epm-nav-sub-settings"&&(o="epm-nav-node");s="";t.external&&(s=' target="_blank"');l='<li id="'+t.id+'" class="'+o+'" style="display:none;">'+u+'<a id="epm-nav-link-'+t.id+'" href="'+t.url+'" alt="'+t.title+'" data-siteid="'+t.siteId+'" data-webid="'+t.webId+'" data-listid="'+t.listId+'" data-itemid="'+t.itemId+'"'+s+"><span>"+t.title+"<\/span><\/a><\/li>";f[r].$el.append(l);t.visible&&n("#"+t.id).show();n(f[r].$el.find("a").get(0)).click(function(){i.find("a").each(function(){n(this).parent().removeClass(e)});var t=n(this);t.parent().addClass(e);n.cookie(v,JSON.stringify({id:t.get(0).id,url:t.attr("href")}),c)})},ot=function(t){var i='<div class="epm-nav-sub-sep"><\/div>';t?n("#"+g(t)).append(i):o.append(i)},d=function(t){if(t||(t="__STATIC__"),!f[t]){var i=g(t),r="epm-nav-node-expanded";t==="__STATIC__"&&(r="epm-nav-node-static");t!=="__STATIC__"&&o.append('<div id="'+i+'" class="epm-nav-node epm-nav-node-root epm-nav-cat"><span class="'+r+'">&nbsp;<\/span><span class="epm-nav-cat-title" alt="'+t+'">'+t+"<\/span><\/div>");o.append('<ul id="'+i+'-links" class="epm-nav-links '+r+'"><\/ul>');f[t]={id:i,$el:n("#"+i+"-links")}}},g=function(n){return o.get(0).id+"-"+n.toLowerCase().replace(/ /g,"-").replace(/_/g,"").replace(/[^\w-]+/g,"").replace(/--/g,"-")},st=function(){o.fadeIn(300);r.parent().addClass(a)},tt=function(){st();i.is(":visible")||i.show("slide",{direction:"left"},k)};return r.click(function(){var i,t;if(l())rt()&&n.cookie(y)==="unpinned"?b():tt();else{for(i in u)t=u[i],t.id!==s&&t.selected()&&(t.select(!1),t.close());p(!0);tt();n.cookie(nt,s,c)}}),{id:s,provider:it,selected:l,select:p,close:w,closeNav:b,registerLink:ut,el:h,$el:r,$menu:o}},pt=function(){yt();ft();p(n.cookie(y)||"pinned");w();ht();at();ExecuteOrDelayUntilScriptLoaded(vt,"EPMLive.js")};return{init:pt,expandProviderNodes:w}}();i.init();var e=function(){var t=function(){var t=function(t){t.find(".epm-nav-cat").each(function(){var t=n(n(this).find("span").get(0));t.removeClass("epm-nav-node-expanded");t.addClass("epm-nav-node-collapsed")});t.find(".epm-nav-links").each(function(){var t=n(this);t.hasClass("epm-nav-node-static")||(t.removeClass("epm-nav-node-expanded"),t.addClass("epm-nav-node-collapsed"))})};return{collapseAll:t}}(),r=n("#epm-nav-sub-settings");t.collapseAll(r);i.expandProviderNodes("Settings")},o=function(){var i=function(){var t=function(t){var i=[],u=0;t.find(".epm-nav-node").each(function(){i.push(n(this).get(0).id+":"+ ++u)});i.length&&r.execute("ReorderFavorites",i.join(),function(){},function(n){console.log(n)})},i=function(t){t.prepend('<span class="epm-nav-dragger">&nbsp;<\/span>');t.hover(function(){n(n(this).find(".epm-nav-dragger").get(0)).css("visibility","visible")},function(){n(n(this).find(".epm-nav-dragger").get(0)).css("visibility","hidden")})},u=function(n){n.append('<span class="epm-menu-btn"><span class="icon-ellipsis-horizontal"><\/span><\/span>')};return{resetOrder:t,addDragger:i,addMenu:u}}(),t=n("#epm-nav-sub-favorites-static-links");t.find(".epm-nav-node").each(function(){var t=n(this);i.addDragger(t);i.addMenu(t)});t.sortable({placeholder:"epm-nav-drag-placeholder",update:function(){i.resetOrder(t)}});t.disableSelection()},s=function(){var r=function(){var n=function(n,r){n.index()<r?t(n):i(n)},t=function(n){n.append('<span class="epm-menu-btn"><span class="icon-plus-2"><\/span><\/span>')},i=function(n){n.append('<span class="epm-menu-btn"><span class="icon-ellipsis-horizontal"><\/span><\/span>')};return{addMenu:n}}(),t=n("#epm-nav-sub-recent-static-links"),i;t.find(".epm-nav-sub-header").each(function(){var t=n(this),r=t.text(),u=t.index();r==="Recent Items"&&(i=u)});t.find(".epm-nav-node").each(function(){r.addMenu(n(this),i)})};ExecuteOrDelayUntilScriptLoaded(e,"EPMLiveNavigation_Settings");ExecuteOrDelayUntilScriptLoaded(o,"EPMLiveNavigation_Favorites");ExecuteOrDelayUntilScriptLoaded(s,"EPMLiveNavigation_RecentItems")})}function t(){ExecuteOrDelayUntilScriptLoaded(n,"EPMLiveNavigation")}ExecuteOrDelayUntilScriptLoaded(t,"jquery.min.js")})();
//@ sourceMappingURL=EPMLive.Navigation.min.js.map