(function(){"use strict";function n(){(function(n,t,i){function r(n){var t,r;return i.isGuid(n)||(n["#cdata"]?n=n["#cdata"]:n==="true"?n=!0:n==="false"?n=!1:n.indexOf(" ")===-1?(t=parseInt(n),isNaN(t)||(n=t)):(r=Date.parse(n),isNaN(r)||(n=new Date(n)))),n}function f(n){var v,s,h,i,u,c,t,y,l,a,f,e,p,o;for(v=n.length?n:[n],s={},h=0;h<v.length;h++){i=v[h];for(u in i)if(i.hasOwnProperty(u)){if(c=u.replace(/@/,"").toLowerCase(),t=i[u],c==="solution"){for(y=t.length?t:[t],l={},a=0;a<y.length;a++){f=y[a];for(e in f)f.hasOwnProperty(e)&&(p=e.replace(/@/,"").toLowerCase(),o=f[e],o=r(o),l[p]=o,o instanceof Date&&(l[p+"datestring"]=f[e].split(" ",1)[0]))}t=l}else t=r(t);s[c]=t;t instanceof Date&&(s[c+"datestring"]=i[u].split(" ",1)[0])}}return s}function e(t){n.statusbar&&n.statusbar.remove();var s=!1,e="Attention",r="This site has been designated as a Template Site.",o=i.ui.statusbar.add(e,r),h=f(t),u=h.solution;u&&u.createddate&&(s=!0);e="Last Saved";r=s?i.getFriendlyDateTime(u.createddate,u.createddatedatestring):"Template has not been saved.";r+=' | <div id="EpmLiveTemplateVersoningSaveAction" style="display:inline-block;"><a href="javascript:void(0);" onclick="window.epmLiveTemplateVersoning.promptSaveTemplate();">Save Template<\/a><\/div><\/span>';o.append(e,r,null,"right");o.color("yellow");n.statusbar=o}function u(){t.ajax({type:"POST",url:i.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'GetTemplateInformation', Dataxml: '' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t,r;n.d?(t=i.parseJson(n.d),i.responseIsSuccess(t.Result)?(r=t.Result.Template,r&&e(r)):i.logFailure(t.Result)):i.log("response.d: "+n.d)},error:function(n){i.log(n)}})}n.statusbar=null;n.saveTemplate=function(){function c(n,t){var i=n.html(),r=t+"",u=t+".",f=t+"..",e=t+"...";i===r?n.html(u):i===u?n.html(f):i===f?n.html(e):n.html(r)}function o(t){clearInterval(h);var i="green",u="Site saved as template successfully.";t||(i="red",u="Saving the site as template failed.");e.hide();n.css("color",i);n.html(u);s.removeAttr("disabled");r.removeAttr("disabled");f.removeAttr("disabled")}var s=t("#EpmLiveTemplateVersoningSaveButton"),r,f,n,e,h;s.attr("disabled","disabled");r=t("#EpmLiveTemplateVersoningCancelButton");r.attr("disabled","disabled");f=t("#EpmLiveTemplateVersoningincludeContentCheckbox");f.attr("disabled","disabled");n=t("#EpmLiveTemplateVersoningSaveStatusMessage");e=t("#EpmLiveTemplateVersoningSaveStatusProgress");e.show();h=setInterval(function(){c(n,"Saving")},500);t.post(i.currentWebUrl+"/_layouts/epmlive/SaveCurrentSiteAsTemplate.aspx",{__REQUESTDIGEST:t("#__REQUESTDIGEST").val()},function(n){n?n.indexOf("SUCCESS")!==-1?(o(!0),u()):(o(!1),i.logFailure(n)):(o(!1),i.log("response: "+n))})};t(document).ready(function(){LoadSodByKey("sp.js",function(){})});n.promptSaveTemplate=function(){var i=document.createElement("div"),n;i.innerHTML=t("#EPMLiveTemplateVersoningSavePrompt").html();n=parent.SP.UI.$create_DialogOptions();n.title="Save Template";n.html=i;n.height=100;n.width=565;n.allowMaximize=!1;n.showClose=!1;parent.SP.UI.ModalDialog.showModalDialog(n)};u()})(window.epmLiveTemplateVersoning=window.epmLiveTemplateVersoning||{},window.jQuery,epmLive)}ExecuteOrDelayUntilScriptLoaded(n,"EPMLive.js")})();