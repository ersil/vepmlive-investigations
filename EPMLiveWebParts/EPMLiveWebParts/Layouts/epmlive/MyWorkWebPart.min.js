function confirmPageLeave(n){if(Grids[MyWorkGrid.gridId].TotalRowsInEditMode>0)try{n||(n=window.event);n.returnValue=leaveMessage;n.stopPropagation&&(n.stopPropagation(),n.preventDefault())}catch(n){}}function MyWorkOnDblClick(n,t,i){EditGridRow(n,t,i)}function GoodEditCol(n){switch(n){case"DueDay":case"TitleLower":case"StatusFC":case"DueDateFC":case"DueDateFC2":case"Complete":case"CommentCount":case"Flag":case"WorkingOn":return!1}return!0}function EditGridRow(n,t){var u,i,r,f;if(t.ItemID&&n.EditRow!=t.id&&t.id!="Header"){u=window.epmLiveNavigation.currentWebUrl;i="";for(r in n.Cols)GoodEditCol(r)&&(i+=","+r);i=i.substr(1);f='<Row id="'+t.id+'" siteid="'+t.SiteID+'" webid="'+t.WebID+'" listid="'+t.ListID+'" itemid="'+t.ItemID+'" Cols="'+i+'"/>';n.SetAttribute(t,"Title","HtmlPrefix","<img src='/_layouts/15/epmlive/images/mywork/loading16.gif'>",1);$.ajax({type:"POST",url:(u+"/_vti_bin/WorkEngine.asmx/ExecuteJSON").replace(/\/\//g,"/"),data:"{ Function: 'webparts_GetGridRowEdit', Dataxml: '"+f+"' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){var r=eval("("+i.d+")");r.Result.Status=="0"?(n.EditRow=t.id,n.AddDataFromServer(r.Result.InnerText),n.SetAttribute(t,"Title","HtmlPrefix",'<span class="icon-pencil" style="color: #CCC;padding-right:5px"><\/span>',1),n.StartEdit()):alert(r.Result.Error.Text)},error:function(n){alert("Error: "+n)}})}}function MyWorkOnClickOutside(n){n.EditRow&&StopEditGridRow(n,n.GetRowById("Header"))}function MyWorkOnAfterValueChanged(n){n.EditRowChanged=!0}function StopEditGridRow(n,t){var t,r,u,f,e,i;if(t.id!=n.EditRow){if(t=n.GetRowById(n.EditRow),n.EditRow=null,n.EndEdit(!0),n.EditRowChanged){n.SetAttribute(t,"Title","HtmlPrefix","<img src='/_layouts/15/epmlive/images/mywork/loading16.gif'>",1);r="";u="";for(i in n.Cols)GoodEditCol(i)&&n.GetAttribute(t,i,"CanEdit")=="1"&&(r+='<Field Name="'+i+'">'+escape(n.GetValue(t,i))+"<\/Field>",u+=","+i);f='<Row id="'+t.id+'" siteid="'+t.SiteID+'" webid="'+t.WebID+'" listid="'+t.ListID+'" itemid="'+t.ItemID+'" Cols="'+u+'">'+r+"<\/Row>";e=window.epmLiveNavigation.currentWebUrl;$.ajax({type:"POST",url:(e+"/_vti_bin/WorkEngine.asmx/ExecuteJSON").replace(/\/\//g,"/"),data:"{ Function: 'webparts_SetGridRowEdit', Dataxml: '"+f+"' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){var r=eval("("+i.d+")"),u;r.Result.Status=="0"?n.AddDataFromServer(r.Result.InnerText):alert(r.Result.Error.Text);n.SetAttribute(t,"Title","HtmlPrefix","",1);for(u in n.Cols)GoodEditCol(u)&&n.SetAttribute(t,u,"CanEdit","0",1);n.AcceptChanges(t)},error:function(i){alert("Error: "+i);n.SetAttribute(t,"Title","HtmlPrefix","",1)}})}else{n.EditRow="";for(i in n.Cols)GoodEditCol(i)&&n.SetAttribute(t,i,"CanEdit","0",1);n.SetAttribute(t,"Title","HtmlPrefix","",1)}n.EditRowChanged=!1}}function MyWorkOnReady(n){var r,u,t,i;if(n.id===window.allWorkGridId){if(TGSetEvent("OnRenderFinish",n.id,MyWorkOnRenderFinish),TGSetEvent("OnFocus",n.id,MyWorkOnFocus),TGSetEvent("OnClick",n.id,MyWorkOnClick),TGSetEvent("OnClickOutside",n.id,MyWorkOnClickOutside),TGSetEvent("OnAfterValueChanged",n.id,MyWorkOnAfterValueChanged),TGSetEvent("OnGetHtmlValue",n.id,MyWorkOnGetHtmlValue),TGSetEvent("OnColumnsChanged",n.id,MyWorkOnColumnsChanged),TGSetEvent("OnGetColor",n.id,MyWorkOnGetColor),TGSetEvent("OnGroup",n.id,MyWorkOnGroup),TGSetEvent("OnGetSortValue",n.id,MyWorkOnGetSortValue),TGSetEvent("OnDblClick",n.id,MyWorkOnDblClick),TGSetEvent("OnMouseOverOutside",n.id,MyWorkOnMouseOverOutside),TGSetEvent("OnMouseOverRow",n.id,MyWorkOnMouseOverRow),EPMLiveCore.WorkEngineAPI.set_path(siteUrl+"/_vti_bin/WorkEngine.asmx"),window.epmLiveMasterPageVersion>=5.5?(r=$("#WebPart"+window.myWorkWebPartQualifier+"_epm_loader"),r.length&&(window.EPM.UI.Loader.current().stopLoading("WebPart"+window.myWorkWebPartQualifier),$("#s4-ribbonrow").height(35))):window.myWorkLoader?window.myWorkLoader.close():document.getElementById("MWG_Loader_"+myWorkWebPartId).style.display="none",MyWorkGrid.showingCompletedItems)for(u in n.Rows)(t=n.Rows[u],t.Def.Name!=="Header"&&t.Def.Name!=="Fixed"&&t.Def.Name!=="Group"&&t.Def.Name!=="Solid")&&markRowCompleted(n,t);MyWorkGrid.gridId=n.id;MyWorkGrid.loadViews();MyWorkGrid.configureTag();MyWorkGrid.configureToolbar();MyWorkGrid.newItemIndicator=window.mwNewItemIndicator;i=(window.location.href+"").toLowerCase();(i.indexOf("mywork.aspx")!==-1||i.indexOf("my%20work.aspx")!==-1)&&MyWorkGrid.loadRibbon();navigator.appName=="Microsoft Internet Explorer"&&document.getElementById("Ribbon.MyWorkTab")!=null&&document.getElementById("Ribbon.MyWorkTab").setAttribute("unselectable","off")}}function MyWorkOnGetSortValue(n,t,i,r){if(n.id===window.allWorkGridId)return i==="DueDay"?DateToString(t.DueDate,"yyyyMMdd"):n.GetAttribute(t,i,"Type")==="Date"?DateToString(t[i],"yyyyMMdd"):r===undefined||r===""?999999999999999:r}function MyWorkOnRenderFinish(n){var t,i,f,r,o,u,e;if(n.id===window.allWorkGridId){MyWorkGrid.resetNoDataRow();t=[];i=[];for(f in n.Cols)n.Cols[f].Type=="Enum"&&t.push(f);for(r=0;r<t.length;r++){for(o in n.Rows)u=n.Rows[o],u.Def.Kind==="Data"&&u.Def.Name==="R"&&(e=u[t[r]],i.indexOf("|"+e)==-1&&i.push("|"+e));n.SetAttribute(n.GetRowById("Filter"),null,t[r]+"Enum",i.join(""),1);i=""}}}function MyWorkOnFocus(n,t){n.id===window.allWorkGridId&&(t.ItemID&&(n.ActionClearSelection(),n.SelectRow(t)),window.RefreshCommandUI())}function MyWorkOnMouseOverOutside(n){n.CurHoverRow&&n.SetAttribute(n.GetRowById(n.CurHoverRow),"Title","ButtonText"," ",1);n.CurHoverRow=""}function MyWorkOnMouseOverRow(n,t){n.CurHoverRow!=t.id&&(n.CurHoverRow&&n.SetAttribute(n.GetRowById(n.CurHoverRow),"Title","ButtonText"," ",1),n.CurHoverRow=t.id,CurrentGrid=n,n.GetValue(t,"ItemID")!=""&&(n.SetAttribute(t,"Title","ButtonText",'<div class="gridmenuspan" style="position:absolute;overflow:visible;margin-right:5px" id="'+t.id+'"><a data-itemid="'+n.GetValue(t,"ItemID")+'" data-listid="'+n.GetValue(t,"ListID")+'" data-webid="'+n.GetValue(t,"WebID")+'" data-siteid="'+n.GetValue(t,"SiteID")+'" ><\/a><\/div>',1),CurrentGrid=n,CurrentRow=t,window.epmLiveNavigation.addContextualMenu($("#"+t.id),[],null,null,{"delete":"GridGanttDeleteRow"})))}function MyWorkOnClick(n,t,i,r,u,f){var o,s,e,c,h;if(n.id===window.allWorkGridId){if(t.Kind==="Header"){for(f.cancelBubble=!0,o=n.Sort.split(","),s=0,e=0;e<o.length;e++)if(c=o[e],c===i){s=1;break}return n.SortClick(i,s),!0}if(MyWorkGrid.loadRibbon(),MyWorkGrid.hidePivotMenu(),$("#MWG_Search").blur(),$("#Ribbon_MyWork_Actions_Search").blur(),i==="WorkingOn")return f.cancelBubble=!0,!0;if(n.EditRow&&StopEditGridRow(n,t),n.RowCount===1&&n.Cols[i].Type!=="Date"&&i!=="Flag"&&i!=="Edit"&&i!=="CommentCount"&&i!=="Priority"&&i!=="Complete"&&t.Kind==="Data"&&t.Def.Name==="R"&&(n.SelectRow(t,!t.Selected),window.RefreshCommandUI()),t.Def.Name==="Group"&&i==="Title")return t.Expanded===1?(n.FRow=null,n.Collapse(t)):n.Expand(t),h=Grids[MyWorkGrid.gridId],h.Update(),h.Render(),!0}}function MyWorkGoToItem(n,t){var u=Grids[n],r=u.GetRowById(t),f,s,e,o,i;CurrentGrid=u;CurrentRow=r;n=GetGridId(u);for(f in newItemLists)if(s=newItemLists[f].ListID,r.ListID.toLowerCase()==s.toLowerCase()){e=newItemLists[f].UsePopUp;break}o=window.epmLiveNavigation.currentWebUrl+"/_layouts/epmlive/gridaction.aspx?action=view&webid="+r.WebID+"&listid="+r.ListID+"&ID="+r.ItemID+"&Source="+escape(location.href);e!=null&&e.toLowerCase()=="true"?(i=window.SP.UI.$create_DialogOptions(),i.url=o,i.width=700,i.allowMaximize=!1,i.showClose=!0,window.SP.UI.ModalDialog.showModalDialog(i)):location.href=o}function GetGridId(n){return n.id.substr(9)}function MyWorkOnGetHtmlValue(n,t,i,r){var u,e,o,f,s;if(n.id===window.allWorkGridId){if(i=="Title"&&t.Def.Name=="R")return"<a href=\"javascript:MyWorkGoToItem('"+n.id+"','"+t.id+"');\">"+r+"<\/a>";if(i==="CommentCount"||i==="Priority"||i==="Flag"||i==="Title"||i==="WorkingOn"){if(t.Def.Name!=="Header"&&t.Def.Name!=="Fixed"&&t.Def.Name!=="Group"){u=r;switch(i){case"CommentCount":r==""?u='<div class="MWG_CommentDisabled">&nbsp;<\/div>':(e="",o=MyWorkGrid.isCommentRead(t),intRegex.test(r)?e=o?"MWG_CommentRead":"MWG_Comment":r.indexOf("Completed")!=-1&&(e=o?"MWG_CommentRead_Completed":"MWG_Comment_Completed",r=r.split("Completed")[1]),u='<div id="MWG_CommentCount_'+t.id+'" class="'+e+'" onclick="showComments(\''+n.id+"','"+t.id+'\');" style="cursor:pointer;"><span class="MWG_CommentCounter">'+r+"<\/span><\/div>");break;case"Priority":f="";intRegex.test(r)||(r=="HighCompleted"?f="high-priority":r=="LowCompleted"?f="low-priority":r.indexOf("Normal")!=-1?f="medium-priority":r.indexOf("High")!=-1?f="high-priority":r.indexOf("Low")!=-1&&(f="low-priority"));f!=""&&(u='<img src="'+iconUrl+f+'.png"/>');break;case"Flag":u='<img src="'+iconUrl+getFlagImage(r)+'.png"/>';break;case"Title":if(n.Cols.CommentCount.Visible==0&&t.CommentCount!=""&&intRegex.test(t.CommentCount)&&t.CommentCount!="0"&&(u+='<div class="MWG_Comment_Small" onclick="showComments(\''+n.id+"','"+t.id+'\');" style="cursor:pointer;">&nbsp;<\/div>'),s="",MyWorkGrid.newItemIndicator.enabled){var h=new Date,c=new Date(h.getFullYear(),h.getMonth(),h.getDate()),l=new Date(c.getFullYear(),c.getMonth(),c.getDate()-(MyWorkGrid.newItemIndicator.days-1)).getTime();t.Created>=l&&(s='<img class="MWG_NewItemIndicator" src="/_layouts/1033/images/new.gif"><\/img>')}t.TitleHtmlPostfix=s;break;case"WorkingOn":u=r===0?'<div id="epmtgs_'+t.id+'" class="epmlive-toggle-switch fui-radio-unchecked" data-state="0" onclick="MyWorkGrid.updateWorkingOn(\''+t.id+"');try { window.event.cancelBubble = true; } catch(e) { }\"><span>&nbsp;<\/span><\/div>":'<div id="epmtgs_'+t.id+'" class="epmlive-toggle-switch fui-radio-checked" data-state="1" onclick="MyWorkGrid.updateWorkingOn(\''+t.id+"');try { window.event.cancelBubble = true; } catch(e) { }\"><span>&nbsp;<\/span><\/div>"}return u}}else{if(t.Def.Name==="Group"&&i!=="Complete")return"";if(n.Cols[i]&&n.Cols[i].Type==="Lines")return r}return null}}function MyWorkOnLoaded(n){var t,u,i,r;n.id===window.allWorkGridId&&(TGSetEvent("OnReady",n.id,MyWorkOnReady),t=window.mwWebPartHeight,t===0&&(u=$.browser.msie?20:5,t=$("#s4-workspace").height()-($("#s4-titlerow").height()+$("#EPMLiveStatusbarTemplate").height()+$("#EPMLiveStatuTemplate").height()+$("#s4-statusbarcontainer").height()+u),$("#MWG_Header").is(":visible")&&(t-=100+($.browser.msie?5:0))),n.MaxVScroll=t,$.browser.msie&&location.href.toLowerCase().indexOf("mywork.aspx")===-1&&$("#EPMMyWorkGrid").css("width",$(document.getElementsByName("_invisibleIfEmpty")[1]).width()),i=$(window),MyWorkGrid.winHeight=i.height(),i.resize(function(){var t=$(this).height(),i=MyWorkGrid.winHeight,r;r=t<i?-(i-t):t-i;r!==0&&(n.MaxVScroll+=r,MyWorkGrid.winHeight=t,n.Update(),n.Render())}),$("html").click(function(){var n=window.Grids[MyWorkGrid.gridId],t=MyWorkGrid.rowBeingEdited;t&&(n.EndEdit(!0),n.HasChanges()?saveRow(n.id,t.id):cancelRowEdit(n.id,t.id),MyWorkGrid.rowBeingEdited=null,n.TotalRowsInEditMode=0)}),MyWorkGrid.resetNoDataRow(),r=(window.location.href+"").toLowerCase(),(r.indexOf("mywork.aspx")!==-1||r.indexOf("my%20work.aspx")!==-1)&&MyWorkGrid.loadRibbon(),n.Lang.Format.DecimalSeparator=window.epmLiveMyWork.regionalSettings.decimalSeparator,n.Lang.Format.GroupSeparator=window.epmLiveMyWork.regionalSettings.groupSeparator)}function MyWorkOnColumnsChanged(n,t){var r,i;if(n.id===window.allWorkGridId){r=n.GetLastCol("1");for(i in t)t[i]&&n.MoveCol(i,r,!0,0)}}function MyWorkOnGetColor(n,t,i,r,u,f){if(n.id===window.allWorkGridId){if(i==="CommentCount"&&(r===230||r===180||r===205||r===255)&&(u===242||u===217||u===230||u===255)&&(f===251||f===243||f===247||f===255)&&t.r0){var e=$(t.r0).find(".MWG_CommentDisabled");e&&(r===230&&u===242&&f===251||r===180&&u===217&&f===243?$(e).html('<div class="MWG_CommentHovered" onclick="showComments(\''+n.id+"','"+t.id+"');\"><\/div>"):$(e).html(""))}return null}}function MyWorkOnGroup(n){n.id===window.allWorkGridId&&window.setTimeout(function(){var n=Grids[MyWorkGrid.gridId];n.Update();n.Render()},500)}function ajaxRequest(){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"],n;if(window.ActiveXObject)for(n=0;n<t.length;n++)try{return new ActiveXObject(t[n])}catch(i){}else if(window.XMLHttpRequest)return new XMLHttpRequest;return!1}function calculateDueColor(n,t){if(n==="Complete"&&(t.Def===undefined||t.Def.Name==="Header"||t.Def.Name==="Fixed"||t.Def.Name==="Group"||t.Def.Name==="Solid"))return"MWG_NoBgImg";var f=t.DueDate,s=t.DueDay,i="";if(s=="Yesterday")i="MWG_OverDue";else if(f!=""){var u=new Date,r=DateToString(f,"M/d/yyyy").split("/"),e=u.getMonth()+1,o=u.getFullYear();r[2]<o?i="MWG_OverDue":r[2]==o&&(r[0]<e?i="MWG_OverDue":r[0]==e&&r[1]<u.getDate()&&(i="MWG_OverDue"))}return(MyWorkGrid.loadingCompletedItems!==undefined||MyWorkGrid.loadingCompletedItems!==null)&&MyWorkGrid.loadingCompletedItems?i===""?"MWG_CompletedRow":"MWG_OverDue_Completed":(i!==""&&n==="Complete"&&(i="MWG_OverDue_Completed"),i===""&&n==="Complete"&&(i="MWG_UnCompletedRow_Normal"),i)}function cancelRowEdit(n,t){var r=Grids[n],i=r.Rows[t],o=i.ListID+i.WebID+i.SiteID,f,e,u;if(i.Complete!=1){i.EditMode=0;r.TotalRowsInEditMode--;r.SetAttribute(i,"Priority","CanEdit",0,!0,!1);setCellValue(i.currentValues.Priority,n,t,"Priority");r.SetAttribute(i,"Title","CanEdit",0,!0,!1);setCellValue(i.currentValues.Title,n,t,"Title");setCellValue(i.currentValues.DueDay,n,t,"DueDay");f=r.ColNames[1];for(e in f)u=f[e],r.ColTypes[o][u]=="Lines"&&(r.SetAttribute(i,u,"Button","",!0,!1),r.SetAttribute(i,u,"OnClickSideButton","return;",!0,!1)),r.SetAttribute(i,u,"CanEdit",0,!0,!1),setCellValue(i.currentValues[u],n,t,u);MyWorkGrid.hideProcessing(t);i.isBeingEdited=!1;MyWorkGrid.rowBeingEdited=null}}function markRowCompleted(n,t){t.CurrentCommentCount=t.CommentCount;t.CommentCount>0&&setCellValue("Completed"+t.CommentCount,n.id,t.id,"CommentCount");t.CurrentPriority=t.Priority;var i=t.Priority;intRegex.test(i)||(i.indexOf("High")!=-1?setCellValue("HighCompleted",n.id,t.id,"Priority"):i.indexOf("Low")!=-1&&setCellValue("LowCompleted",n.id,t.id,"Priority"));t.CurrentFlag=t.Flag;t.Flag==0?setCellValue("UnflaggedCompleted",n.id,t.id,"Flag"):setCellValue("FlaggedCompleted",n.id,t.id,"Flag");updateRowColor(n,t,"#F9F9F9","MWG_CompletedRow",!0);MyWorkGrid.showingCompletedItems||n.RemoveRow(t)}function markRowUnCompleted(n,t){MyWorkGrid.hideProcessing(t.id);setCellValue(t.CurrentCommentCount,n.id,t.id,"CommentCount");setCellValue(t.CurrentPriority,n.id,t.id,"Priority");setCellValue(t.CurrentFlag,n.id,t.id,"Flag");updateRowColor(n,t,"#FFFFFF","",!1);MyWorkGrid.showingCompletedItems&&n.RemoveRow(t)}function updateRowColor(n,t,i,r,u){var f,e,o;for(f in n.Cols)f!=="WorkingOn"&&(e=r,f!=="Complete"&&f!=="CommentCount"&&i!=="#FFFFFF"&&(e="MWG_CompletedLineThrough"),t[f+"Class"]=e,u?f==="Complete"&&(o=calculateDueColor(f,t),e=o==="MWG_OverDue_Completed"?"MWG_CompletedRow_OverDue":"MWG_CompletedRow_Normal",t[f+"Class"]=e):f==="DueDate"||f==="DueDay"?t[f+"Class"]=calculateDueColor(f,t):f==="Complete"&&(o=calculateDueColor(f,t),o!=="MWG_OverDue_Completed"&&(e="MWG_UnCompletedRow_Normal"),t[f+"Class"]=e),n.RefreshCell(t,f))}function changeCompleteStatus(n,t,i){var r,u;if(t.Def.Name!=="Header"&&t.Def.Name!=="Fixed"&&t.Def.Name!=="Group"&&t.Def.Name!=="Solid"){if(t.isBeingEdited){SP.UI.Notify.addNotification("Cannot mark item as complete when in edit mode.",!1);return}MyWorkGrid.showProcessing(t.id);MyWorkGrid.showingCompletedItems&&(MyWorkGrid.loadingCompletedItems=!1);r=n.GetValue(t,i)==0;r?updateRowColor(n,t,"#F9F9F9","MWG_CompletedRow",!0):updateRowColor(n,t,"#FFFFFF","",!1);MyWorkGrid.showProcessing(t.id);u='<MyWorkItem><Item ID="'+t.ItemID+'" /><List ID="'+t.ListID+'" /><Web ID="'+t.WebID+'" /><Site ID="'+t.SiteID+'" URL="'+t.SiteURL+'" /><Fields><Field Name="Complete"><![CDATA['+r+"]\]><\/Field><\/Fields><\/MyWorkItem>";EPMLiveCore.WorkEngineAPI.Execute("UpdateMyWorkItem",u,function(u){var f,o,e;if(u=parseJson(u),responseIsSuccess(u)){t.EditMode==1&&cancelRowEdit(n.id,t.id);setCellValue(r,n.id,t.id,i);f=n.ColNames[1];for(o in f)e=getFieldValue(f[o],u),n.GetAttribute(t,f[o],"Type")==="Date"&&(e=DateToString(e,n.Cols[i].Format)),e!=undefined&&setCellValue(e,n.id,t.id,f[o]);window.setTimeout(function(){MyWorkGrid.hideProcessing(t.id);try{r&&!MyWorkGrid.showingCompletedItems?$.browser.msie?($(t.r0).find("td").fadeOut(800,function(){$(this).parent().remove()}),$(t.r1).find("td").fadeOut(800,function(){$(this).parent().remove()}),$(t.r2).find("td").fadeOut(800,function(){$(this).parent().remove()})):($(t.r0).fadeOut(800),$(t.r1).fadeOut(800),$(t.r2).fadeOut(800)):!r&&MyWorkGrid.showingCompletedItems&&($.browser.msie?($(t.r0).find("td").fadeOut(800,function(){$(this).parent().remove()}),$(t.r1).find("td").fadeOut(800,function(){$(this).parent().remove()}),$(t.r2).find("td").fadeOut(800,function(){$(this).parent().remove()})):($(t.r0).fadeOut(800),$(t.r1).fadeOut(800),$(t.r2).fadeOut(800)))}catch(i){}window.setTimeout(function(){r?markRowCompleted(n,t):markRowUnCompleted(n,t)},850)},250);MyWorkGrid.isDirty=!0}})}}function doActionOnItem(n,t){var u=Grids[n],i=u.FRow,h,r;if(i.tagName!=="I"&&(h=u.GetSelRows(),h.length>0&&(i=h[0])),t=="edit"){if(!MyWorkGrid.leaveConfirmation(u))return;var f=i.ItemID,e=i.ListID,o=i.WebID,s=i.SiteURL;showSharePointPopup(s+"/_layouts/epmlive/gridaction.aspx?action="+t+"&webid="+o+"&listid="+e+"&ID="+f,null,!0,!0,MyWorkGrid.reloadItemData,{grid:u,itemId:f,listId:e,webId:o,siteUrl:s,siteId:i.SiteID,row:i});return}if(t=="comments"){var f=i.ItemID,e=i.ListID,o=i.WebID,s=i.SiteURL;showSharePointPopup(s+"/_layouts/epmlive/myworkgridaction.aspx?action="+t+"&webid="+o+"&listid="+e+"&ID="+f,null,!0,!0,MyWorkGrid.reloadCommentCount,{grid:u,itemId:f,listId:e,webId:o,siteUrl:s,siteId:i.SiteID,row:i},600,500);return}if(t=="delete"){confirm("Are you sure you want to delete this item?")&&(r=new ajaxRequest,r.onreadystatechange=function(){r.readyState==4&&r.status==200&&r.responseText.trim()=="Success"&&(u.RemoveRow(i),SP.UI.Notify.addNotification("Item was deleted successfully.",!1),MyWorkGrid.isDirty=!0)},r.open("GET",i.SiteURL+"/_layouts/epmlive/gridaction.aspx?action=delete&webid="+i.WebID+"&listid="+i.ListID+"&ID="+i.ItemID,!0),r.send(null));return}if(t=="perms"){showSharePointPopup(i.SiteURL+"/_layouts/epmlive/gridaction.aspx?action="+t+"&webid="+i.WebID+"&listid="+i.ListID+"&ID="+i.ItemID+"&gridid="+n+"&rowid="+i.id,null,!0,!0,null);return}showSharePointPopup(i.SiteURL+"/_layouts/epmlive/gridaction.aspx?action="+t+"&webid="+i.WebID+"&listid="+i.ListID+"&ID="+i.ItemID,null,!0,!0,null);return}function editRow(n,t){var i=t.ListID+t.WebID+t.SiteID,r;n.RowPermissions===undefined&&(n.RowPermissions={});n.RowPermissions[i]===undefined?(r='<MyWork><List ID="'+t.ListID+'" /><Web ID="'+t.WebID+'" /><Site ID="'+t.SiteID+'" URL="'+t.SiteURL+'" /><\/MyWork>',EPMLiveCore.WorkEngineAPI.Execute("CheckMyWorkListEditPermission",r,function(r){r=parseJson(r);responseIsSuccess(r)&&(n.RowPermissions[i]=r.Result.MyWork.HasEditPermission==="true"?!0:!1,editRowHelper(n,t))})):editRowHelper(n,t)}function editRowHelper(n,t){var f=n.ColNames[1],r=t.ListID+t.WebID+t.SiteID,i,u,e;if(n.RowPermissions[r])if(t.EditMode===undefined&&(t.EditMode=1),n.TotalRowsInEditMode===undefined&&(n.TotalRowsInEditMode=0),n.TotalRowsInEditMode++,t.isBeingEdited=!0,n.ColTypes==undefined&&(n.ColTypes={}),n.ColTypes[r]==undefined){n.ColTypes[r]={};i='<FieldInfo><Item ID="'+t.ItemID+'" /><List ID="'+t.ListID+'" /><Web ID="'+t.WebID+'" /><Site ID="'+t.SiteID+'" URL="'+t.SiteURL+'" /><Fields>Priority,Title,';for(u in f)i+=f[u]+",";i=i.substring(0,i.length-1);i+="<\/Fields><GuessOriginalFieldName>True<\/GuessOriginalFieldName><\/FieldInfo>";EPMLiveCore.WorkEngineAPI.Execute("IsFieldEditable",i,function(u){var e,o,s;if(u=parseJson(u),responseIsSuccess(u)){e=u.Result.FieldInfo.Fields.Field;i='<MyWork><Item ID="'+t.ItemID+'" /><List ID="'+t.ListID+'" /><Web ID="'+t.WebID+'" /><Site ID="'+t.SiteID+'" URL="'+t.SiteURL+'" /><Fields>';for(o in e)s=e[o]["@Name"],e[o]["@Editable"]=="true"&&(i+=s+",");i=i.substring(0,i.length-1);i+="<\/Fields><GuessOriginalFieldName>True<\/GuessOriginalFieldName><\/MyWork>";EPMLiveCore.WorkEngineAPI.Execute("GetMyWorkGridColType",i,function(i){var u,o,s;if(i=parseJson(i),responseIsSuccess(i)){for(e=i.Result.MyWork.Fields.Field,u=0;u<e.length;u++)o=e[u]["@Name"],s=e[u]["@Type"],n.ColTypes[r][o]=s,n.SetAttribute(t,o,"Type",s,!0,!1),s!=="Lines"&&n.SetAttribute(t,o,"CanEdit",1,!0,!1);editRowFinalizer(n,t,f,r)}})}})}else{for(u in n.ColTypes[r])e=n.ColTypes[r][u],n.SetAttribute(t,u,"Type",e,!0,!1),e!=="Lines"&&n.SetAttribute(t,u,"CanEdit",1,!0,!1);editRowFinalizer(n,t,f,r)}else MyWorkGrid.hideProcessing(t.id),SP.UI.Notify.addNotification("You do not have permission to edit this item.",!1)}function editRowFinalizer(n,t,i,r){var u={},o,s,e,f,h;u.Priority=t.Priority;u.DueDay=t.DueDay;u.Title=t.Title;for(f in i)o=i[f],s=t[o],u[o]=s!=undefined?s:"";t.currentValues=u;e="";for(f in n.ColTypes[r])h=n.ColTypes[r][f],h=="Enum"&&(e+=f+",");e!=""?(dataXml='<MyWork><Item ID="'+t.ItemID+'" /><List ID="'+t.ListID+'" /><Web ID="'+t.WebID+'" /><Site ID="'+t.SiteID+'" URL="'+t.SiteURL+'" /><Fields>'+e,dataXml=dataXml.substring(0,dataXml.length-1),dataXml+="<\/Fields><GuessOriginalFieldName>True<\/GuessOriginalFieldName><\/MyWork>",EPMLiveCore.WorkEngineAPI.Execute("GetMyWorkGridEnum",dataXml,function(i){var r,u,f;if(i=parseJson(i),responseIsSuccess(i)){r=i.Result.MyWork.Fields.Field;for(u in r)f=r[u]["@Name"],n.SetAttribute(t,f,"Enum",r[u]["@Enum"],!0,!1),n.SetAttribute(t,f,"EnumKeys",r[u]["@EnumKeys"],!0,!1),n.SetAttribute(t,f,"Range",r[u]["@Range"],!0,!1);MyWorkGrid.hideProcessing(t.id);MyWorkGrid.rowBeingEdited=t;MyWorkGrid.isDirty=!0}})):(MyWorkGrid.hideProcessing(t.id),MyWorkGrid.rowBeingEdited=t)}function editSaveRow(n,t){var r=Grids[n],i=r.Rows[t];i.Def.Name!=="Header"&&i.Def.Name!=="Fixed"&&i.Def.Name!=="Group"&&i.Complete!=1&&(MyWorkGrid.showProcessing(t),editRow(r,i))}function updateEditColWidth(n,t){(!$.browser.msie||parseInt($.browser.version)>8)&&(n.TotalRowsInEditMode===0?n.SetWidth("Edit",-25):t.isBeingEdited&&n.TotalRowsInEditMode===1&&n.SetWidth("Edit",25))}function emptyFunction(){}function getFieldValue(n,t){for(var r,u=t.Result.MyWorkItem.Fields.Field,i=0;i<u.length;i++)if(r=u[i],r["@Name"]==n)return r["#cdata"];return undefined}function getFlagImage(n){return n=="0"?"unflagged":n=="UnflaggedCompleted"?"unflagged":n=="FlaggedCompleted"?"flagged":"flagged"}function newItemAdded(n,t,i){i.grid.Reload()}function onshowRichTextBoxClosed(n,t,i){n==1&&setCellValue(unescape(t),i.gridId,i.rowId,i.col)}function parseJson(n){return eval("("+xml2json(parseXml(n),"")+")")}function parseXml(n){var t=null;if(window.DOMParser)try{t=(new DOMParser).parseFromString(n,"text/xml")}catch(i){t=null}else if(window.ActiveXObject)try{t=new ActiveXObject("Microsoft.XMLDOM");t.async=!1;t.loadXML(n)}catch(i){t=null}return t}function responseIsSuccess(n){return n.Result["@Status"]==0}function saveRow(n,t){var r=Grids[n],i=r.Rows[t],l=i.ListID+i.WebID+i.SiteID,u,e;if(r.EndEdit(!0),i.EditMode=0,r.TotalRowsInEditMode--,MyWorkGrid.showProcessing(t),i.Complete!=1){var s=i.Priority,h=i.Title,o='<MyWorkItem><Item ID="'+i.ItemID+'" /><List ID="'+i.ListID+'" /><Web ID="'+i.WebID+'" /><Site ID="'+i.SiteID+'" URL="'+i.SiteURL+'" /><Fields><Field Name="Priority"><![CDATA['+s+']\]><\/Field><Field Name="Title"><![CDATA['+h+"]\]><\/Field>",c=r.ColNames[1],f=!1;for(u in c)u=c[u],e=i[u],e!=undefined&&e!=i.currentValues[u]&&(o+='<Field Name="'+u+'"><![CDATA['+e+"]\]><\/Field>",f=!0);if(o+="<\/Fields><\/MyWorkItem>",!f&&(i.currentValues.Priority!==s&&(f=!0),i.currentValues.Title!==h&&(f=!0),!f)){cancelRowEdit(n,t);return}EPMLiveCore.WorkEngineAPI.Execute("UpdateMyWorkItem",o,function(n){var f,e,u;if(n=parseJson(n),responseIsSuccess(n)){r.SetAttribute(i,"Priority","CanEdit",0,!0,!1);newVal=getFieldValue("Priority",n);newVal!=undefined&&setCellValue(newVal,r.id,i.id,"Priority");r.SetAttribute(i,"Title","CanEdit",0,!0,!1);newVal=getFieldValue("Title",n);newVal!=undefined&&setCellValue(newVal,r.id,i.id,"Title");f=r.ColNames[1];for(e in f)u=f[e],newVal=getFieldValue(u,n),r.ColTypes[l][u]=="Lines"&&(r.SetAttribute(i,u,"Button","",!0,!1),r.SetAttribute(i,u,"OnClickSideButton","return;",!0,!1)),newVal!=undefined&&setCellValue(newVal,r.id,i.id,u),r.SetAttribute(i,u,"CanEdit",0,!0,!1);MyWorkGrid.hideProcessing(t);i.isBeingEdited=!1;MyWorkGrid.rowBeingEdited=null;newVal=getFieldValue("DueDay",n);newVal!=undefined&&setCellValue(newVal,r.id,i.id,"DueDay");SP.UI.Notify.addNotification("Item was updated successfully.",!1);MyWorkGrid.isDirty=!0}})}}function setCellValue(n,t,i,r){var u=Grids[t],f=u.Rows[i];u.SetValue(f,r,n,1)}function showRichTextBox(n,t,i){var r=Grids[n],u=r.Rows[t];showSharePointPopup(siteUrl+"/_layouts/epmlive/myworkrichtexteditor.aspx?RichTextValue="+escape(u[i]),i+" Editor",!1,!1,onshowRichTextBoxClosed,{gridId:n,rowId:t,col:i},600,400);return}function showSharePointPopup(n,t,i,r,u,f,e,o){i==null&&(i=!0);r==null&&(r=!0);u==null&&(u=emptyFunction);var s;s=e!==undefined&&o!==undefined?{title:t,allowMaximize:i,showClose:r,url:n,dialogReturnValueCallback:Function.createCallback(Function.createDelegate(null,u),f),width:e,height:o}:{title:t,allowMaximize:i,showClose:r,url:n,dialogReturnValueCallback:Function.createCallback(Function.createDelegate(null,u),f)};SP.UI.ModalDialog.showModalDialog(s)}function updateFlag(n,t,i){var f,u,r,e;if(t.Def.Name==="Header"){f=n.Sort;u=1;f.indexOf("Flag")!==-1&&(u=1,f.indexOf("-Flag")!==-1&&(u=0));n.SortClick("Flag",u);return}if(t.Def.Name!=="Fixed"&&t.Def.Name!=="Group"&&t.Def.Name!=="Solid"&&t.Complete!=1){n.CloseDialog();r="";switch(n.GetValue(t,i)){case 1:r=0;break;case 0:default:r=1}e='<MyPersonalization><Item ID="'+t.ItemID+'" /><List ID="'+t.ListID+'" /><Web ID="'+t.WebID+'" /><Site ID="'+t.SiteID+'" URL="'+t.SiteURL+'" /><Personalizations><Personalization Key="Flag" Value="'+r+'" /><\/Personalizations><\/MyPersonalization>';EPMLiveCore.WorkEngineAPI.Execute("SetMyPersonalization",e,function(u){u=parseJson(u);responseIsSuccess(u)&&setCellValue(r,n.id,t.id,i)})}}function showComments(n,t){var i=Grids[n],r=i.Rows[t];i.Focus(r,"CommentCount",null,!1);doActionOnItem(n,"comments")}var iconUrl="/_layouts/epmlive/images/mywork/",intRegex=/^\d+$/,leaveMessage="You are currently in the edit mode. If you choose to proceed, all your changes will be lost.",CurrentGrid,CurrentRow,MyWorkGrid,Base64;window.onbeforeunload=confirmPageLeave;MyWorkGrid={gridId:null,defaultView:null,defaultViewId:null,isDefaultViewPersonal:!1,views:{},viewsLoaded:!1,filtersOn:!1,groupingOn:!1,showingCompletedItems:!1,loadingCompletedItems:!1,rowBeingEdited:null,lastClickedCell:null,tagId:null,showMeFilters:null,isDirty:!0,showMeFilterApplied:!1,lastFilter:null,headerToolbarConfigured:!1,searchWatermark:"Find an item",workFiltersConfigured:!1,workFilters:{daysAgoEnabled:null,daysAgo:null,daysAfterEnabled:null,daysAfter:null},newItemIndicator:{enabled:!0,days:2},showSelectColoumnsDialog:function(){Grids[MyWorkGrid.gridId].ActionShowColumns("Selectable")},loadViews:function(){var n=window.epmLive;$.ajax({type:"POST",url:n.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",async:!1,data:"{ Function: 'GetMyWorkGridViews', Dataxml: '' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var i,c,u,f,e,r,t;if(n=parseJson(n.d),responseIsSuccess(n)){if(n.Result.MyWork.Views!==null&&(i=n.Result.MyWork.Views.View,i.length>0||i["@ID"]!==undefined)){i["@ID"]!==undefined&&(r=i,i=[],Array.add(i,r));for(r in i){t=i[r];MyWorkGrid.views[t["@ID"]]={};var l=t["@Name"],o=t["@ID"],s=!1,h=!1;t["@Type"]==="Personal"&&(s=!0);t["@Default"]==="true"&&(h=!0);MyWorkGrid.views[o]={id:o,name:l,isDefault:h,isPersonal:s,hasPermission:!0,leftCols:t["@LeftCols"],cols:t["@Cols"],rightCols:t["@RightCols"],filters:t["@Filters"],grouping:t["@Grouping"],sorting:t["@Sorting"]}}if(requestedView!==""){requestedView=Base64.decode(requestedView).toLowerCase();requestedViewType===""?requestedViewType="global":(requestedViewType=Base64.decode(requestedViewType).toLowerCase(),requestedViewType!=="personal"&&(requestedViewType="global"));for(c in MyWorkGrid.views)u=MyWorkGrid.views[c],u.name.toLowerCase()===requestedView&&u.isPersonal===(requestedViewType==="personal")&&(masterView=u.id)}if(masterView===""){f="";e="dv";for(r in MyWorkGrid.views)if(t=MyWorkGrid.views[r],t.isDefault&&MyWorkGrid.defaultViewId!==t.id)if(t.isPersonal){if(f=t.id,f!==""){MyWorkGrid.applyView(f);break}}else if(e=t.id,e!==""){MyWorkGrid.applyView(e);break}}else MyWorkGrid.applyView(masterView)}MyWorkGrid.viewsLoaded=!0;RefreshCommandUI()}},error:function(t){n.log(t)}})},applyView:function(n){var b,c,k,u,l,d,a,g,s,nt,tt,v,it,h,rt,y,o,ut,r,ft,p,et,w,ot,st,f;try{if(MyWorkGrid.defaultViewId===n)return;var t=Grids[MyWorkGrid.gridId],e=[],i=MyWorkGrid.views[n];if(i.leftCols!==null)for(b=i.leftCols.split(","),c=0;c<b.length;c++){k=b[c].split(":");u=k[0];Array.add(e,u);try{l=k[1]-MyWorkGrid.getColWidth(u);u==="Edit"&&$.browser.msie&&parseInt($.browser.version)<=8&&(l=23);l!==0&&u!=="Title"&&t.SetWidth(u,l)}catch(ht){}t.MoveCol(u,0,1,1)}if(i.cols!==null)for(d=i.cols.split(","),a=0;a<d.length;a++){g=d[a].split(":");s=g[0];Array.add(e,s);try{nt=g[1]-MyWorkGrid.getColWidth(s);nt!==0&&t.SetWidth(s,nt)}catch(ht){}t.MoveCol(s,2,1,1)}if(i.rightCols!==null)for(tt=i.rightCols.split(","),v=0;v<tt.length;v++){it=tt[v].split(":");h=it[0];Array.add(e,h);try{rt=it[1]-MyWorkGrid.getColWidth(h);rt!==0&&t.SetWidth(h,rt)}catch(ht){}t.MoveCol(h,2,1,1)}for(t.Update(),t.Render(),y=t.Group.split(","),t.DoGrouping(null),r=0;r<y.length;r++)t.HideCol(y[r]);for(o=t.GetCols("Visible"),o=o.concat(y),ut=[],r=0;r<o.length;r++){for(ft=!1,p=0;p<e.length;p++)e[p]===o[r]&&(ft=!0);ft||ut.push(o[r])}t.ChangeColsVisibility(e,ut,0);i.filters===""?t.ChangeFilter("","","",0,0,null):(et=i.filters.split("|"),et[0]==="1"?MyWorkGrid.showFilters():MyWorkGrid.hideFilters(),w=et[1].split(":"),t.ChangeFilter(w[0],w[1],w[2],0,0,null));t.ChangeSort(i.sorting);i.grouping===""?t.DoGrouping(null):(ot=i.grouping.split("|"),ot[0]==="1"?MyWorkGrid.showGrouping():MyWorkGrid.hideGrouping(),t.DoGrouping(ot[1]));t.TotalRowsInEditMode===undefined?t.TotalRowsInEditMode=0:t.TotalRowsInEditMode>0&&MyWorkGrid.getColWidth("Edit")===25&&t.SetWidth("Edit",25);MyWorkGrid.defaultViewId=n;MyWorkGrid.defaultView=i.name;MyWorkGrid.isDefaultViewPersonal=i.isPersonal;for(st in t.Rows)(f=t.Rows[st],f.Def.Name!=="Header"&&f.Def.Name!=="Fixed"&&f.Def.Name!=="Group"&&f.Def.Name!=="Solid")&&t.GetValue(f,"Complete")===1&&markRowCompleted(t,f);RefreshCommandUI();window.setTimeout(function(){$("#EPMMyWorkGrid").css("overflow","visible");$(".s4-wpTopTable").css("border","none")},10)}catch(ht){}},getColWidth:function(n){var t=Grids[MyWorkGrid.gridId].Cols[n].Width;return intRegex.test(t)||t.indexOf("-")!=-1&&(t=t.split("-")[0]),+t},populateViews:function(){var n=new Sys.StringBuilder,i,r,t;if(n.append("<Menu Id='Ribbon.MyWork.Views.Dropdown.Menu'>"),n.append("<MenuSection DisplayMode='Menu' Id='Ribbon.MyWork.Views.Dropdown.Menu.Default' Title='Current View'>"),n.append("<Controls Id='Ribbon.MyWork.Views.Dropdown.Menu.Default.Controls'>"),n.append("<Button Id='Ribbon.MyWork.views."+MyWorkGrid.defaultViewId+"' Command='MyWork.Cmd.CurrentViewDropDown.Select' LabelText=\""+MyWorkGrid.defaultView+"\" CommandValueId='"+MyWorkGrid.defaultViewId+"'/>"),n.append("<\/Controls>"),n.append("<\/MenuSection>"),MyWorkGrid.views!==undefined){i=MyWorkGrid.views;n.append("<MenuSection DisplayMode='Menu' Id='Ribbon.MyWork.Views.Dropdown.Menu.Global' Title='Global Views'>");n.append("<Controls Id='Ribbon.MyWork.Views.Dropdown.Menu.Global.Controls'>");for(r in i)t=i[r],t.name!==undefined&&(t.isPersonal||n.append("<Button Id='Ribbon.MyWork.views."+t.id+"' Command='MyWork.Cmd.CurrentViewDropDown.Select' LabelText=\""+t.name+"\" CommandValueId='"+t.id+"'/>"));n.append("<\/Controls>");n.append("<\/MenuSection>");n.append("<MenuSection DisplayMode='Menu' Id='Ribbon.MyWork.Views.Dropdown.Menu.Personal' Title='Personal Views'>");n.append("<Controls Id='Ribbon.MyWork.Views.Dropdown.Menu.Personal.Controls'>");for(r in i)t=i[r],t.name!==undefined&&t.isPersonal&&n.append("<Button Id='Ribbon.MyWork.views."+t.id+"' Command='MyWork.Cmd.CurrentViewDropDown.Select' LabelText=\""+t.name+"\" CommandValueId='"+t.id+"'/>");n.append("<\/Controls>");n.append("<\/MenuSection>")}return n.append("<\/Menu>"),n.toString()},saveView:function(n){var i=Grids[MyWorkGrid.gridId],t,r;i.StaticCursor=0;i.ActionBlur();t=document.createElement("div");t.innerHTML=document.getElementById("MWG_SaveView").innerHTML;(n==!1||n==undefined)&&(t.children[0].children[0].value=MyWorkGrid.defaultView);MyWorkGrid.views[MyWorkGrid.defaultViewId].isDefault&&(t.children[0].children[2].checked=!0);t.children[0].children[4].checked=MyWorkGrid.isDefaultViewPersonal=="true"||MyWorkGrid.isDefaultViewPersonal==!0?!0:!1;r={html:t,width:250,height:125,title:"Save View",dialogReturnValueCallback:MyWorkGrid.onSaveViewClose};SP.UI.ModalDialog.showModalDialog(r);n==!0&&t.children[0].children[0].focus()},onSaveViewClose:function(n,t){var a,o,i,r,v,l,e,b,u,y,p,k,d;if(n===SP.UI.DialogResult.OK){if(a=!0,t==!1?a=!1:(o=t.split("|"),i=o[0],i=i.replace(/^\s+|\s+$/,""),i.trim().length==0&&(a=!1)),a==!1){alert("Please enter view name - view names cannot be blank.");MyWorkGrid.saveView(!0);return}r="dv";i!=="Default View"&&(r=MD5(i.toLowerCase()));var g=o[1],w=o[2],nt=o[3],f=Grids[MyWorkGrid.gridId];if(f.StaticCursor=1,MyWorkGrid.validateViewName(r,i,"overwrite")){var s="",h="",c="",tt=f.GetCols("Visible");for(v=0;v<tt.length;v++)l=tt[v],e=f.Cols[l],e.Sec===0?s+=","+l+":"+e.Width:e.Sec===1?h+=","+l+":"+e.Width:e.Sec===2&&(c+=","+l+":"+e.Width);try{s=s.substr(1)}catch(ft){}try{h=h.substr(1)}catch(ft){}try{c=c.substr(1)}catch(ft){}MyWorkGrid.views[r]===undefined&&(MyWorkGrid.views[r]={});b=f.GetRowById("Filter");u="";for(y in f.Cols)p=b[y+"Filter"],p!==undefined&&p!==0&&(u+=","+y+":"+b[y]+":"+p);u.length>0&&(u=u.substr(1));k=0;MyWorkGrid.filtersOn&&(k=1);u=k+"|"+u;d=0;MyWorkGrid.groupingOn&&(d=1);var it=d+"|"+f.Group,rt=f.Sort,ut='<MyWork><View ID="'+r+'" Name="'+i+'" Default="'+g+'" Personal="'+w+'" HasPermission="'+nt+'" LeftCols="'+s+'" Cols="'+h+'" RightCols="'+c+'" Filters="'+u+'" Grouping="'+it+'" Sorting="'+rt+'"/><\/MyWork>';EPMLiveCore.WorkEngineAPI.Execute("SaveMyWorkGridView",ut,function(n){n=parseJson(n);responseIsSuccess(n)&&(MyWorkGrid.defaultViewId=r,MyWorkGrid.defaultView=i,MyWorkGrid.isDefaultViewPersonal=w,MyWorkGrid.views[r]={id:r,name:i,isDefault:g==="true"?!0:!1,isPersonal:w==="true"?!0:!1,hasPermission:nt==="true"?!0:!1,leftCols:s,cols:h,rightCols:c,filters:u,grouping:it,sorting:rt},RefreshCommandUI())})}}},validateViewName:function(n,t,i){return MyWorkGrid.views[n]!==undefined?confirm("Would you like to "+i+' the "'+t+'" view?'):!0},getSavingViewInfo:function(n,t){return n.parentNode.children[0].value?n.parentNode.children[0].value+"|"+n.parentNode.children[2].checked+"|"+n.parentNode.children[4].checked+"|"+t:!1},renameView:function(){var t,n,i;if(MyWorkGrid.defaultViewId==="dv"){alert('The default view cannot be renamed. If you want to create a new view that will act as the default for all users, select the Default View and click "Save View" - this will let you create a new view from the Default View schema.');return}t=Grids[MyWorkGrid.gridId];t.StaticCursor=0;t.ActionBlur();n=document.createElement("div");n.innerHTML=document.getElementById("MWG_RenameView").innerHTML;n.children[0].children[0].innerHTML="<strong>"+MyWorkGrid.defaultView+"<\/strong>";i={html:n,width:280,height:115,title:"Rename View",dialogReturnValueCallback:MyWorkGrid.onRenameViewClose};SP.UI.ModalDialog.showModalDialog(i);n.children[0].children[4].focus()},onRenameViewClose:function(n,t){var i,e,r,o,s,u,f,h,c;if(n===SP.UI.DialogResult.OK){if(i=!0,t==!1?i=!1:(e=t.split("|"),r=e[0],r=r.replace(/^\s+|\s+$/,""),r.trim().length==0&&(i=!1)),i==!1){alert("Please enter a view name - view names cannot be blank.");MyWorkGrid.renameView(!0);return}if(o=t.replace(/^\s+|\s+$/,""),o.length==0)return!1;for(s in MyWorkGrid.views)if(u=MyWorkGrid.views[s],u.isPersonal===MyWorkGrid.isDefaultViewPersonal&&u.name===t){f="Personal";u.isPersonal||(f="Global");alert('The "'+t+'" view already exists in the '+f+" group.");return}h=Grids[MyWorkGrid.gridId];h.StaticCursor=1;MyWorkGrid.validateViewName(MyWorkGrid.defaultViewId,MyWorkGrid.defaultView,"rename")&&(c='<MyWork><View ID="'+MyWorkGrid.defaultViewId+'" Name="'+t+'" Personal="'+MyWorkGrid.isDefaultViewPersonal+'"/><\/MyWork>',EPMLiveCore.WorkEngineAPI.Execute("RenameMyWorkGridView",c,function(n){n=parseJson(n);responseIsSuccess(n)&&(MyWorkGrid.defaultView=t,MyWorkGrid.views[MyWorkGrid.defaultViewId].name=t,RefreshCommandUI())}))}},deleteView:function(){if(MyWorkGrid.defaultViewId==="dv"){alert("You cannot delete the Default View");return}if(MyWorkGrid.validateViewName(MyWorkGrid.defaultViewId,MyWorkGrid.defaultView,"delete")){var n='<MyWork><View ID="'+MyWorkGrid.defaultViewId+'" Default="'+MyWorkGrid.views[MyWorkGrid.defaultViewId].isDefault+'" Personal="'+MyWorkGrid.isDefaultViewPersonal+'"/><\/MyWork>';EPMLiveCore.WorkEngineAPI.Execute("DeleteMyWorkGridView",n,function(n){n=parseJson(n);responseIsSuccess(n)&&(delete MyWorkGrid.views[MyWorkGrid.defaultViewId],MyWorkGrid.applyView("dv"))})}},toggleFilters:function(){MyWorkGrid.filtersOn?MyWorkGrid.hideFilters():MyWorkGrid.showFilters();var n=Grids[MyWorkGrid.gridId];return n.Update(),n.Render(),MyWorkGrid.filtersOn},showFilters:function(){var n=Grids[MyWorkGrid.gridId];MyWorkGrid.filtersOn=!0;n.ShowRow(n.GetRowById("Filter"))},hideFilters:function(){var n=Grids[MyWorkGrid.gridId];MyWorkGrid.filtersOn=!1;n.HideRow(n.GetRowById("Filter"))},toggleGrouping:function(){MyWorkGrid.groupingOn?MyWorkGrid.hideGrouping():MyWorkGrid.showGrouping();var n=Grids[MyWorkGrid.gridId];return n.Update(),n.Render(),MyWorkGrid.groupingOn},showGrouping:function(){var n=Grids[MyWorkGrid.gridId],t;MyWorkGrid.groupingOn=!0;t=n.GetRowById("AR2")||n.GetRowById("AR1");n.ShowRow(t)},hideGrouping:function(){var n=Grids[MyWorkGrid.gridId],t;MyWorkGrid.groupingOn=!1;t=n.GetRowById("AR2")||n.GetRowById("AR1");n.HideRow(t)},canHandleRibbonCommand:function(){var i,n,t;try{return(i=Grids[MyWorkGrid.gridId],n=i.FRow,n&&n.Def||(t=i.GetSelRows(),t&&t.length>0&&(n=t[0])),n===undefined||n===null||n.Def.Name==="Header"||n.Def.Name==="Fixed"||n.Def.Name==="Group")?!1:!0}catch(r){}return!1},clearSort:function(){Grids[MyWorkGrid.gridId].ChangeSort("DueDate")},toggleCompletedItems:function(){return MyWorkGrid.showingCompletedItems?MyWorkGrid.hideCompletedItems():MyWorkGrid.showCompletedItems(),MyWorkGrid.showingCompletedItems},showCompletedItems:function(){MyWorkGrid.showingCompletedItems=!0;MyWorkGrid.loadingCompletedItems=!0;MyWorkGrid.defaultViewId=null;var t=Grids[MyWorkGrid.gridId],n=t.Source;n.Data.Param.Dataxml=completeQuery;n.Layout.Param.Dataxml=completeQuery;t.Reload(n,null,!1);MyWorkGrid.isDirty=!0;MyWorkGrid.changeToolbarSelection("Completed");$("#MWG_Pivot_Selector").show();try{$(".GSNoDataRow").find("div").html("You do not have any completed work items.");$("#MWG_Pivot_Selector").hide()}catch(i){}},hideCompletedItems:function(){MyWorkGrid.showingCompletedItems=!1;MyWorkGrid.loadingCompletedItems=!1;MyWorkGrid.defaultViewId=null;var t=Grids[MyWorkGrid.gridId],n=t.Source;n.Data.Param.Dataxml=nonCompleteQuery;n.Layout.Param.Dataxml=nonCompleteQuery;t.Reload(n,null,!1);MyWorkGrid.isDirty=!0;MyWorkGrid.changeToolbarSelection("Active");$("#MWG_Pivot_Selector").show();try{$(".GSNoDataRow").find("div").html("There are no active work items assigned to you.");$("#MWG_Pivot_Selector").hide()}catch(i){}},reloadCommentCount:function(n,t,i){var r='<ListItem><Item ID="'+i.itemId+'" /><List ID="'+i.listId+'" /><Web ID="'+i.webId+'" /><Site ID="'+i.siteId+'" URL="'+i.siteUrl+'" /><\/ListItem>';EPMLiveCore.WorkEngineAPI.Execute("GetListItem",r,function(n){var s,t,r;if(n=parseJson(n),responseIsSuccess(n)){var u=n.Result.ListItem.Fields.Field,f=i.row.CommentCount,e=i.row.Commenters,o=i.row.CommentersRead;for(s in u)t=u[s],t["@Name"]==="CommentCount"&&(f=t["#cdata"]),t["@Name"]==="Commenters"&&(e=t["#cdata"]),t["@Name"]==="CommentersRead"&&(o=t["#cdata"]);setCellValue(f,i.grid.id,i.row.id,"CommentCount");setCellValue(e,i.grid.id,i.row.id,"Commenters");setCellValue(o,i.grid.id,i.row.id,"CommentersRead");r="MWG_CommentRead";i.row.Complete===1&&(markRowCompleted(i.grid,i.row),r="MWG_CommentRead_Completed");try{document.getElementById("MWG_CommentCount_"+i.row.id).className=r}catch(h){}}})},reloadItemData:function(n,t,i){var r='<MyWork><Item ID="'+i.itemId+'" /><List ID="'+i.listId+'" /><Web ID="'+i.webId+'" /><Site ID="'+i.siteId+'" URL="'+i.siteUrl+'" /><\/MyWork>';EPMLiveCore.WorkEngineAPI.Execute("GetMyWorkListItem",r,function(n){var c,u,t,f,e,o;if(n=parseJson(n),responseIsSuccess(n)){var s=n.Result.MyWork.Fields.Field,r=!1,h="MWG_CommentDisabled";for(c in s)u=s[c],t=u["@Name"],i.row[t]!==undefined&&(f=u["#cdata"],t==="Complete"?f==="True"?(setCellValue(1,i.grid.id,i.row.id,"Complete"),r=!0):setCellValue(0,i.grid.id,i.row.id,"Complete"):setCellValue(f,i.grid.id,i.row.id,t));e=i.row.CommentCount;o=MyWorkGrid.isCommentRead(i.row);(e!==undefined||e!=="")&&(h=r?o?"MWG_CommentRead_Completed":"MWG_Comment_Completed":o?"MWG_CommentRead":"MWG_Comment");try{document.getElementById("MWG_CommentCount_"+i.row.id).className=h}catch(l){}r&&markRowCompleted(i.grid,i.row);SP.UI.Notify.addNotification("Item was updated successfully.",!1)}})},populateNewItemListButton:function(){var n=new Sys.StringBuilder,i,t;n.append("<Menu Id='Ribbon.MyWork.NewItem.Menu'>");n.append("<MenuSection DisplayMode='Menu32' Id='Ribbon.MyWork.NewItem.Menu.Lists' Title=' '>");n.append("<Controls Id='Ribbon.MyWork.NewItem.Menu.Lists.Controls'>");for(i in newItemLists)t=newItemLists[i].Name,n.append("<Button Id='Ribbon.MyWork.NewItem."+t+"' Command='MyWork.Cmd.NewItem' CommandValueId='"+t+"' LabelText='"+t+" Item' Description='Create a new "+t+" item.' Image32by32='/_layouts/1033/images/formatmap32x32.png' CommandType='OptionSelection' Image32by32Top='-160' Image32by32Left='-384'/>");return n.append("<\/Controls>"),n.append("<\/MenuSection>"),n.append("<\/Menu>"),n.toString()},canHandleNewItemRibbonCommand:function(){return newItemLists.length>0},addNewItem:function(n){var i,r,t;if(n!==undefined){if(i=Grids[MyWorkGrid.gridId],!MyWorkGrid.leaveConfirmation(i))return;for(r in newItemLists)t=newItemLists[r],n===t.Name&&(t.Rollup?document.location.href=siteUrl+"/_layouts/epmlive/newitem.aspx?List="+n+"&Source="+document.location.href:showSharePointPopup(siteUrl+"/_layouts/epmlive/myworkgridaction.aspx?action=new&webid="+currentWebId+"&listname="+n,null,!0,!0,MyWorkGrid.fullReload))}},goToWorkspace:function(){var n=Grids[MyWorkGrid.gridId],t=n.FRow;MyWorkGrid.leaveConfirmation(n)&&(document.location.href=siteUrl+"/_layouts/epmlive/gridaction.aspx?action=workspace&webid="+t.WebID+"&Source="+document.location.href)},canHandleApproveRejectCommand:function(){var i,n,t,r;try{if(i=Grids[MyWorkGrid.gridId],n=i.FRow,n&&n.Def||(t=i.GetSelRows(),t&&t.length>0&&(n=t[0])),n===undefined||n===null||n.Def.Name==="Header"||n.Def.Name==="Fixed"||n.Def.Name==="Group")return!1;r='<ListItems><ListItem><Item ID="'+n.ItemID+'" /><List ID="'+n.ListID+'" /><Web ID="'+n.WebID+'" /><Site ID="'+n.SiteID+'" URL="'+n.SiteURL+'" /><\/ListItem><\/ListItems>';EPMLiveCore.WorkEngineAPI.Execute("IsModerationEnabled",r,function(n){return(n=parseJson(n),responseIsSuccess(n))?n.Result.ListItems.ListItem.ModerationEnabled==="true":!1})}catch(u){}return!1},leaveConfirmation:function(n){var i,t;if(n.TotalRowsInEditMode>0){if(confirm(leaveMessage+" Are you sure you want to proceed?")){for(i in n.Rows)(t=n.Rows[i],t.Def.Name!=="Header"&&t.Def.Name!=="Fixed"&&t.Def.Name!=="Group"&&t.Def.Name!=="Solid")&&t.isBeingEdited&&cancelRowEdit(n.id,t.id);return!0}return!1}return!0},isCommentRead:function(n){var t=n.CommentersRead,i,r;if(intRegex.test(t)){if(t===userId)return!0}else if(t.indexOf(",")!==-1){i=t.split(",");for(r in i)if(parseInt(i[r])===userId)return!0}return!1},fullReload:function(){MyWorkGrid.showingCompletedItems?MyWorkGrid.showCompletedItems():MyWorkGrid.hideCompletedItems()},resetNoDataRow:function(){var n=document.getElementById(MyWorkGrid.gridId),t;if(n!==null&&(t=n.firstChild,!Grids[MyWorkGrid.gridId].GetFirstVisible())){n.removeChild(t);var r=n.insertRow(0),u=r.insertCell(0),i="There are no active work items assigned to you.";MyWorkGrid.showingCompletedItems&&(i="You do not have any completed work items.");u.innerHTML=i;MyWorkGrid.noDataResetCompleted=!0}},showProcessing:function(n){$("#MWG_Processing_"+n).show()},hideProcessing:function(n){$("#MWG_Processing_"+n).hide()},updateWorkingOn:function(n){var i=Grids[MyWorkGrid.gridId].GetRowById(n),t=$("#epmtgs_"+n),f=$(t.find("span")[0]),u,r;t.data("state")?(t.data("state",0),t.removeClass("fui-radio-checked"),t.addClass("fui-radio-unchecked"),f.html("&nbsp;"),i.WorkingOn=0):(t.data("state",1),t.removeClass("fui-radio-unchecked"),t.addClass("fui-radio-checked"),f.html("&nbsp;"),i.WorkingOn=1);u="{ Function: 'TagManager_AddTagOrder', Dataxml: '<TagOrder ListId=\""+i.ListID+'" ItemId="'+i.ItemID+'" TagId="'+MyWorkGrid.tagId+"\"/>' }";i.WorkingOn===0&&(u="{ Function: 'TagManager_RemoveTagOrder', Dataxml: '<TagOrder ListId=\""+i.ListID+'" ItemId="'+i.ItemID+'" TagId="'+MyWorkGrid.tagId+"\"/>' }");r=window.epmLive;$.ajax({type:"POST",url:r.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:u,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var i=r.parseJson(n.d),t=i.Result;r.responseIsSuccess(t)||r.logFailure(t)}else r.log("response.d: "+n.d)},error:function(n){r.log(n)}})},configureTag:function(){var n=window.epmLive,t=function(){$.ajax({type:"POST",url:n.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",async:!1,data:"{ Function: 'TagManager_GetTag', Dataxml: '<Tag Type=\"1\"/>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(t.d){var r=n.parseJson(t.d),i=r.Result;n.responseIsSuccess(i)?i.Tag&&(MyWorkGrid.tagId=i.Tag["@Id"]):n.logFailure(i)}else n.log("response.d: "+t.d)},error:function(t){n.log(t)}})},i=function(){$.ajax({type:"POST",url:n.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",async:!1,data:"{ Function: 'TagManager_RegisterTag', Dataxml: '<Tag Name=\"WorkingOn\" Type=\"1\"/>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(t.d){var r=n.parseJson(t.d),i=r.Result;n.responseIsSuccess(i)?i.Tag&&(MyWorkGrid.tagId=i.Tag["@Id"]):n.logFailure(i)}else n.log("response.d: "+t.d)},error:function(t){n.log(t)}})};t();MyWorkGrid.tagId||i()},performSearch:function(n){var f=Grids[MyWorkGrid.gridId],r=[$("#Ribbon_MyWork_Actions_Search"),$("#MWG_Search")],i,t,u;if(n)for(f.ChangeFilter("TitleLower",n.toLowerCase(),11,0,1,null),t=0;t<r.length;t++)i=r[t],i.removeClass("MWG_SearchProcessing"),i.addClass("MWG_SearchClose");else for(f.ChangeFilter("TitleLower","",0,0,1,null),t=0;t<r.length;t++)i=r[t],i.removeClass("MWG_SearchProcessing"),i.removeClass("MWG_SearchClose"),i.val("");u=Grids[MyWorkGrid.gridId];u.Update();u.Render()},configureRibbon:function(){var n=function(){if(!MyWorkGrid.searchConfigured){var n=$("#Ribbon_MyWork_Actions_Search");n.length&&(MyWorkGrid.configureSearch(n),MyWorkGrid.searchConfigured=!0)}},t=function(){var n,t,i,r,u;if(!MyWorkGrid.workFiltersConfigured&&document.getElementById("Ribbon_MyWork_WorkFilter_DueAgoDays")){for(window.workFilters.daysAgo<=0&&(window.workFilters.daysAgo=""),window.workFilters.daysAfter<=0&&(window.workFilters.daysAfter=""),MyWorkGrid.workFilters=window.workFilters,n=0;n<2;n++)for(t=$(document.getElementById("Ribbon.MyWorkTab.MyWorkGroupWorkFilter-MyWorkLayout-"+n)),t.css("display","block"),t.css("margin-top","5px"),t.css("margin-bottom","5px"),t.css("background-position","center right"),i=0;i<3;i++)$(document.getElementById("Ribbon.MyWorkTab.MyWorkGroupWorkFilter-MyWorkLayout-"+n+"-"+i)).css("display","inline");r=$("#Ribbon_MyWork_WorkFilter_DueAgo-Medium-checkbox");r.change(function(){MyWorkGrid.workFilters.daysAgoEnabled=r.is(":checked");window.RefreshCommandUI()});u=$("#Ribbon_MyWork_WorkFilter_DueAfter-Medium-checkbox");u.change(function(){MyWorkGrid.workFilters.daysAfterEnabled=u.is(":checked");window.RefreshCommandUI()});$(document.getElementById("Ribbon_MyWork_WorkFilter_DueAgoDays")).val(MyWorkGrid.workFilters.daysAgo);$(document.getElementById("Ribbon_MyWork_WorkFilter_DueAfterDays")).val(MyWorkGrid.workFilters.daysAfter);MyWorkGrid.workFiltersConfigured=!0}};n();t()},configureToolbar:function(){var n=function(){$("#MWG_Pivot").find(".mwg-menuitem").each(function(){$(this).click(function(){var t=$(this),n;t.hasClass("selected")||(n=t.data("filter"),n==="active"?(MyWorkGrid.hidePivotMenu(),MyWorkGrid.hideCompletedItems(),window.RefreshCommandUI()):n==="completed"?(MyWorkGrid.hidePivotMenu(),MyWorkGrid.showCompletedItems(),window.RefreshCommandUI()):n==="7days"&&(MyWorkGrid.filter("7","Due"),MyWorkGrid.changeToolbarSelection("Seven")))})});$("#MWG_Pivot_Selector").click(function(){var n=$("#MWG_PivotMenu_wrap"),t=function(){var f,i,t,r,u,e,o;for(MyWorkGrid.buildShowMeFilters(),f=[{element:"MWG_WorkType_Menu",action:"Work0000Type",values:MyWorkGrid.showMeFilters.workType},{element:"MWG_CreatedBy_Menu",action:"Author",values:MyWorkGrid.showMeFilters.createdBy},{element:"MWG_Priority_Menu",action:"Priority",values:MyWorkGrid.showMeFilters.priority},{element:"MWG_Status_Menu",action:"StatusFC",values:MyWorkGrid.showMeFilters.status},{element:"MWG_Flag_Menu",action:"Flag",values:["Flagged","Not Flagged"]},{element:"MWG_Due_Menu",action:"Due",values:["Next 7 days","Next 14 days","Next 30 days"]}],i=0;i<f.length;i++)for(t=f[i],r=0;r<t.values.length;r++)u=t.values[r],e=u,t.action==="Flag"&&(e=u==="Flagged"?1:0),$("#"+t.element).append('<li data-col="'+t.action+'" data-value="'+e+'">'+u+"<\/li>");$($("#MWG_PivotMenu").find(".mwg-submenu")).each(function(){$($(this).find("li")).each(function(){$(this).click(function(){var n=$(this);MyWorkGrid.filter(n.data("value"),n.data("col"))})});$(this).parent().hide()});MyWorkGrid.showMeFilterApplied?$(".mwg-mi-clear").show():$(".mwg-mi-clear").hide();o=$("#MWG_Pivot_Selector").offset().left;o-=$("#epm-nav-sub").is(":visible")?230:50;n.css("left",o);n.show()};n.is(":visible")||(MyWorkGrid.hidePivotMenu(),t())});$("#MWG_PivotClose").click(function(){MyWorkGrid.hidePivotMenu()});$(".mwg-smi").hover(function(){$($(this).find(".mwg-submenu-wrap")).show()},function(){$($(this).find(".mwg-submenu-wrap")).hide()});$(".mwg-mi-clear").click(function(){MyWorkGrid.clearFilter()})},t=function(){MyWorkGrid.configureSearch($("#MWG_Search"))};n();t()},buildShowMeFilters:function(){var e,n;if(MyWorkGrid.isDirty||!MyWorkGrid.showMeFilters){var t=Grids[MyWorkGrid.gridId],i=[],r=[],u=[],f=[];for(e in t.Rows)if(t.Rows.hasOwnProperty(e)&&(n=t.Rows[e],n.Def.Kind==="Data"&&n.Def.Name==="R")){var o=n.Work0000Type,s=n.Author,h=n.Priority,c=n.StatusFC;$.inArray(o,i)===-1&&i.push(o);$.inArray(s,r)===-1&&r.push(s);$.inArray(h,u)===-1&&u.push(h);$.inArray(c,f)===-1&&f.push(c)}MyWorkGrid.showMeFilters={workType:i.sort(),createdBy:r.sort(),priority:u.sort(),status:f.sort()};MyWorkGrid.isDirty=!1}},populateShowMe:function(){var i=function(n){var t="",i="A".charCodeAt(0);do n--,t=String.fromCharCode(i+n%26)+t,n=n/26>>0;while(n>0);return t},r=function(n,t){t=t.toUpperCase();var i=new Sys.StringBuilder;return i.append('<FlyoutAnchor Id="Ribbon.MyWork.Actions.ShowMe.M.MS.C.F'+t+'" LabelText="'+n+'" Command="MyWork.Cmd.ShowMe.Flyout">'),i.append('<Menu Id="Ribbon.MyWork.Actions.ShowMe.M.MS.C.F'+t+'.M">'),i.append('<MenuSection Id="Ribbon.MyWork.Actions.ShowMe.M.MS.C.F'+t+'.M.MS">'),i.append('<Controls Id="Ribbon.MyWork.Actions.ShowMe.M.MS.C.F'+t+'.M.MS.C">'),i.toString()},u=function(){var n=new Sys.StringBuilder;return n.append("<\/Controls>"),n.append("<\/MenuSection>"),n.append("<\/Menu>"),n.append("<\/FlyoutAnchor>"),n.toString()},t=function(n,t,f,e){var s=new Sys.StringBuilder,o,h;for(s.append(r(n,t)),o=0;o<e.length;o++)h=e[o],s.append('<Button Id="Ribbon.MyWork.Actions.ShowMe.M.MS.C.FWT.M.MS.C.'+i(o+1)+'" LabelText="'+h+'" Command="MyWork.Cmd.ShowMe.'+f+'" CommandValueId="'+h+'"/>');return s.append(u()),s.toString()},f=function(){var n=new Sys.StringBuilder;return n.append('<MenuSection Id="Ribbon.MyWork.Actions.ShowMe.M.CMS">'),n.append('<Controls Id="Ribbon.MyWork.Actions.ShowMe.M.CMS.C">'),n.append('<Button Id="Ribbon.MyWork.Actions.ShowMe.M.CMS.C.CF" LabelText="Clear Filters" Command="MyWork.Cmd.ShowMe.Clear" Image16by16="/_layouts/epmlive/images/mywork/filteroff.gif" Image32by32="/_layouts/epmlive/images/mywork/filteroff.gif"/>'),n.append("<\/Controls>"),n.append("<\/MenuSection>"),n.toString()},n;return MyWorkGrid.buildShowMeFilters(),n=new Sys.StringBuilder,n.append('<Menu Id="Ribbon.MyWork.Actions.ShowMe.M">'),MyWorkGrid.showMeFilterApplied?(n.append(f()),n.append('<MenuSection Id="Ribbon.MyWork.Actions.ShowMe.M.MS" Title="Filters">')):n.append('<MenuSection Id="Ribbon.MyWork.Actions.ShowMe.M.MS">'),n.append('<Controls Id="Ribbon.MyWork.Actions.ShowMe.M.MS.C">'),n.append(t("Work Types","WT","WorkType",MyWorkGrid.showMeFilters.workType)),n.append(t("Created By","CB","CreatedBy",MyWorkGrid.showMeFilters.createdBy)),n.append(t("Priority","PR","Priority",MyWorkGrid.showMeFilters.priority)),n.append(t("Status","STS","Status",MyWorkGrid.showMeFilters.status)),n.append(t("Flag","FLG","Flag",["Flagged","Not Flagged"])),n.append(t("Due","DUE","Due",["Next 7 days","Next 14 days","Next 30 days"])),n.append("<\/Controls>"),n.append("<\/MenuSection>"),n.append("<\/Menu>"),n.toString()},filter:function(n,t){var i=window.Grids[MyWorkGrid.gridId],f,r,u,o,e;t==="Flag"?(n===1?i.ChangeFilter(t,1,1,0,0,null):i.ChangeFilter(t,1,2,0,0,null),MyWorkGrid.lastFilter="Flag"):t==="Due"?(f=new Date,r=new Date(f.getFullYear(),f.getMonth(),f.getDate()),n.indexOf("7")!==-1?u=7:n.indexOf("14")!==-1?u=14:n.indexOf("30")!==-1&&(u=30),u&&(o=new Date(r.getFullYear(),r.getMonth(),r.getDate()+u),i.ChangeFilter("DueDateFC",window.DateToString(r,"yyyyMMdd"),6,1,0,null),i.ChangeFilter("DueDateFC2",window.DateToString(o,"yyyyMMdd"),4,0,1,null)),MyWorkGrid.lastFilter="DueDateFC"):(i.ChangeFilter(t,n,11,0,0,null),MyWorkGrid.lastFilter=t);MyWorkGrid.showMeFilterApplied=!0;MyWorkGrid.hidePivotMenu();e=Grids[MyWorkGrid.gridId];e.Update();e.Render()},clearFilter:function(){window.Grids[MyWorkGrid.gridId].ChangeFilter(MyWorkGrid.lastFilter,"",0,0,0,null);MyWorkGrid.lastFilter==="DueDateFC"&&window.Grids[MyWorkGrid.gridId].ChangeFilter("DueDateFC2","",0,0,0,null);MyWorkGrid.lastFilter=null;MyWorkGrid.showMeFilterApplied=!1;MyWorkGrid.hidePivotMenu();var n=Grids[MyWorkGrid.gridId];n.Update();n.Render()},changeToolbarSelection:function(n){$(".mwg-menuitem").each(function(){$(this).removeClass("selected")});$("#MWG_Pivot_"+n).addClass("selected")},hidePivotMenu:function(){$("#MWG_PivotMenu_wrap").hide();$(".mwg-submenu").each(function(){$($(this).find("li")).each(function(){$(this).remove()})});$("#Ribbon_MyWork_Actions_Search").blur();$("#MWG_Search").blur()},configureSearch:function(n){n.mousemove(function(n){var t=$(this),i=t.width()+25-(n.pageX-t.offset().left);i<=25?t.hasClass("MWG_Hover")||t.addClass("MWG_Hover"):t.hasClass("MWG_Hover")&&t.removeClass("MWG_Hover")});n.click(function(n){var t=$(this),i=t.width()+25-(n.pageX-t.offset().left);i<=25&&(t.addClass("MWG_SearchProcessing"),t.hasClass("MWG_SearchClose")&&t.val(""),MyWorkGrid.performSearch(t.val()),t.blur())});n.keypress(function(n){if(n.which===13){var t=$(this);t.addClass("MWG_SearchProcessing");MyWorkGrid.performSearch(t.val());t.blur()}});n.change(function(){var t=$(this),n=t.val();n!==MyWorkGrid.searchWatermark&&(t.attr("id")==="MWG_Search"?$("#Ribbon_MyWork_Actions_Search").val(n):$("#MWG_Search").val(n))});n.val(MyWorkGrid.searchWatermark).addClass("mwg-watermark");n.blur(function(){var n=$(this);n.val()||n.val(MyWorkGrid.searchWatermark).addClass("mwg-watermark")});n.focus(function(){var n=$(this);n.val()===MyWorkGrid.searchWatermark&&n.val("").removeClass("mwg-watermark")})},canHandleDueCommand:function(n){var u=n==="ago",t=MyWorkGrid.workFiltersConfigured&&(u?$("#Ribbon_MyWork_WorkFilter_DueAgo-Medium-checkbox").is(":checked"):$("#Ribbon_MyWork_WorkFilter_DueAfter-Medium-checkbox").is(":checked")),i,r;return u?(i=$("#Ribbon_MyWork_WorkFilter_DueAgoDays"),t?i.removeAttr("disabled"):i.attr("disabled","disabled")):(r=$("#Ribbon_MyWork_WorkFilter_DueAfterDays"),t?r.removeAttr("disabled"):r.attr("disabled","disabled")),t},updateWorkFilter:function(n,t){var u=n.indexOf("ago")!==-1?$(document.getElementById("Ribbon.MyWorkTab.MyWorkGroupWorkFilter-MyWorkLayout-0")):$(document.getElementById("Ribbon.MyWorkTab.MyWorkGroupWorkFilter-MyWorkLayout-1")),i,r,f;if(u.addClass("MWG_SearchProcessing"),t!==!0&&t!==!1)try{t<=0&&(t="")}catch(e){}i=MyWorkGrid.workFilters;n==="ago"?(i.daysAgoEnabled=t,i.daysAgoEnabled==!1&&(i.daysAgo="")):n==="after"?(i.daysAfterEnabled=t,i.daysAfterEnabled==!1&&(i.daysAfter="")):n==="agodays"?(i.daysAgo=t,i.daysAgo==""&&(i.daysAgoEnabled=!1)):n==="afterdays"&&(i.daysAfter=t,i.daysAfter==""&&(i.daysAfterEnabled=!1));r=window.epmLive;f='<Personalization Key="MyWork_DueFilter"><Filters><Filter Key="SiteId">'+r.currentSiteId+"<\/Filter><\/Filters><Value>"+i.daysAgoEnabled+"|"+i.daysAgo+"|"+i.daysAfterEnabled+"|"+i.daysAfter+"<\/Value><\/Personalization>";$.ajax({type:"POST",url:r.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'Personalization_Set', Dataxml: '"+f+"' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(f){var e,s,h,o;if(f.d)try{if(e=r.parseJson(f.d),s=e.Result,r.responseIsSuccess(s)||r.logFailure(s),!(n=="ago"&&(t==!0||t==!1)&&$(document.getElementById("Ribbon_MyWork_WorkFilter_DueAgoDays")).val()=="")&&!(n=="after"&&(t==!0||t==!1)&&$(document.getElementById("Ribbon_MyWork_WorkFilter_DueAfterDays")).val()=="")){i.daysAgo==""&&$(document.getElementById("Ribbon_MyWork_WorkFilter_DueAgoDays")).val("");i.daysAfter==""&&$(document.getElementById("Ribbon_MyWork_WorkFilter_DueAfterDays")).val("");var l=e.Result.Personalizations["@FromDate"],a=e.Result.Personalizations["@ToDate"],c=nonCompleteQuery.replace(/apos;/g,"'").replace(/quot;/g,'"').replace(/gt;/g,">").replace(/lt;/g,"<").replace(/&amp;/g,""),v=$(c).find("DateRange").attr("From"),y=$(c).find("DateRange").attr("To");nonCompleteQuery=nonCompleteQuery.replace(v,l).replace(y,a);MyWorkGrid.defaultViewId=null;h=Grids[MyWorkGrid.gridId];o=h.Source;o.Data.Param.Dataxml=nonCompleteQuery;o.Layout.Param.Dataxml=nonCompleteQuery;h.Reload(o,null,!1)}}catch(p){location.reload()}else r.log("response.d: "+f.d);u.removeClass("MWG_SearchProcessing")},error:function(n){r.log(n);u.removeClass("MWG_SearchProcessing")}})},loadRibbon:function(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){var i=document.getElementById("Ribbon.MyWorkContextualTabGroup"),n,t;i?(n=$(document.getElementById("Ribbon.MyWorkTab-title")),t=$(document.getElementById("Ribbon.MyWorkViewsTab-title")),n.attr("aria-selected")==="false"&&t.attr("aria-selected")==="false"&&window.SelectRibbonTab("Ribbon.MyWorkTab",!0)):window.SelectRibbonTab("Ribbon.MyWorkTab",!0)},"sp.ribbon.js")}};Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(n){var f="",e,t,i,s,h,o,r,u=0;for(n=Base64._utf8_encode(n);u<n.length;)e=n.charCodeAt(u++),t=n.charCodeAt(u++),i=n.charCodeAt(u++),s=e>>2,h=(e&3)<<4|t>>4,o=(t&15)<<2|i>>6,r=i&63,isNaN(t)?o=r=64:isNaN(i)&&(r=64),f=f+this._keyStr.charAt(s)+this._keyStr.charAt(h)+this._keyStr.charAt(o)+this._keyStr.charAt(r);return f},decode:function(n){var t="",e,o,s,h,u,r,f,i=0;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<n.length;)h=this._keyStr.indexOf(n.charAt(i++)),u=this._keyStr.indexOf(n.charAt(i++)),r=this._keyStr.indexOf(n.charAt(i++)),f=this._keyStr.indexOf(n.charAt(i++)),e=h<<2|u>>4,o=(u&15)<<4|r>>2,s=(r&3)<<6|f,t=t+String.fromCharCode(e),r!=64&&(t=t+String.fromCharCode(o)),f!=64&&(t=t+String.fromCharCode(s));return Base64._utf8_decode(t)},_utf8_encode:function(n){var i,r,t;for(n=n.replace(/\r\n/g,"\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},_utf8_decode:function(n){for(var r="",t=0,i=c1=c2=0;t<n.length;)i=n.charCodeAt(t),i<128?(r+=String.fromCharCode(i),t++):i>191&&i<224?(c2=n.charCodeAt(t+1),r+=String.fromCharCode((i&31)<<6|c2&63),t+=2):(c2=n.charCodeAt(t+1),c3=n.charCodeAt(t+2),r+=String.fromCharCode((i&15)<<12|(c2&63)<<6|c3&63),t+=3);return r}};