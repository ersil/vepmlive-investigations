function registerEpmLiveResourceGridScript(){(function(n,t,i,r,u){n.id=r.observable(null);n.autoFocus=!0;n.maxVScroll=null;n.webpartQualifier=null;n.pfeInstalled=!1;n.firstLoad=!0;n.epmrgv=null;n.resourceDictionary=null;n.resources=null;n.myResources=null;n.exportInProgress=!1;n.importInProgress=!1;n.webpartHeight=!1;n.userIsSiteAdmin=!1;n.allSelected=!1;n.ribbonBehavior=0;n.reports={wcReportId:null,opened:!1,collection:{},getXmlForRibbon:function(){var t=new window.Sys.StringBuilder,u=!1,r,i,f;t.append("<Menu Id='Ribbon.ResourceGrid.Views.Dropdown.Menu'>");t.append("<MenuSection DisplayMode='Menu' Id='Ribbon.ResourceGrid.Reporting.ReportsDropDown.Menu' Title='Reports'>");t.append("<Controls Id='Ribbon.ResourceGrid.Reporting.ReportsDropDown.Menu.Controls'>");r=n.reports.collection;for(i in r)r.hasOwnProperty(i)&&i!=="workvscapacity"&&(u=!0,f=r[i],t.append("<Button Id='Ribbon.ResourceGrid.Reports.{0}' Command='ResourceGrid.Cmd.ReportsDropDown.Select' LabelText=\"{1}\" CommandValueId='{0}'/>".format(i,f.name)));return u||t.append("<Button Id='Ribbon.ResourceGrid.Reports.{0}' Command='ResourceGrid.Cmd.ReportsDropDown.Select' LabelText='{1}' CommandValueId='{0}'/>".format("Loading","Loading...")),t.append("<\/Controls>"),t.append("<\/MenuSection>"),t.append("<\/Menu>"),t.toString()},open:function(t){var i,r;if(t&&t!=="0"&&t!==0&&t!=="Loading"){n.reports.opened=!0;var e=n.grid.grids[n.id()],u=e.GetSelRows(),f="";for(i=0;i<u.length;i++)r=u[i],r.Kind==="Data"&&r.Def.Name==="R"&&(f+="&rp:Resources="+r.ResourceID);n.reports.opened=!0;window.open(n.reports.collection[t].url+f);window.setTimeout(function(){n.reports.opened=!1},2e3)}},load:function(){function r(i){for(var u,o,r,f,e=0;e<i.length;e++)if(u=i[e],u.Report.length>0)for(o=0;o<u.Report.length;o++)r=u.Report[o],f=r["@Name"],n.reports.collection[t.md5(f)]={name:f,url:r["@Url"],hasResourcesParam:r["@HasResourcesParam"]==="True"};else u.Report&&(r=u.Report,f=r["@Name"],n.reports.collection[t.md5(f)]={name:f,url:r["@Url"],hasResourcesParam:r["@HasResourcesParam"]==="True"})}i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'Reporting_GetReportsByFolder', Dataxml: '<Reports><Folder>Report Library/epmlivetl/Resources<\/Folder><\/Reports>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var f=t.parseJson(i.d),u=f.Result;t.responseIsSuccess(u)?u.GetReportsByFolder.Data.Folder&&u.GetReportsByFolder.Data.Folder.Folder&&r(u.GetReportsByFolder.Data.Folder.Folder):t.logFailure(u)}else t.log("response.d: "+i.d);n.actions.areReportsLoaded=!0},error:function(i){t.log(i);n.actions.areReportsLoaded=!0}})}};n.grid={grids:window.Grids,filteringOn:!0,groupingOn:!0,showColumnSelector:function(){this.g().ActionShowColumns("Selectable")},hideRow:function(n){var t=this.g();t.HideRow(t.GetRowById(n))},showRow:function(n){var t=this.g();t.ShowRow(t.GetRowById(n))},hideFilters:function(){this.hideRow("Filter");this.filteringOn=!1},showFilters:function(){this.showRow("Filter");this.filteringOn=!0},hideGrouping:function(){var u=this.g(),n=null,t=u.Rows,i,r;for(i in t)if(t.hasOwnProperty(i)&&(r=t[i],r.Kind==="Group")){n=r.id;break}n&&(this.hideRow(n),this.groupingOn=!1)},showGrouping:function(){var u=this.g(),n=null,t=u.Rows,i,r;for(i in t)if(t.hasOwnProperty(i)&&(r=t[i],r.Kind==="Group")){n=r.id;break}n&&(this.showRow(n),this.groupingOn=!0)},toggleFiltering:function(){return this.filteringOn?this.hideFilters():this.showFilters(),this.filteringOn},toggleGrouping:function(){return this.groupingOn?this.hideGrouping():this.showGrouping(),this.groupingOn},removeSorting:function(){this.g().ChangeSort("Title")},resetNoDataRow:function(){var t=i("#"+n.id())[0],r,u,f;t&&(r=t.firstChild,this.g().GetFirstVisible()||(t.removeChild(r),u=t.insertRow(0),f=u.insertCell(0),f.innerHTML="No resource found."))},reload:function(){var t=window.location.href.replace(new RegExp("&epmrgv="+n.epmrgv,"gi"),"").replace(new RegExp("epmrgv="+n.epmrgv,"gi"),"");t=(t+(t.indexOf("?")!==-1?"&":"?")+"epmrgv="+n.views.currentView.id).replace(new RegExp("&&","g"),"&");window.location=t},rowsSelected:function(){try{return n.grid.grids[n.id()].GetSelRows().length}catch(t){return 0}},resourceUpdated:function(r,u,f){var o,h;if(r===1){var e=n.grid.grids[n.id()],c=f.row||{id:0},s=f.changeType;if(s==="Deleted"){e.AddDataFromServer("<Grid><Changes><I id='"+c.id+"' Deleted='1'/><\/Changes><\/Grid>");n.actions.reIndexResources();return}if(o=c.id,s==="Added"){o="";for(h in e.Rows)e.Rows.hasOwnProperty(h)&&(o+=e.Rows[h].id+",");o=o.slice(0,-1)}i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'GetResourcePoolDataGridChanges', Dataxml: '<ResourcePoolDataGridChanges><Params><ChangeType>"+s+"<\/ChangeType><Rows>"+o+"<\/Rows><\/Params><\/ResourcePoolDataGridChanges>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var r=t.parseJson(i.d);try{e.AddDataFromServer(r.ResourcePoolDataGridChanges.Data["#cdata"]);e.RenderBody();e.Render();e.Update();n.grid.fixIE();s==="Added"&&n.actions.reIndexResources()}catch(u){t.log(error)}}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}})}},contextMenuResourceChanged:function(t){var r=n.grid.grids[n.id()],u,i;t&&(u=r.GetSelRows(),i=u[0],i||(i=r.GetRowById(t)),n.grid.resourceUpdated(1,null,{row:i,changeType:"Changed"}))},contextMenuResourceDelete:function(t){var r=n.grid.grids[n.id()],u,i;t&&(u=r.GetSelRows(),i=u[0],i||(i=r.GetRowById(t)),n.grid.resourceUpdated(1,null,{row:i,changeType:"Deleted"}))},fixIE:function(){var r,t;try{if(i.browser.msie)for(r=function(){var t=n.grid.g();t.Update();t.SetScrollTop(t.GetScrollTop()+2);t.SetScrollTop(t.GetScrollTop()-2);t.Update()},t=0;t<=50;t++)window.setTimeout(function(){r()},t*100)}catch(u){}}};n.grid.g=r.dependentObservable(function(){return this.grids[n.id()]},n.grid);n.views={collection:{},totalViews:0,currentView:null,previousView:null,userHasGlobalViewModificationPermission:!1,build:function(t){var i=n.grid.g(),f,e,a,r,h;t.cols=[];t.filters=[];var v=i.Cols,u=i.GetCols("Visible"),y=0;for(f=0;f<u.length;f++)y+=i.Cols[u[f]].Width;for(e=0;e<u.length;e++){var c=u[e],o=i.Cols[c],s=o.Width,l=o.FixedWidth?o.FixedWidth===1?!0:!1:!1;l||(s=Math.round(s*100/y*1e3)/1e3);c==="Panel"&&(s=14,l=!0);t.cols.push({name:c,width:s,isfixedwidth:l,section:o.Sec})}t.filteringon=n.grid.filteringOn;a=i.GetRowById("Filter");for(r in v)v.hasOwnProperty(r)&&(h=a[r+"Filter"],h&&h!==0&&t.filters.push({column:r,value:a[r],cell:h}));return t.groupingon=n.grid.groupingOn,t.grouping=i.Group,t.sorting=i.Sort,t},getXml:function(n){for(var t,r,u,i='<View Id="{0}" Name="{1}" IsDefault="{2}" IsPersonal="{3}"><Cols>'.format(n.id,escape(n.name),n.isdefault,n.ispersonal),f=0;f<n.cols.length;f++)t=n.cols[f],i+='<Col Name="{0}" Width="{1}" IsFixedWidth="{2}" Section="{3}"/>'.format(t.name,t.width,t.isfixedwidth,t.section);if(i+='<\/Cols><Filters RowVisible="{0}">'.format(n.filteringon||!1),n.filters)for(r=0;r<n.filters.length;r++)u=n.filters[r],i+='<Filter Column="{0}" Value="{1}" Cell="{2}"/>'.format(u.column,u.value,u.cell);return i+'<\/Filters><Grouping RowVisible="{0}">{1}<\/Grouping><Sorting>{2}<\/Sorting><\/View>'.format(n.groupingon||!1,n.grouping||"",n.sorting||"")},save:function(r){var u=n.grid.g();(u.StaticCursor=1,r.id=r.name!=="Default View"?t.md5(r.name):"dv",!this.collection[r.id]||confirm('Would you like to overwrite the "'+r.name+'" view?'))&&(r=this.build(r),i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'SaveResourcePoolViews', Dataxml: '<ResourceGridViews>"+this.getXml(r)+"<\/ResourceGridViews>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var u=t.parseJson(i.d);t.responseIsSuccess(u.Result)?(window.SP.UI.Notify.addNotification('The view "{0}" has been saved.'.format(r.name),!1),n.views.collection[r.id]=r,n.views.apply(r.id)):t.logFailure(u.Result)}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}}))},showSaveDialog:function(){var f=n.grid.g(),r=document.createElement("div"),u;r.innerHTML=i("#RWPSaveView-{0}".format(n.id())).html();i(i(r).find("#RWPSaveView-Name-{0}".format(n.id()))).val(this.currentView.name);this.currentView.isdefault&&i(i(r).find("#RWPSaveView-Default-{0}".format(n.id()))).attr("checked","checked");u=i(r).find("#RWPSaveView-Personal-{0}".format(n.id()));i(u).is(":disabled")||this.currentView.ispersonal&&i(u).attr("checked","checked");var e=i.browser.msie,o=e?140:135,s=e?230:225,t=window.SP.UI.$create_DialogOptions();t.title="Save View";t.html=r;t.height=o;t.width=s;t.allowMaximize=!1;t.showClose=!1;f.StaticCursor=0;f.ActionBlur();window.SP.UI.ModalDialog.showModalDialog(t)},apply:function(r){var f=null,l=t.getUrlParamByName("epmrgv"),it,rt,ct,o,u,lt,e,ut,a,p,w,ft,c,b,et,k,d,ot,st,ht,g,nt,tt;if(l&&n.firstLoad&&this.collection[l]&&(r=l,n.epmrgv=l),r)f=this.collection[r];else{it="dv";rt=null;for(ct in this.collection)o=this.collection[ct],o.ispersonal&&o.isdefault?rt=o.id:o.isdefault&&(it=o.id),f=this.collection[rt||it]}if(!this.currentView||this.currentView.id!==f.id){for(u=n.grid.g(),lt=n.actions.myResourcesOn,u.getColWidth||(u.getColWidth=function(n){if(n&&this.Cols[n]){var i=this.Cols[n].Width;return t.utils.isInt(i)||i.indexOf("-")!==-1&&(i=i.split("-")[0]),+i}return 0}),e=[],ut=[],a=0;a<f.cols.length;a++){var s=f.cols[a],h=s.name,v=u.Cols[h],y=0,at=u.getColWidth(h);s.isfixedwidth?(h==="Panel"&&(s.width=14),y=s.width-at):(y=-at,v&&(v.RelWidth=s.width));y!==0&&(v&&(v.Width+=y),u.Update());u.MoveCol(h,0,1,0);e.push(h)}for(u.Update(),u.Render(),u.Update(),p=u.Group.split(","),u.DoGrouping(null),w=0;w<p.length;w++)ft=p[w],ft&&u.HideCol(ft);for(c=u.GetCols("Visible"),c=c.concat(p),b=0;b<c.length;b++){for(et=!1,k=c[b],d=0;d<e.length;d++)if(e[d]===k){et=!0;break}!et&&k&&ut.push(k)}for(u.ChangeColsVisibility(e,ut,0),ot=[],st=[],ht=0;ht<e;ht++)ot.push(null),st.push(0);if(u.ChangeFilter(e,ot,st,0,0,null),g=f.filters,g){var vt=[],yt=[],pt=[];for(nt=0;nt<g.length;nt++)tt=g[nt],vt.push(tt.column),yt.push(tt.value),pt.push(tt.cell);u.ChangeFilter(vt,yt,pt,0,0,null)}else u.ChangeFilter("","","",0,0,null);f.filterrowvisible?n.grid.showFilters():n.grid.hideFilters();u.ChangeSort(f.sorting);n.grid.hideGrouping();u.DoGrouping(f.grouping||null);u.Render();u.Update();n.actions.myResourcesOn=!1;lt&&n.actions.toggleMyResources();this.currentView=f;window.RefreshCommandUI();n.firstLoad&&(n.actions.resetEasyScroll(),window.setTimeout(function(){n.firstLoad=!1},2e3));window.setTimeout(function(){var t=n.grid.g();i(".EPMLiveResourceGridGroup").click(function(n){var r,u,f,e;try{if(i(n.currentTarget).attr("class").indexOf("Panel")===-1&&(r=i(this).parent(),r&&(r=r[0],r))){u=r.attributes;for(f in u)u.hasOwnProperty(f)&&(e=u[f],e.name==="onmousemove"&&(r=t.Rows[e.value.split('"')[1]],r.Expanded===1?t.Collapse(r):t.Expand(r),n.stopPropagation()))}}catch(o){}});n.grid.fixIE()},10)}},load:function(){function r(t){function f(n){var t,i;return n&&(t=n.toLowerCase(),t==="true"?n=!0:t==="false"?n=!1:(i=parseInt(n),isNaN(i)||(n=i))),n}var e,u,o,s,r,i,b,h,c,k,l,a,d,g,v,y,nt,p,w,tt,it;for(t.length||(t=[t]),e=0;e<t.length;e++){u={};o=t[e];for(s in o)if(o.hasOwnProperty(s))if(r=s.replace(/@/,"").toLowerCase(),i=o[s],r.toLowerCase()==="name"&&(i=unescape(i)),r==="cols"){for(i=i.Col,i.length||(i=[i]),b=[],h=0;h<i.length;h++){c=i[h];k={};for(l in c)c.hasOwnProperty(l)&&(k[l.replace(/@/,"").toLowerCase()]=f(c[l]));b.push(k)}u[r]=b}else if(r==="filters"){for(a in i)if(i.hasOwnProperty(a))if(d=a.replace(/@/,"").toLowerCase(),d==="filter"){for(i=i.Filter,i.length||(i=[i]),g=[],v=0;v<i.length;v++){y=i[v];nt={};for(p in y)y.hasOwnProperty(p)&&(nt[p.replace(/@/,"").toLowerCase()]=f(y[p]));g.push(nt)}u[r]=g}else u["filter"+d]=f(i[a])}else if(r==="grouping")for(w in i)i.hasOwnProperty(w)&&(tt=w.replace(/@/,"").toLowerCase(),it=f(i[w]),tt==="#text"?u[r]=it:u["grouping"+tt]=it);else u[r]=r!=="id"?f(i):i;n.views.collection[u.id]=u;n.views.totalViews++}}i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'GetResourcePoolViews', Dataxml: '<Views/>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var f=t.parseJson(i.d),u=f.Result;t.responseIsSuccess(u)?(n.views.totalViews=0,r(u.ResourcePoolViews.Views.View),n.views.apply()):t.logFailure(u)}else t.log("response.d: "+i.d);n.actions.isViewApplied=!0},error:function(i){t.log(i);n.actions.isViewApplied=!0}})},getXmlForRibbon:function(){function r(i){var e,f,r;n.append("<MenuSection DisplayMode='Menu' Id='Ribbon.ResourceGrid.Views.Dropdown.Menu.{0}' Title='{0} Views'>".format(i));n.append("<Controls Id='Ribbon.ResourceGrid.Views.Dropdown.Menu.{0}.Controls'>".format(i));e=i==="Personal";for(f in t)if(t.hasOwnProperty(f)&&(r=t[f],r.name&&r.ispersonal===e)){if(r.id==="dv"&&u>1)continue;n.append("<Button Id='Ribbon.ResourceGrid.views.{0}' Command='ResourceGrid.Cmd.CurrentViewDropDown.Select' LabelText=\"{1}\" CommandValueId='{0}'/>".format(r.id,r.name))}n.append("<\/Controls>");n.append("<\/MenuSection>")}var t=this.collection,i=this.currentView,u=this.totalViews,n=new window.Sys.StringBuilder;return n.append("<Menu Id='Ribbon.ResourceGrid.Views.Dropdown.Menu'>"),n.append("<MenuSection DisplayMode='Menu' Id='Ribbon.ResourceGrid.Views.Dropdown.Menu.Default' Title='Current View'>"),n.append("<Controls Id='Ribbon.ResourceGrid.Views.Dropdown.Menu.Default.Controls'>"),n.append("<Button Id='Ribbon.ResourceGrid.views.{0}' Command='ResourceGrid.Cmd.CurrentViewDropDown.Select' LabelText=\"{1}\" CommandValueId='{0}'/>".format(i.id,i.name)),n.append("<\/Controls>"),n.append("<\/MenuSection>"),r("Global"),r("Personal"),n.append("<\/Menu>"),n.toString()},remove:function(){var r=this.currentView;if(!this.userHasGlobalViewModificationPermission&&!r.ispersonal){alert("You are not allowed to delete a global view");return}if(r.id==="dv"){alert("You cannot delete the Default View");return}confirm('Are you sure you want to delete the "'+r.name+'" view?')&&i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'DeleteResourcePoolViews', Dataxml: '<ResourceGridViews>"+this.getXml(r)+"<\/ResourceGridViews>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var u=t.parseJson(i.d);t.responseIsSuccess(u.Result)?(window.SP.UI.Notify.addNotification('The view "{0}" has been deleted.'.format(r.name),!1),delete n.views.collection[r.id],n.views.totalViews--,n.views.apply()):t.logFailure(u.Result)}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}})},rename:function(r){if(r){var u=this.currentView,f=u.name;if(u.name=r,!this.userHasGlobalViewModificationPermission&&!u.ispersonal){alert("You are not allowed to rename a global view");return}if(u.id==="dv"){alert("You cannot rename the Default View");return}confirm('Are you sure you want to rename the "'+f+'" view?')&&i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'UpdateResourcePoolViews', Dataxml: '<ResourceGridViews>"+this.getXml(u)+"<\/ResourceGridViews>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var r=t.parseJson(i.d);t.responseIsSuccess(r.Result)?(window.SP.UI.Notify.addNotification('The view "{0}" has been renamed to "{1}".'.format(f,u.name),!1),n.views.currentView.name=u.name,n.views.collection[u.id].name=u.name,window.RefreshCommandUI()):t.logFailure(r.Result)}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}})}},showRenameDialog:function(){var u=n.grid.g(),r=document.createElement("div");r.innerHTML=i("#RWPRenameView-{0}".format(n.id())).html();i(i(r).find("#RWPRenameView-CurrentName-{0}".format(n.id()))).html(this.currentView.name);var f=i.browser.msie,e=f?135:140,o=f?235:240,t=window.SP.UI.$create_DialogOptions();t.title="Rename View";t.html=r;t.height=e;t.width=o;t.allowMaximize=!1;t.showClose=!1;u.StaticCursor=0;u.ActionBlur();window.SP.UI.ModalDialog.showModalDialog(t)}};n.actions={easyScrollOn:!1,myResourcesOn:!1,loadRibbon:function(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){var r=function(t){window._ribbonStartInit(t,!0,null);i("#s4-ribbonrow").height(35);var r=window.setInterval(function(){document.getElementById("Ribbon.ResourceGridTab")||n.ribbonBehavior==0&&window.SelectRibbonTab(t,!0)},1);window.setTimeout(function(){window.clearInterval(r);try{var t=function(){var r=[i(document.getElementById("Ribbon.ResourceGridTab-title")),i(document.getElementById("Ribbon.ResourceGridViewTab-title"))],u,n;for(u in r)r.hasOwnProperty(u)&&(n=r[u],n.attr("style","border-top: 1px solid #E1E1E1 !important; height: 33px !important; margin-top: -4px !important"),n.find("a").attr("style","padding-top: 4px !important;"),n.attr("aria-selected")==="false"&&n.attr("style","height: 33px !important; margin-top: -3px !important"),n.click(function(){window.setTimeout(function(){t()},100)}))};t();window.epmLiveMasterPageVersion>=5.5&&(epmLiveResourceGrid.loaderStopped||(n.ribbonBehavior==0?i(document.getElementById("s4-ribbonrow")).height(126):i(document.getElementById("s4-ribbonrow")).height(35),window.EPM.UI.Loader.current().stopLoading("WebPart"+n.webpartQualifier),epmLiveResourceGrid.loaderStopped=!0));n.grid.fixIE()}catch(u){}},750)},u=SP.Ribbon.PageManager.get_instance(),t=null;try{t=u.get_ribbon()}catch(f){}t||typeof _ribbonStartInit=="function"&&r("Ribbon.ResourceGridTab")},"sp.ribbon.js")},dataTicketRequest:function(){var h=n.grid.g(),r=h.GetSelRows(),u,o,f,e,s;if(n.allSelected){r=[];u=h.Rows;for(o in u)u.hasOwnProperty(o)&&r.push(u[o])}for(f=[],e=0;e<r.length;e++)s=r[e],s.Def.Name==="R"&&f.push(s.EXTID);return f.length>0?i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/PortfolioEngine.asmx/Execute",data:"{ Function: 'GenerateDataTicket', Dataxml: '<GenerateDataTicket><Ticket>"+f.join(",")+"<\/Ticket><\/GenerateDataTicket>' }",contentType:"application/json; charset=utf-8",dataType:"json"}):null},retriveDataTicket:function(n){if(n.d){var i=t.parseJson(n.d),r=i.GenerateDataTicket;if(t.responseIsSuccess(r.Result))return r.Data.Ticket["@Id"];t.logFailure(i.Result)}else t.log("response.d: "+n.d);return null},displayPopUp:function(n,t,i,r,u,f,e,o){var h,s;i||(i=!0);r||(r=!0);u||(u=function(){});h=e&&o?{title:t,allowMaximize:i,showMaximized:!0,showClose:r,url:n,dialogReturnValueCallback:Function.createCallback(Function.createDelegate(null,u),f),width:e,height:o}:{title:t,allowMaximize:i,showClose:r,url:n,dialogReturnValueCallback:Function.createCallback(Function.createDelegate(null,u),f)};t==="Assignment Planner"&&(s=document.createElement("iframe"),s.setAttribute("src",n),s.setAttribute("width","99%"),s.setAttribute("height","98%"),h.url=null,h.html=s);window.SP.UI.ModalDialog.showModalDialog(h)},analyzeResources:function(){var i=n.actions.dataTicketRequest();i&&i.success(function(i){var r=n.actions.retriveDataTicket(i),u;r&&(u="{0}/_layouts/ppm/rpanalyzer.aspx?dataid={1}".format(t.currentWebUrl,r),n.actions.displayPopUp(u,"Resource Analyzer",!0,!0,null,null,700,700))})},redirect:function(i){var l=n.grid.grids[n.id()],o=l.GetSelRows(),s=o[0],u=null,h,f,e,c,r;if(n.grid.rowsSelected()>0&&(u=i==="viewprofile"?s.ResourceID:s.ID),i==="sendnotification"){for(h=[],f=0;f<o.length;f++)e=o[f],e.Kind==="Data"&&e.Def.Name==="R"&&(c=e.Email,c&&h.push(c));window.location.href="mailto:{0}".format(h.join(";"));return}r="{0}/_layouts/epmlive/redirectionproxy.aspx?listname=Resources&webid={1}".format(t.currentWebUrl,t.currentWebId);switch(i){case"add":n.actions.displayPopUp("{0}&action=new".format(r),null,!0,!0,n.grid.resourceUpdated,{row:null,changeType:"Added"});break;case"edit":n.actions.displayPopUp("{0}&action=edit&id={1}".format(r,u),null,!0,!0,n.grid.resourceUpdated,{row:s,changeType:"Changed"});break;case"showcomments":n.actions.displayPopUp("{0}&action={1}&id={2}".format(r,i,u),null,!0,!0,null,null,700,700);break;default:n.actions.displayPopUp("{0}&action={1}&id={2}".format(r,i,u))}},loadResourcePlanner:function(){var i=n.actions.dataTicketRequest();i&&i.success(function(i){var r=n.actions.retriveDataTicket(i),u;r&&(u="{0}/_layouts/ppm/RPEditor.aspx?dataid={1}&isresource=1".format(t.currentWebUrl,r),n.actions.displayPopUp(u,"Resource Planner",!0,!0,null,null,700,700))})},loadAssignmentPlanner:function(){for(var f,e,o=n.grid.g(),u=o.GetSelRows(),i=[],r=0;r<u.length;r++)f=u[r],i.push(f.ID);i.length>0&&(e="{0}/_layouts/epmlive/AssignmentPlanner.aspx?resources={1}&IsDlg=1".format(t.currentWebUrl,i.join(",")),n.actions.displayPopUp(e,"Assignment Planner",!0,!0,null,null,1e3,700))},deleteResource:function(){var u=n.grid.g(),r=u.GetSelRows()[0];if(r.Kind==="Data"&&r.Def.Name==="R"){if(!confirm("Are you sure you want to delete this resource?"))return;i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'DeleteResourcePoolResource', Dataxml: '<DeleteResourcePoolResource><Resource Id=\""+r.ID+"\"/><\/DeleteResourcePoolResource>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(u){var f,o,e,s;if(u.d)if(f=t.parseJson(u.d),t.responseIsSuccess(f.Result)){if(o=f.Result.DeleteResourcePoolResource.Resource,e=o["@Status"],e==="0")n.grid.resourceUpdated(1,null,{row:r,changeType:"Deleted"});else if(s=o["#cdata"],e==="1")alert(s);else if(e==="2"){if(!confirm(s))return;i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'DeleteResourcePoolResource', Dataxml: '<DeleteResourcePoolResource><Resource Id=\""+r.ID+'" ConfirmDelete="True"/><\/DeleteResourcePoolResource>\' }',contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var u=t.parseJson(i.d);t.responseIsSuccess(u.Result)?n.grid.resourceUpdated(1,null,{row:r,changeType:"Deleted"}):t.logFailure(u.Result)}else t.log("resp.d: "+i.d)},error:function(n){t.log(n)}})}}else t.logFailure(f.Result);else t.log("response.d: "+u.d)},error:function(n){t.log(n)}})}},resetEasyScroll:function(){var t=n.grid.g();i("#EPMLiveResourceGridSelector").watermark("Type here to search...");n.resourceDictionary==null&&n.actions.reIndexResources();i("#EPMLiveResourceGridSelector").autocomplete({source:function(t,r){var u=i.ui.autocomplete.filter(n.actions.myResourcesOn?n.myResources:n.resources,t.term);r(u)},select:function(i,r){var f=n.resourceDictionary[r.item.value],u;f&&(u=t.Rows[f],t.ExpandParents(u),t.ActionClearSelection(),t.SelectRow(u,!0),t.SetScrollTop(t.GetRowTop(u)));n.actions.toggleEasyScroll();window.setTimeout(function(){window.RefreshCommandUI()},100)}});i("#s4-ribbonrow").click(function(t){for(var u,f=!0,e=i(t.target).parents(),r=0;r<5;r++)try{if(u=e[r],u&&i(u)[0].id.indexOf("Ribbon.ResourceGrid.Actions.Find")!==-1){f=!1;break}}catch(o){}f&&n.actions.hideEasyScroll(!0)})},toggleEasyScroll:function(){var u=i(".callout"),t,r,f,e;if(u.length&&(u=u[0]),t=i(u),t.is(":visible"))n.actions.hideEasyScroll(!1);else{if(n.resources.length===0)return!1;r=document.getElementById("Ribbon.ResourceGrid.Actions.Find-Large");r||(r=document.getElementById("Ribbon.ResourceGrid.Actions.Find-Small"));r&&i(".epmliveToolBar").length==0&&(f=i(r),e=f.offset(),t.css({top:e.top+f.height()}),t.css({left:e.left+f.width()/2-31}),i("#EPMLiveResourceGridSelector").val(""),t.show(),i("#EPMLiveResourceGridSelector").focus(),n.actions.easyScrollOn=!0)}return n.actions.easyScrollOn},reIndexResources:function(){var f=n.grid.g(),i,r,t,u;n.resourceDictionary={};n.resources=[];n.myResources=[];i=f.Rows;for(r in i)i.hasOwnProperty(r)&&(t=i[r],t.Kind==="Data"&&t.Def.Name==="R"&&(u=t.Title,n.resources.push(u),n.resourceDictionary[u]=r,t.IsMyResource===1&&n.myResources.push(u)))},toggleMyResources:function(){var t=n.grid.g();n.actions.myResourcesOn?(t.ChangeFilter("IsMyResource","0",6,0,1,null),n.actions.myResourcesOn=!1):(t.ChangeFilter("IsMyResource","1",1,0,1,null),n.actions.myResourcesOn=!0)},hideEasyScroll:function(t){var r=i(".callout"),u;r.length&&(r=r[0]);u=i(r);u.is(":visible")&&(u.hide(),n.actions.easyScrollOn=!1,t&&window.setTimeout(function(){window.RefreshCommandUI()},100))},exportResources:function(){var o,e,f,u,r;for(n.exportInProgress=!0,window.RefreshCommandUI(),o=i("#EPMLiveStatusbar").height(),e=t.ui.statusbar.collection(),f=0;f<e.length;f++)e[f].remove();u=t.ui.statusbar.add("Status","Exporting resources to Excel spreadsheet...");u.color("yellow");r=u.collection()[0];i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'ExportResources', Dataxml: '<ExportResources/>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){var s,f,e,o;i.d?(s=t.parseJson(i.d),f=s.Result,t.responseIsSuccess(f)?(e=f.ResourceExporter,e["@Success"]==="True"?(r.message('Resources exported succesfully. Click <a href="'+t.currentWebUrl+"/_layouts/epmlive/filedownloader.aspx?fileid="+e["@File"]+'&filename=Resources.xlsm&ct=application/ms-excel">here<\/a> to download the spreadsheet.'),u.color("blue")):(o=e["@Message"],t.log(o),r.title("Error"),r.message("Unable to export resources. The response was: "+o),u.color("red"))):(t.log(f),r.title("Error"),r.message("Unable to export resources. The response was: "+f),u.color("red"))):(t.log(i.d),r.title("Error"),r.message("Unable to export resources. There was no response from the server."),u.color("red"));n.exportInProgress=!1;window.RefreshCommandUI()},error:function(i){t.log(i);r.title("Error");r.message("Unable to export resources. The response was: ("+i.status+") "+i.statusText);u.color("red");n.exportInProgress=!1;window.RefreshCommandUI()}})},importResources:function(){var n=window.SP.UI.$create_DialogOptions();n.title="Import Resources";n.url=t.currentWebUrl+"/_layouts/epmlive/importresources.aspx";n.dialogReturnValueCallback=window.epmLiveResourceGrid.actions.onImportResourcesCompleted;window.SP.UI.ModalDialog.showModalDialog(n)},onImportResourcesCompleted:function(t){t===1&&n.grid.reload()},canExport:function(){return!n.exportInProgress&&n.userIsSiteAdmin},canImport:function(){return!n.importInProgress&&n.userIsSiteAdmin},createToolBar:function(t){(function r(){var s,h,o,c,ut,u,l,a,b,v,k,y,p,d,w,g,nt;if(n.actions.isViewApplied&&n.actions.areReportsLoaded){i("#resourcePoolToolBar").length>0&&i("#resourcePoolToolBar").remove();var f=window.Grids[window.epmLive.resourceGridId],tt=f.Cols,e=[];for(u in f.Cols)tt.hasOwnProperty(u)&&u.toLowerCase()!="panel"&&e.push(f.Cols[u]);function it(n,t){return n.Name<t.Name?-1:n.Name>t.Name?1:0}e.sort(it);s="";h=[];for(u in e)f.Header[e[u].Name].trim()&&h.push(f.Header[e[u].Name]+"|"+e[u].Name);function rt(n,t){return n.split("|")[0]<t.split("|")[0]?-1:n.split("|")[0]>t.split("|")[0]?1:0}s=h.sort(rt).join(",");o={};c=[];for(u in n.views.currentView.cols)c.push(n.views.currentView.cols[u].name);ut=1;for(u in e)f.Header[e[u].Name].trim()&&(o[e[u].Name]={value:f.Header[e[u].Name],checked:i.inArray(e[u].Name,c)!=-1});l={heading:"none",divider:"no",options:[]};a=n.views.collection;for(b in a)v=a[b],k={text:v.name,events:[{eventName:"click","function":function(){n.views.apply(i(this).attr("viewId"));i(this).closest("ul").toggle();i(this).closest("ul").siblings("a").eq(0).children("span").eq(1).text(n.views.currentView.name);i(this).closest("li").siblings().each(function(){i(this).css("display","")});i(this).closest("li").css("display","none")}}],properties:{viewId:v.id}},l.options.push(k);y=n.reports.collection;p=[];for(d in y)w=y[d],g={iconClass:"",text:w.name,events:[{eventName:"click","function":function(){window.open(i(this).attr("reportUrl"),"_blank")}}],properties:{reportUrl:w.url}},p.push(g);nt=[{id:"resourcePoolToolBar"},{placement:"left",content:[{controlId:"btnInvite",controlType:"button",iconClass:"icon-plus-2",value:"Invite",events:[{eventName:"click","function":function(){n.actions.displayPopUp(n.actions.getNewFormUrl,"Test",!1,!0,null,null)}}]},{controlId:"msColumns",controlType:"multiselect",title:"",value:"",iconClass:"icon-insert-template",toolTip:"select columns",sections:[{heading:"none",divider:"no",options:o}],applyButtonConfig:{text:"Apply","function":function(n){var o=n.selectedKeys,u,e,r,t,s;for(u in n.sections){e=n.sections[u];r=e.options;for(t in r)s=r[t],i.inArray(t,o)!=-1?f.SetAttribute(null,t,"Visible","1",0):f.SetAttribute(null,t,"Visible","0",0)}f.Rerender()}},onchangeFunction:function(){}},{controlId:"ddlTools",controlType:"dropdown",title:"",value:"Tools",iconClass:"icon-tools",sections:[{heading:"Plan",divider:"yes",options:[{iconClass:"icon-pie-3 icon-dropdown",text:"Resource Planner",events:[{eventName:"click","function":function(){n.actions.loadResourcePlanner()}}]},{iconClass:"icon-flag-5 icon-dropdown",text:"Assignment Planner",events:[{eventName:"click","function":function(){n.actions.loadAssignmentPlanner()}}]}]},{heading:"Analyze",divider:"yes",options:[{iconClass:"icon-filter-4 icon-dropdown",text:"Resource Analyzer",events:[{eventName:"click","function":function(){n.actions.analyzeResources()}}]},{iconClass:"icon-filter-4 icon-dropdown",text:"Work vs. Capacity",events:[{eventName:"click","function":function(){n.reports.open("workvscapacity")}}]}]},{heading:"none",divider:"yes",options:[{iconClass:"icon-filter-4 icon-dropdown",text:"Send Notification",events:[{eventName:"click","function":function(){n.actions.redirect("sendnotification")}}]},{iconClass:"icon-filter-4 icon-dropdown",text:"Export Excel",events:[{eventName:"click","function":function(){n.actions.exportResources()}}]},{iconClass:"icon-filter-4 icon-dropdown",text:"Import Excel",events:[{eventName:"click","function":function(){n.actions.importResources()}}]}]}]},{controlId:"ddlReports",controlType:"dropdown",title:"",value:"Reporting",iconClass:"icon-pie-3",sections:[{heading:"none",divider:"no",options:p}]}]},{placement:"right",content:[{controlId:"genericId",controlType:"search",toolTip:"search",custom:"yes",customControlId:""},{controlId:"genericId",controlType:"search",toolTip:"search",custom:"no",events:[{eventName:"keypress","function":function(n){n.keyCode==13&&alert("enter key pressed!")}}]},{controlId:"btnFilter",controlType:"button",iconClass:"icon-filter",toolTip:"toggle filters",title:"none",events:[{eventName:"click","function":function(){n.grid.toggleFiltering()}}]},{controlId:"btnDefaultSort",controlType:"button",iconClass:"icon-sort",toolTip:"default sort",title:"none",events:[{eventName:"click","function":function(){n.grid.removeSorting()}}]},{controlType:"groupByFields",toolTip:"manage grouping",availableGroups:s,saveFunction:function(n){var i=null,t=[],r,u;if(n.length>0){for(r in n)u=n[r],t.push(u.value);t.length>0&&(i=t.join(","))}window.Grids[window.epmLive.resourceGridId].DoGrouping(i)}},{controlId:"msColumns",controlType:"multiselect",title:"",value:"",iconClass:"icon-insert-template",toolTip:"select columns",sections:[{heading:"none",divider:"no",options:o}],applyButtonConfig:{text:"Apply","function":function(n){var o=n.selectedKeys,u,e,r,t,s;for(u in n.sections){e=n.sections[u];r=e.options;for(t in r)s=r[t],i.inArray(t,o)!=-1?f.SetAttribute(null,t,"Visible","1",0):f.SetAttribute(null,t,"Visible","0",0)}f.Rerender()}},onchangeFunction:function(){}},{controlId:"ddlViewControl",controlType:"dropdown",title:"View:",value:n.views.currentView.name,iconClass:"none",sections:[l,{heading:"none",divider:"yes",options:[{iconClass:"icon-pencil icon-dropdown",text:"Rename View",events:[{eventName:"click","function":function(){n.views.showRenameDialog()}}]},{iconClass:"icon-disk icon-dropdown",text:"Save View",events:[{eventName:"click","function":function(){n.views.showSaveDialog()}}]},{iconClass:"fui-cross icon-dropdown",text:"Delete View",events:[{eventName:"click","function":function(){n.views.remove()}}]}]}]}]}];window.epmLiveGenericToolBar.generateToolBar(t,nt)}else setTimeout(r,500)})()},getNewFormUrl:"",isViewApplied:!1,areReportsLoaded:!1};window.Grids.OnClick=function(t,i,r,u,f,e){var s,c,h,o;if(n.ribbonBehavior==0&&window.SelectRibbonTab("Ribbon.ResourceGridTab",!0),n.actions.hideEasyScroll(!0),i.Kind==="Data"&&i.Def.Name==="R"){if(e.shiftKey&&e.ctrlKey||!e.shiftKey&&!e.ctrlKey?(c=i.Selected,r!=="Panel"&&t.ActionClearSelection(),s=t.SelectRow(i,!c)):e.shiftKey?(h=t.GetSelRows(),t.ActionClearSelection(),s=h?t.SelectRange(h[0],null,i,null,1,1):t.SelectRow(i,!i.Selected)):s=t.SelectRow(i,!i.Selected),s!==null)return window.RefreshCommandUI(),!0}else if(i.Def.Name==="Group"){if(r==="Panel"){for(t.SelectRow(i,!i.Selected),o=i.firstChild;o;)t.SelectRow(o,i.Selected),o=o.nextSibling;return window.RefreshCommandUI(),!0}}else i.Kind==="Header"&&r==="Panel"&&(n.allSelected=!n.allSelected,window.setTimeout(function(){window.RefreshCommandUI()},100))};window.Grids.OnMouseOutRow=function(n,t){n.SetAttribute(t,"Title","ButtonText"," ",1)};window.Grids.OnMouseOverOutside=function(n){n.CurHoverRow&&n.SetAttribute(n.GetRowById(n.CurHoverRow),"Title","ButtonText"," ",1);n.CurHoverRow="0"};window.Grids.OnMouseOverRow=function(n,t){n.CurHoverRow!=t.id&&(n.CurHoverRow=t.id,CurrentGrid=n,n.GetValue(t,"itemid")!=""&&(n.SetAttribute(t,"Title","ButtonText",'<div class="gridmenuspan" style="position:absolute;overflow:visible" id="'+t.id+'"><a data-itemid="'+n.GetValue(t,"itemid")+'" data-listid="'+n.GetValue(t,"listid")+'" data-webid="'+n.GetValue(t,"webid")+'" data-siteid="'+n.GetValue(t,"siteid")+'" ><\/a><\/div>',1),window.epmLiveNavigation.addContextualMenu(i("#"+t.id),[],!1,!1,{edit:"window.epmLiveResourceGrid.grid.contextMenuResourceChanged","delete":"window.epmLiveResourceGrid.grid.contextMenuResourceDelete"})))};window.Grids.OnExpand=function(n){i.browser.msie&&window.setTimeout(function(){n.Update();n.SetScrollTop(n.GetScrollTop()+2);n.SetScrollTop(n.GetScrollTop()-2);n.Update()},4e3)};window.Grids.OnColumnsChanged=function(n,t){var f=n.GetLastCol("0"),r,i;for(r in t)t[r]&&n.MoveCol(r,f,!0,0);if(i=t.ProfilePic,!i&&!t.length)try{i=t.ProfilePic}catch(e){}i!==u&&(n.SetAttribute(null,"ProfilePic","Visible","0",0),n.Rerender())};window.Grids.OnReady=function(t){window.epmLive.resourceGridId=t.id;n.id(t.id);n.views.load();n.reports.load();n.actions.createToolBar("test")};window.Grids.OnUpdated=function(){n.grid.resetNoDataRow()};window.Grids.OnLoaded=function(r){var o=i.browser.msie?20:5,f=n.webpartHeight,u=f,e;f||(u=i("#s4-workspace").height()-(i("#s4-titlerow").height()+i("#EPMLiveStatusbar").height()+i("#EPMLiveStatusbarTemplate").height()+i("#EPMLiveStatuTemplate").height()+i("#s4-statusbarcontainer").height()+o)-100);(!window.epmLiveMasterPageVersion||window.epmLiveMasterPageVersion<5.5)&&(n.loader?(t.utils.fireEvent(document.getElementById("MSOZoneCell_WebPart"+n.webpartQualifier),"mouseup"),n.loader.close()):i("#ResourceGridLoader").hide());r.MaxVScroll=u;f||(i("#MSOZoneCell_WebPart"+n.webpartQualifier).height(u),i("#WebPart"+n.webpartQualifier).height(u));e=i(window);n.winHeight=e.height();e.resize(function(){var t=i(this).height(),f=n.winHeight,u;u=t<f?-(f-t):t-f;u+=100;u!==0&&(r.MaxVScroll+=u,n.winHeight=t)});window.setTimeout(function(){n.actions.loadRibbon()},1500);i("#s4-workspace").click(function(){n.ribbonBehavior==0&&window.SelectRibbonTab("Ribbon.ResourceGridTab",!0)})};window.Grids.OnGetHtmlValue=function(n,t,i,r){if(t.Def.Name==="Group"){if(i!=="Panel"&&i!=="Title")return""}else if(n.Cols[i]&&n.Cols[i].Type==="Lines")return r};window.Grids.OnGetColor=function(n,t,r,u,f,e){if(r==="Title"&&(u===230||u===180||u===255)&&(f===242||f===217||f===255)&&(e===251||e===243||e===255)&&t.r0){var o=i(t.r0).find(".GSCellPanel");o&&(u===230&&f===242&&e===251?i(o).addClass("EPMLiveResourceGridPanelHovered"):u===180&&f===217&&e===243?i(o).addClass("EPMLiveResourceGridPanelHoveredSelected"):i(o).removeClass("EPMLiveResourceGridPanelHovered EPMLiveResourceGridPanelHoveredSelected"))}return null};window.SP.SOD.notifyScriptLoadedAndExecuteWaitingJobs("EPMLive.ResourceGrid.js")})(window.epmLiveResourceGrid=window.epmLiveResourceGrid||{},window.epmLive,window.jQuery,window.ko)}ExecuteOrDelayUntilScriptLoaded(registerEpmLiveResourceGridScript,"EPMLive.js");window.console||(console={});console.error=console.error||function(){};console.log=console.log||function(){};
/*
//# sourceMappingURL=EPMLive.ResourceGrid.min.js.map
*/