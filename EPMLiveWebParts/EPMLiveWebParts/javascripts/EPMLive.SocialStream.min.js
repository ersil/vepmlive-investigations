(function(n,t,i,r){"use strict";var f=function(){var u=function(){var h={root:n("#epm-social-stream")},u={day:i.compile(n("script#epm-se-day-template").html()),thread:i.compile(n("script#epm-se-thread-template").html()),activity:i.compile(n("script#epm-se-activity-template").html()),_singleNonCommentThread:n("script#_epm-se-single-non-comment-thread").html(),_commentThread:n("script#_epm-se-comment-thread").html(),_generalThread:n("script#_epm-se-general-thread").html(),_threadInfo:n("script#_epm-se-thread-info").html(),_avatar:n("script#_epm-se-avatar").html(),_user:n("script#_epm-se-user").html(),_time:n("script#_epm-se-time").html(),_threadIcon:n("script#_epm-se-thread-icon").html()},o=function(){r.lang("en",{calendar:{lastDay:"[Yesterday -]  MMMM D",sameDay:"[Today -] MMMM D",nextDay:"[Tomorrow -] MMMM D",lastWeek:"[Last] dddd [-] MMMM D",nextWeek:"dddd [-] MMMM D",sameElse:"MMMM D YYYY"}})},c=function(){o();i.registerPartial("single-non-comment-thread",u._singleNonCommentThread);i.registerPartial("comment-thread",u._commentThread);i.registerPartial("general-thread",u._generalThread);i.registerPartial("thread-info",u._threadInfo);i.registerPartial("avatar",u._avatar);i.registerPartial("user",u._user);i.registerPartial("time",u._time);i.registerPartial("thread-icon",u._threadIcon);t.subscribe("se.dataLoaded",function(n){a(n)})},l=function(i){var u="/"+window.epmLive.currentWebUrl.slice(1)+"/_vti_bin/SocialEngine.svc/activities",f,r;if(i){u+="?";f=[];for(r in i)i.hasOwnProperty(r)&&f.push(r+"="+i[r]);u+=f.join("&")}n.getJSON(u).then(function(n){t.publish("se.dataLoaded",n)})},a=function(n){for(var i=0;i<n.days.length;i++)t.publish("se.dayLoaded",n.days[i],n)},f=function(){var n=function(n,t){for(var i,f,u,r=0;r<t.length;r++)if(i=t[r],i.id===n){f={};for(u in i)i.hasOwnProperty(u)&&(f[u]=i[u]);return f}return null};return{getById:n}}(),e=function(){var n=function(n){return n.id===parseInt(window.epmLive.currentUserId)?"You":n.name.split(" ")[0]},t=function(n){return n.id===parseInt(window.epmLive.currentUserId)?"You":n.name};return{getDisplayName:n,getFullDisplayName:t}}(),v=function(){var n=h.root.find("ul#epm-se-days"),i=function(i,f){i.domId=i.id.split("T")[0];var e=n.find("li#epm-se-"+i.domId);e.length?t.publish("se.dayRendered",i,f,e):(i.day=r(i.id).calendar(),n.append(u.day(i)),t.publish("se.dayRendered",i,f,n.find("li#epm-se-"+i.domId)))};t.subscribe("se.dayLoaded",function(n,t){i(n,t)})}(),s=function(){var s=function(n){return n.kind.toLowerCase()},i=function(n){var t=r(n.time);return r.lang("en",{calendar:{lastDay:"[Yesterday]  MMM D",sameDay:"[Today] MMM D",nextDay:"[Tomorrow] MMM D",lastWeek:"[Last] ddd MMM D",nextWeek:"ddd MMM D",sameElse:"MMMM D YYYY"}}),t=t.calendar(),o(),t},h=function(n){switch(n.kind){case"CREATED":return"icon-plus-2";case"UPDATED":return"icon-pencil";default:return null}},c=function(activity){switch(activity.kind){case"CREATED":return"created this item";case"UPDATED":return"made an update";case"COMMENTADDED":return eval("("+activity.metaData+")").comment;default:return null}},n=function(n,t){var r=f.getById(n,t.activities);return r.text=c(r),r.icon=h(r),r.displayTime=i(r),r.user=f.getById(r.user,t.users),r.user.displayName=e.getFullDisplayName(r.user),r.notComment=r.kind!=="COMMENTADDED",r},l=function(t,i,r,f){for(var c,o,a,s,y,e=0;e<t.todaysActivities.length;e++){var h=t.todaysActivities[e],p="ul.epm-se-todays-activities li#epm-se-"+h,w=f.find(p);w.length||(c=n(h,r),f.find("ul.epm-se-todays-activities").append(u.activity(c)))}for(o=0;o<t.newerActivities.length;o++){var l=t.newerActivities[o],b="ul.epm-se-newer-activities li#epm-se-"+l,k=f.find(b);k.length||(a=n(l,r),f.find("ul.epm-se-newer-activities").append(u.activity(a)))}for(s=0;s<t.newerActivities.length;s++){var v=t.newerActivities[s],d="ul.epm-se-previous-activities li#epm-se-"+v,g=f.find(d);g.length||(y=n(v,r),f.find("ul.epm-se-previous-activities").append(u.activity(y)))}};return t.subscribe("se.threadRendered",function(n,t,i,r){l(n,t,i,r)}),{getAction:s,getDisplayTime:i}}(),y=function(){var n=function(n,t){return n.activity=f.getById(n.activities[0],t.activities),n.isCommentThread=!n.list&&!n.activity.itemId,n.isSingleNonCommentThread=!n.isCommentThread&&n.activities.length===1&&n.activity.kind!=="COMMENTADDED",n.activity.action=s.getAction(n.activity),n.activity.displayTime=s.getDisplayTime(n.activity),n.user=f.getById(n.activity.user,t.users),n.user.displayName=n.isCommentThread?e.getFullDisplayName(n.user):e.getDisplayName(n.user),n.web=f.getById(n.web,t.webs),n.web.isCurrentWorkspace=n.web.id.toLowerCase()===window.epmLive.currentWebId.toLowerCase(),n.list=f.getById(n.list,t.lists),n.icon=n.list.icon||"icon-square",n},i=function(i,r,f,e,o){var s=r,h;s.domId="ul li#epm-se-"+s.id;h=o.find(s.domId);h.length?t.publish("se.threadRendered",i,s,e,h):(s=n(s,e),o.find("ul.epm-se-threads").append(u.thread(s)),t.publish("se.threadRendered",i,s,e,o.find(s.domId)))},r=function(n,t,r){for(var e,o,u=0;u<n.activityThreads.length;u++)e=f.getById(n.activityThreads[u],t.activityThreads),o=f.getById(e.thread,t.threads),i(e,o,n,t,r)};t.subscribe("se.dayRendered",function(n,t,i){r(n,t,i)})}();return{configure:c,load:l}}();u.configure();u.load({limit:20})},u=function(){window.epmLive?f():window.setTimeout(function(){u()},1)};n(function(){u()})})(jQuery,amplify,Handlebars,moment);
/*
//# sourceMappingURL=EPMLive.SocialStream.min.js.map
*/