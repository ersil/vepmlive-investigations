(function(n,t,i,r){"use strict";var f=function(){var u=function(){function l(){r.lang("en",{calendar:{lastDay:"[Yesterday -]  MMMM D",sameDay:"[Today -] MMMM D",nextDay:"[Tomorrow -] MMMM D",lastWeek:"[Last] dddd [-] MMMM D",nextWeek:"dddd [-] MMMM D",sameElse:"MMMM D YYYY"}})}function y(){i.registerPartial("user-avatar",f._userAvatar);i.registerPartial("thread-icon",f._threadIcon);i.registerPartial("thread-title",f._threadTitle);i.registerPartial("thread-info",f._threadInfo);i.registerPartial("activity-icon",f._activityIcon);i.registerPartial("user-info",f._userInfo);i.registerPartial("activity-info",f._activityInfo);i.registerPartial("activity-time",f._activityTime);i.registerPartial("object-info",f._objectInfo)}function p(n){for(var i=0;i<n.threads.length;i++)t.publish("se.threadLoaded",n.threads[i],n)}function w(){t.subscribe("se.dataLoaded",function(n){p(n)});t.subscribe("se.threadLoaded",function(n,t){a.render(n,t)});t.subscribe("se.threadRendered",function(n,t,i){s.render(n,t,i);v.render(n,t,i)});e.root.on("mouseenter",".epm-se-has-tooltip",function(){c.showTooltip(n(this))});e.root.on("click","a.epm-se-link",function(t){c.navigate(n(this),t)})}var u={pagination:{isLoading:!1,firstTimeLoad:!0,page:1,limit:10,activityLimit:1,commentLimit:2},apiUrl:"/"+window.epmLive.currentWebUrl.slice(1)+"/_vti_bin/SocialEngine.svc"},e={root:n("#epm-social-stream"),content:n(document.getElementById("s4-workspace")),pagination:n("#epm-social-stream div#epm-se-pagination span"),noActivity:n("#epm-social-stream div#epm-se-no-activity"),threads:n("#epm-social-stream ul#epm-se-threads")},f={thread:i.compile(n("script#epm-se-thread-template").html()),activity:i.compile(n("script#epm-se-activity-template").html()),comment:i.compile(n("script#epm-se-comment-template").html()),_userAvatar:i.compile(n("script#_epm-se-user-avatar-template").html()),_threadIcon:i.compile(n("script#_epm-se-thread-icon-template").html()),_threadTitle:i.compile(n("script#_epm-se-thread-title-template").html()),_threadInfo:i.compile(n("script#_epm-se-thread-info-template").html()),_activityIcon:i.compile(n("script#_epm-se-activity-icon-template").html()),_userInfo:i.compile(n("script#_epm-se-user-info-template").html()),_activityInfo:i.compile(n("script#_epm-se-activity-info-template").html()),_activityTime:i.compile(n("script#_epm-se-activity-time-template").html()),_objectInfo:i.compile(n("script#_epm-se-object-info-template").html())},h=function(){function n(n){if(window.epmLive.currentUserTimeZone)try{return r.tz(n,window.epmLive.currentUserTimeZone.olsonName)}catch(t){window.epmLive.debugMode&&console.log(t.message)}return n}var t=function(t,i){var u=i?t:n(t);return r.lang("en",{calendar:{lastDay:"[Yesterday]  MMM D",sameDay:"[Today] MMM D",nextDay:"[Tomorrow] MMM D",lastWeek:"[Last] ddd MMM D",nextWeek:"ddd MMM D",sameElse:"MMMM D YYYY"}}),u=u.calendar(),l(),u},i=function(n){return parseInt(window.epmLive.currentUserId)===n.id?"You":n.displayName.split(" ")[0]},u=function(n){return window.epmLive.currentWebUrl+"/_layouts/15/userdisp.aspx?ID="+n.id};return{getFriendlyTime:t,getUserFriendlyName:i,getUserProfileUrl:u}}(),c=function(){var n=function(n,t){var i=n.data("kind");i!=="Workspace"&&(t.preventDefault(),OpenCreateWebPageDialog(n.attr("href")))};return{navigate:n}}(),o=function(){var n=function(n,t){for(var i,f,u,r=0;r<t.length;r++)if(i=t[r],i.id===n){f={};for(u in i)i.hasOwnProperty(u)&&(f[u]=i[u]);return f}return null};return{getById:n}}(),a=function(){function n(n,t){var r="1986-11-06T13:03:00",i={time:r},f={time:r},e;return(n.activities.length&&(i=n.activities[0]),n.comments.length&&(f=n.comments[0]),i.time===r&&f.time===r)?!1:(e=i.time>f.time?i:f,n.user=o.getById(e.userId,t.users),n.kind==="Workspace"?n.icon="icon-tree-2":(n.list=o.getById(n.listId,t.lists),n.list.icon=n.list.icon||"icon-square",n.icon=n.list.icon,window.epmLive.currentWebId!==n.webId&&(i.web=o.getById(n.webId,t.webs))),n.hasMoreActivities=n.totalActivities>u.pagination.activityLimit,n.hasMoreComments=n.totalComments>u.pagination.commentLimit,n.hasComments=n.totalComments>0,n)}var i=function(i,r){var u="li#epm-se-thread-"+i.id,o=e.threads.find(u);o.length?t.publish("se.threadRendered",i,o,r):(i=n(i,r))&&(e.threads.append(f.thread(i)),t.publish("se.threadRendered",i,e.threads.find(u),r))};return{render:i}}(),s=function(){function u(t,u,f){if(u.comments.length){var e=u.comments[0];e.time>t.time&&(t=e,t.icon="icon-bubble-12",t.action="made a comment")}return t.icon||(t=n(t,u)),t=i(t,f),r(t)}function e(t,u,f){return t=n(t,u),t=i(t,f),r(t)}function s(n,i,r){var e=n.activities[0],o="ul.epm-se-activities li#epm-se-activity-"+e.id,s=i.find(o);s.length?t.publish("se.firstActivityRendered",e,s,r):(e=u(e,n,r))&&(i.find("ul.epm-se-activities").append(f.activity(e)),t.publish("se.firstActivityRendered",e,i.find(o),r))}function c(n,i,r){for(var o=0;o<n.activities.length;o++){var u=n.activities[o],s="ul.epm-se-activities li#epm-se-activity-"+u.id,h=i.find(s);h.length||(s="ul.epm-se-older-activities li#epm-se-activity-"+u.id,h=i.find(s),h.length?t.publish("se.olderActivityRendered",u,h,r):(u=e(u,n,r))&&(i.find("ul.epm-se-older-activities").append(f.activity(u)),t.publish("se.olderActivityRendered",u,i.find(s),r)))}}var l=function(n,t,i){s(n,t,i);c(n,t,i)},n=function(n,t){var i=(t.kind==="ListItem"?"item":t.kind).toLowerCase();switch(n.kind){case"Created":n.icon="icon-plus-2";n.action="created this "+i;break;case"Updated":n.icon="icon-pencil";n.action="made an update"}return n},i=function(n,t){return n.user=o.getById(n.userId,t.users),n.user.friendlyName=h.getUserFriendlyName(n.user),n.user.profileUrl=h.getUserProfileUrl(n.user),n},r=function(n){return n.friendlyTime=h.getFriendlyTime(n.time),n};return{render:l,setIconAndAction:n,setUser:i,setTime:r}}(),v=function(){function n(comment,thread,data){return comment=s.setIconAndAction(comment,thread),comment=s.setUser(comment,data),comment=s.setTime(comment),comment.text=eval("("+comment.data+")").comment,comment}var i=function(i,r,u){for(var o=0;o<i.comments.length;o++){var e=i.comments[o],s="ul.epm-se-comments li#epm-se-comment-"+e.id,h=r.find(s);e.length?t.publish("se.commentRendered",e,h,u):(e=n(e,i,u))&&(r.find("ul.epm-se-comments").append(f.comment(e)),t.publish("se.commentRendered",e,r.find(s),u))}};return{render:i}}(),b=function(){l();y();w()},k=function(i){var f,o,r;i=i||{page:u.pagination.page,limit:u.pagination.limit,activityLimit:u.pagination.activityLimit,commentLimit:u.pagination.commentLimit};u.pagination.isLoading=!0;f=u.apiUrl+"/activities?";o=[];for(r in i)i.hasOwnProperty(r)&&o.push(r+"="+i[r]);f+=o.join("&");n.getJSON(f).then(function(n){e.pagination.hide();n.threads.length?(t.publish("se.dataLoaded",n),u.pagination.page++):u.pagination.page=0;u.pagination.isLoading=!1;u.pagination.firstTimeLoad&&n.threads.length===0&&e.noActivity.fadeIn("fast");u.pagination.firstTimeLoad=!1})};return{configure:b,load:k}}();u.configure();u.load()},u=function(){window.epmLive?f():window.setTimeout(function(){u()},1)};n(function(){u()})})(jQuery,amplify,Handlebars,moment);
/*
//# sourceMappingURL=EPMLive.SocialStream.min.js.map
*/