using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Web.Fakes;
using System.Web.UI;
using System.Web.UI.Fakes;
using EPMLiveCore;
using EPMLiveCore.Fakes;
using EPMLiveWebParts.Fakes;
using Microsoft.SharePoint;
using Microsoft.SharePoint.Fakes;
using Microsoft.SharePoint.WebPartPages.Fakes;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Shouldly;

namespace EPMLiveWebParts.Tests
{
    public partial class GridListViewTests
    {
        private HtmlTextWriter writer;
        private SPWeb web;
        private NameValueCollection queryString;
        private StringBuilder writerContent;
        private int writeCount;
        private const string DummyString = "dummy";
        private const string DummyUrl = "http://fake.url";
        

        private void SetupShims()
        {
            writerContent = new StringBuilder();
            writeCount = 0;
            writer = new ShimHtmlTextWriter()
            {
                WriteString = (text) =>
                {
                    writerContent.Append(text);
                    writeCount++;
                },
                WriteLineString = (text) =>
                {
                    writerContent.AppendLine(text);
                    writeCount++;
                },
            }.Instance;
            web = _sharepointShims.WebShim.Instance;
            ShimSPWeb.AllInstances.LocaleGet = _ => CultureInfo.InvariantCulture;
            ShimSPWeb.AllInstances.UrlGet = _ => DummyUrl;
            ShimSPView.AllInstances.UrlGet = _ => DummyUrl;
            ShimSPView.AllInstances.ServerRelativeUrlGet = _ => DummyUrl;
            ShimSPView.AllInstances.TitleGet = _ => DummyString;
            ShimSPBaseCollection.AllInstances.GetEnumerator = _ => new List<SPForm>
            {
                _sharepointShims.FormShim.Instance
            }.GetEnumerator();
            queryString = new NameValueCollection
            {
                { "epmdebug", "true" }
            };
            
        }

        private ShimSPViewFieldCollection GetSPViewFieldCollectionShim()
        {
            var result = new ShimSPViewFieldCollection();
            result.Bind(new[] { "test-field-1", "test-field-2" });
            return result;
        }

        [TestMethod]
        public void RenderGantt_GivenArguments_SetBigHeight_ConfirmOutput()
        {
            // Arrange
            SetupShims();
            ShimWebPart.AllInstances.HeightGet = (_) => "99999999";

            // Act
            _testablePrivate.Invoke("renderGantt", 
                new object[] { writer, web });

            // Assert
            _testablePrivate.ShouldSatisfyAllConditions(
                () => writeCount.ShouldBe(156),
                () => writerContent.ToString().Length.ShouldBe(25449),
                () => writerContent.ToString().ShouldBe("<script type=\"text/javascript\" src=\"_layouts/epmlive/modal/modal.js\"></script> <div id=\"leftUpperDiv\"><div id=\"searchloadtest-grid-id\" style=\"display:none\">\r\n<div id=\"searchdivtest-grid-id\" style=\"\">\r\n<script language=\"javascript\">\r\nvar searchfieldstest-grid-id = {}\r\nfunction switchsearchtest-grid-id()\n            {\n                var searcher = document.getElementById('searchtest-grid-id');\n                var searchtext = document.getElementById('searchtexttest-grid-id');\n                var searchchoice = document.getElementById('searchchoicetest-grid-id');\n                var searchtypechoice = document.getElementById('searchtypetest-grid-id');\n                var searchfield = searcher.options[searcher.selectedIndex].value;\n                var sList = searchfieldstest-grid-id[searchfield];\n                if(sList) {\n                    searchtext.style.display='none';\n                    searchchoice.style.display='';\n                    searchchoice.options.length = 0;\n                    searchtypechoice.options[2].selected = true;\n                    searchtypechoice.disabled = true;\n                    for(var i=0; i < sList.length; i++) {\n                        var d = sList[i];\n                        searchchoice.options.add(new Option(d, d));\n                        if(d=='test-search-string') {\n                            searchchoice.options[searchchoice.options.length-1].selected = true;\n                        } \n                    } \n                } else {\n                    searchtext.style.display='';\n                    searchchoice.style.display='none';\n                    searchtypechoice.disabled = false;\n                }\n            }\r\nfunction unSearchtest-grid-id(){\r\n                var unsearch = document.getElementById('unsearchtest-grid-id');\r\n                unsearch.style.display=\"none\";\r\n                var searchtext = document.getElementById('searchtexttest-grid-id');\r\n                searchtext.value = '';\r\n                GridUnSearch('test-grid-id');\r\n            }\r\nfunction doSearchtest-grid-id(){\r\n                var searcher = document.getElementById('searchtest-grid-id');\r\n                var unsearch = document.getElementById('unsearchtest-grid-id');\r\n                unsearch.style.display=\"table-cell\";\r\n                var searchchoice = document.getElementById('searchchoicetest-grid-id');\r\n                var searchtext = document.getElementById('searchtexttest-grid-id');\r\n                var searchtypechoice = document.getElementById('searchtypetest-grid-id');\r\n                var searchfield = searcher.options[searcher.selectedIndex].value;\r\n                var searchtype = searchtypechoice.options[searchtypechoice.selectedIndex].value;\r\n                var sList = searchfieldstest-grid-id[searchfield];\r\n                var searchvalue = \"\";\r\n                if(sList){\r\n                    searchvalue = searchchoice.options[searchchoice.selectedIndex].value;\r\n                } else { \r\n                    searchvalue = searchtext.value;\r\n                }\r\n                \r\n                GridSearch('test-grid-id', searcher.options[searcher.selectedIndex].value, searchvalue, searchtype);\r\n                \r\n            }\r\nfunction enablesearchertest-grid-id(){\r\n            }\r\nfunction searchKeyPresstest-grid-id(e){\r\n                if(e.keyCode == 13) { \r\n                    doSearchtest-grid-id();\r\n                }\r\n                return false;\r\n            }\r\n</script>\r\n<div id=\"search\" style=\"width:100%; height:40px;\" class=\"ms-listviewtable\"><table><tr><td style=\"color: #A3A3A3; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 14px;\">\r\nSearch: <select id=\"searchtest-grid-id\" onChange=\"switchsearchtest-grid-id();\" class=\"form-control\">\r\n                \r\n            </select>&nbsp;&nbsp;<select id=\"searchtypetest-grid-id\" class=\"form-control\">\r\n                <option value=\"1\" selected>Contains</option>\r\n                <option value=\"8\" >Begins With</option>\r\n                <option value=\"2\" >Equals</option>\r\n                <option value=\"3\" >Does Not Equal</option>\r\n                <option value=\"4\" >Greater Than</option>\r\n                <option value=\"5\" >Greater Than or Equal</option>\r\n                <option value=\"6\" >Less Than</option>\r\n                <option value=\"7\" >Less Than or Equal</option>\r\n            </select>\r\n&nbsp;&nbsp;</td><td>\r\n<div style=\"border: 1px solid #CCC;width: 200px;height: 30px;\">\n                <div id=\"unsearchtest-grid-id\" class=\"\" style=\"padding-left:4px;display: table-cell;min-width: 12px;align:top\">\n                    <img alt=\"Clear Search\" src=\"/_layouts/epmlive/images/unsearch.png\" style=\"padding-bottom:2px\" onclick=\"unSearchtest-grid-id()\"/>\n                </div>\n                <div style=\"display: table-cell\">\n                    <input type=\"text\" id=\"searchtexttest-grid-id\" value=\"test-search-string\" style=\"border: 0px; width:100%; margin-top:-5px; height:24px; font-family: 'Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;font-size:13px\" onkeypress=\"searchKeyPresstest-grid-id(event);\"/>\n                    <select id=\"searchchoicetest-grid-id\" style=\"border: 0px; width:100%\">\n                    </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                </div>\n                <div class=\"\" style=\"padding-right:2px; padding-left:10px;padding-top:5px;display: table-cell;min-width: 10px;cursor:pointer\">\n                    <img onclick=\"doSearchtest-grid-id()\" src=\"/_layouts/epmlive/images/find_icon.png\"/>\n                </div>\n            </div>\r\n</td></tr></table>\r\n</div>\r\n<script language=\"javascript\">switchsearchtest-grid-id();</script>\r\n</div>\r\n</div>\r\n</div><div id=\"rightUpperDiv\" ><table id=pagetabletest-grid-id><tr><td></div><div  width=\"100%\" id=\"loadinggridtest-grid-id\" align=\"center\"></div><div style=\"height: 99999969overflow:hidden;\" id=\"gridoutertest-grid-id\"><div id=\"griddivtest-grid-id\" style=\"width:100%;height:100%\">\r\n</div>\r\n</div><script language=\"javascript\">\r\nepmdebug=false\r\nfunction LoadGridtest-grid-id(){ LoadGrid('test-grid-id');}\r\nSP.SOD.executeOrDelayUntilScriptLoaded(LoadGridtest-grid-id, 'EPMLive.js');\r\nfunction NextPagetest-grid-id(){\r\nif(mygridtest-grid-id.PAGElastItem != 0){\r\nGrids[\"GanttGridtest-grid-id\"].Data.Data.Url = DataUrltest-grid-id + '&Page=' + mygridtest-grid-id.PAGElastItem;\r\nGrids[\"GanttGridtest-grid-id\"].Reload();\r\n}}\r\nfunction PreviousPagetest-grid-id(){\r\nif(mygridtest-grid-id.PAGEfItemHide != mygridtest-grid-id.PAGEfirstItem){\r\nGrids[\"GanttGridtest-grid-id\"].Data.Data.Url = DataUrltest-grid-id + '&Page=' + mygridtest-grid-id.PAGEfirstItem;\r\nGrids[\"GanttGridtest-grid-id\"].Reload();\r\n}}\r\nTGSetEvent(\"OnReady\", \"GanttGridtest-grid-id\", GridOnReady);\r\nTGSetEvent(\"OnLoaded\", \"GanttGridtest-grid-id\", GridOnLoaded);\r\nDataUrltest-grid-id = 'http://fake.url/_layouts/epmlive/getganttitems.aspx?data='\r\nOnlyGrid = false;\r\nArrGantts.push('GanttGridtest-grid-id');\r\nmygridtest-grid-id = new Object();\r\nmygridtest-grid-id.RibbonBehavior='';\r\nmygridtest-grid-id.GridHeight=99999969;\r\nmygridtest-grid-id.GanttStart='';\r\nmygridtest-grid-id.DecimalSeparator='.';\r\nmygridtest-grid-id.GroupSeparator=',';\r\nmygridtest-grid-id.Searcher='&searchfield=test-search-field&searchvalue=test-search-string&searchtype=1';\r\nmygridtest-grid-id.Qualifier='';\r\nmygridtest-grid-id.ForceSearch=true;\r\nmygridtest-grid-id.loaded = false\r\nmygridtest-grid-id.CurPage = 0;\r\nmygridtest-grid-id.Cols = ''\r\nmygridtest-grid-id.LinkType = ''\r\nvar myDataProcessortest-grid-id = new Object();\r\nmygridtest-grid-id.Params = \"\";\r\nmygridtest-grid-id.PageSize = '0';\r\nmygridtest-grid-id.UseReporting = false;\r\ncurPagetest-grid-id = 0;\r\nmygridtest-grid-id._epkview = '';\r\nmygridtest-grid-id._useparent = false;\r\nmygridtest-grid-id._curPlanner = '';\r\nmygridtest-grid-id._epkurl = '';\r\nmygridtest-grid-id._epkcostview = '';\r\nmygridtest-grid-id.canribbon = true;\r\nmygridtest-grid-id.addFocusedCommands = function($arr){\r\nreturn $arr;}\r\nmygridtest-grid-id.getGlobalCommands = function($arr){return $arr;}\r\nmygridtest-grid-id.canHandleCommand = function($Grid, commandId){\r\nreturn false;}\r\nmygridtest-grid-id.handleCommand = function($Grid, commandId, properites){if(typeof(properties) != 'undefined')return properties;}\r\nmygridtest-grid-id._webpartid = '';\r\nmygridtest-grid-id._outlookexport = '';\r\nmygridtest-grid-id._gridMode = '';\r\nmygridtest-grid-id._hasTemplateList = false;\r\nmygridtest-grid-id._newmenumode = 0;\r\nmygridtest-grid-id._newitemurl = 'test-server-url';\r\nmygridtest-grid-id._newfolder = false;\r\nmygridtest-grid-id._newmenu = \"<Button Id=\\'Ribbon.ListItem.New.NewListItem\\' Command=\\'NewItem\\' CommandValueId=\\'NewListItem\\' LabelText=\\'New Item\\' Description=\\'Create a New Item\\' Image32by32=\\'/_layouts/0/images/formatmap32x32.png\\' CommandType=\\'OptionSelection\\' Image32by32Top=\\'-160\\' Image32by32Left=\\'-384\\'/>\"\r\nmygridtest-grid-id._modifylist = false;\r\nmygridtest-grid-id._listperms = false;\r\nmygridtest-grid-id._shownewmenu = true;\r\nmygridtest-grid-id._allowedit = false;\r\nmygridtest-grid-id._listid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._webid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._listname = '';\r\nmygridtest-grid-id._viewid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._viewurl = 'http://fake.url/http://fake.url';\r\nmygridtest-grid-id._siteurl = '';\r\nmygridtest-grid-id._webrelurl = 'test-server-url';\r\nmygridtest-grid-id._viewname = 'dummy';\r\nmygridtest-grid-id._basetype = 'GenericList';\r\nmygridtest-grid-id._templatetype = '0';\r\nmygridtest-grid-id._newrow = false;\r\nmygridtest-grid-id._rolluplists = '';\r\nmygridtest-grid-id._brollups = false;\r\nmygridtest-grid-id._requestList = false;\r\nmygridtest-grid-id._usepopup = false;\r\nmygridtest-grid-id._lookupfield = '';\r\nmygridtest-grid-id._lookupfieldlist = '';\r\nmygridtest-grid-id._excell = 'test-server-url\\u002f_vti_bin\\u002fowssvr.dll?CS=65001\\u0026Using=_layouts\\u002fquery.iqy\\u0026List=\\u00257B00000000\\u00252D0000\\u00252D0000\\u00252D0000\\u00252D000000000000\\u00257D\\u0026View=\\u00257B00000000\\u00252D0000\\u00252D0000\\u00252D0000\\u00252D000000000000\\u00257D\\u0026RootFolder=http:\\u0026CacheControl=1';\r\nmygridtest-grid-id._gridid = 'test-grid-id';\r\nmygridtest-grid-id._formmenus = \"\";\r\nmygridtest-grid-id.setRowHidden = function(rowid){\n                                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                                            grid.HideRow(grid.GetRowById(rowid), true, false);\n                                                                            };\r\nmygridtest-grid-id.getTitles = function(){\n                                                                        var titles = \"\";\n                                                                        try{\n                                                                        var grid = Grids.GanttGridtest-grid-id;\n                                                                        var sRows = grid.GetSelRows();\n                                                                        var fRow = grid.FRow;\n\n                                                                        for(var sRow in sRows)\n                                                                        {\n                                                                            var row = sRows[sRow];\n                                                                            if(row.itemid != \"\" && row.id != \"indexOf\")\n                                                                            {\n                                                                                titles += \",\" + row.Title;\n                                                                            }\n                                                                        }\n\n                                                                        //if(fRow)\n                                                                        //    titles += \",\" + fRow.Title;\n\n                                                                        if(titles != \"\" && titles[0] == ',')\n                                                                            titles = titles.substring(1);\n                                                                        return titles;\n                                                                        }catch(e){}\n                                                                        };\r\nmygridtest-grid-id.getCheckedItems = function(){\n                                                \n                                 var ids = \"\";\n                                try{\n                                var grid = Grids.GanttGridtest-grid-id;\n\n                                var sRows = grid.GetSelRows();\n                                for(var sRow in sRows)\n                                {\n                                    var row = sRows[sRow];\n    \n                                    if(row.itemid != \"\" && row.id != \"indexOf\" && row.id != \"Header\")\n                                    {\n                                        ids += \",\" + row.itemid;\n                                    }\n                                }\n\n                                if(ids != \"\" && ids[0] == ',')\n                                    ids = ids.substring(1);\n                                return ids;\n                                }catch(e){return \"\";}\n                                };\r\nmygridtest-grid-id.getCheckedIds = function(){\n\n                                                                                    var ids = \"\";\n                                                                                    try{\n                                                                                    var grid = Grids.GanttGridtest-grid-id;\n\n                                                                                    var sRows = grid.GetSelRows();\n                                                                                    for(var sRow in sRows)\n                                                                                    {\n                                                                                        var row = sRows[sRow];\n    \n                                                                                        if(row.itemid != \"\" && row.id != \"indexOf\")\n                                                                                        {\n                                                                                            ids += \",\" + row.webid + \".\" + row.listid + \".\" + row.itemid;\n                                                                                        }\n                                                                                    }\n\n                                                                                    if(ids != \"\" && ids[0] == ',')\n                                                                                        ids = ids.substring(1);\n                                                                                    return ids;\n                                                                                    }catch(e){return \"\";}\n                                                                                    };\r\nmygridtest-grid-id.getCheckedRowIds = function()\n                                                        {\n                                                            try{\n                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                            return grid.FRow.id;\n                                                            }catch(e){}\n                                                        };\r\nmygridtest-grid-id.getSelectedRowId = function()\n                                                        {\n                                                            try{\n                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                            if(!grid.FRow)\n                                                            {\n                                                                var sRows = grid.GetSelRows();\n                                                                return sRows[0].id;\n                                                            }\n                                                            else\n                                                                return grid.FRow.id;\n                                                            }catch(e){}\n                                                        };\r\nmygridtest-grid-id.getUserData = function(rowid, key){  \n                                                                    try\n                                                                    {\n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    var row = grid.GetRowById(rowid);\n                                                                    return grid.GetValue(row, key);\n                                                                    }catch(e){}\n                                                                    };\r\nmygridtest-grid-id.getRowById = function(rowid){  \n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    return grid.GetRowById(rowid); \n                                                                    };\r\nmygridtest-grid-id.setRowHidden = function(row, hide){  \n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    if(hide)\n                                                                        grid.RemoveRow(row); \n                                                                    };\r\nmygridtest-grid-id.editStop = function(){  }\r\nfunction newItemtest-grid-id()\n                                    {\n                                                \n\t                                    var wurl = mygridtest-grid-id._newitemurl;\n\n                                        if(mygridtest-grid-id._newmenumode == '3')\n                                        {\n                                            newAppPopup(mygridtest-grid-id._defaultct);\n                                        }\n                                        else\n                                        {\n                                            if(wurl.indexOf('?') > 0)\n                                                wurl = wurl + '&GetLastID=true';\n                                            else\n                                                wurl = wurl + '?GetLastID=true';\n\n\t                                        if(false)\n\t                                        {\n\t\t                                        function NewItemCallback(dialogResult, returnValue)\n                                                {\n                                                    if(dialogResult){GridNewItem('test-grid-id',returnValue);}\n                                                }\n\n\t\t                                        var options = { url: wurl, width: 700, dialogReturnValueCallback:NewItemCallback };\n\n\t\t                                        SP.UI.ModalDialog.showModalDialog(options);\n\t                                        }\n\t                                        else\n\t                                        {\n\t\t                                        location.href = wurl;\n\t                                        }\n                                        }\n                                    }\r\n</script>\r\n<div id=\"dlgSavingtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Saving Items...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<div id=\"dlgRefreshtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Refreshing Data...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<div id=\"dlgErrortest-grid-id\" class=\"dialog\">\n    <table width=\"100%\" height=\"100%\" cellpadding=\"0\" cellspacing=\"3\">\n\t\t<tr>\n\t\t\t<td class=\"ms-sectionheader\"><H3 class=\"ms-standardheader\">Error: </h3></td>\n\t\t</tr>\n        <tr height=\"100%\">\n            <td align=\"left\"valign=\"top\">\n                <div id=\"dlgErrorTexttest-grid-id\" style=\"overflow: auto;height=90%;width=100%\" class=\"ms-descriptiontext\"></div><br>\n            </td>\n        </tr>\n        <tr>\n\t\t\t<td align=\"right\">\n\t\t\t\t<input type=\"button\" class=\"ms-input\" value=\"Close\" onClick=\"hm('dlgErrortest-grid-id');\">\n\t\t\t</td>\n\t\t</tr>\n    </table>\n</div>\n\n<div id=\"editItemtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\" height=\"100%\" id=\"tblEditItem\" cellpadding=\"0\" cellspacing=\"0\">\n        <tr height=\"100%\">\n            <td align=\"center\" bgcolor=\"FFFFFF\">\n                <div id=\"editItemLoadtest-grid-id\">\n                    <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/>\n                </div>\n                <iframe id=\"frmEditFrametest-grid-id\" width=\"100%\" height=\"100%\" frameborder=\"0\" src=\"http://fake.url/_layouts/epmlive/blank.gif\">\n                    \n                </iframe>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<div id=\"dlgPosting\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Posting Data...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<script>\n\nvar bPageSetuptest-grid-id;\nvar firstItemtest-grid-id;\nvar lastItemtest-grid-id;\nvar fItemHidetest-grid-id;\n\nfunction setupPagetest-grid-id(records, UseReporting, PageSize)\n{\n\n\tvar pages = Math.ceil(records / PageSize);\n\n\tvar prev = document.getElementById(\"PagePrevioustest-grid-id\");\n\tvar next = document.getElementById(\"PageNexttest-grid-id\");\n\tvar pagediv = document.getElementById(\"pagedivtest-grid-id\");\n\n\tif(UseReporting)\n\t{\n\t\tif(pages > 1)\n\t\t{\n\t\t\tif(!bPageSetuptest-grid-id)\n\t\t\t{\n\t\t\t\tbPageSetuptest-grid-id = true;\n\n\t\t\t\t$(\"#pagedivtest-grid-id\").paginate({\n\t\t\t\t\tcount \t\t: pages,\n\t\t\t\t\tstart \t\t: 1,\n\t\t\t\t\tdisplay     : 12,\n\t\t\t\t\tborder\t\t\t\t\t: true,\n\t\t\t\t\tborder_color\t\t\t: '#CCCCCC',\n\t\t\t\t\ttext_color  \t\t\t: '#666666',\n\t\t\t\t\tbackground_color    \t: '#DDDDDD',\t\n\t\t\t\t\tborder_hover_color\t\t: '#878787',\n\t\t\t\t\ttext_hover_color  \t\t: '#ffffff',\n\t\t\t\t\tbackground_hover_color\t: '#9B9B9B', \n\t\t\t\t\trotate      : false,\n\t\t\t\t\timages\t\t: false,\n\t\t\t\t\tmouse\t\t: 'press',\n\t\t\t\t\tonChange\t: ChangePagetest-grid-id\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpagediv.style.display = \"none\";\n\t\t}\n\t}\n\telse\n\t{\n\t\tpagediv.style.display = \"inline-block\";\n\n\t\tvar rec = records.split('|');\n\t\tfirstItemtest-grid-id = parseInt(rec[2]) * -1;\n\t\tlastItemtest-grid-id = rec[1];\n\n\t\tif(rec[0] == \"0\" || fItemHidetest-grid-id == firstItemtest-grid-id)\n\t\t{\n\n\t\t\tprev.style.background = \"#EFEFEF\";\n\n\t\t\tfItemHidetest-grid-id = firstItemtest-grid-id;\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tprev.style.background = \"#DDDDDD\";\n\t\t}\n\n\t\tif(rec[3] == \"true\")\n\t\t\tnext.style.background = \"#DDDDDD\";\n\t\telse\n\t\t{\n\t\t\tprev.style.background = \"#EFEFEF\";\n\t\t\tlastItemtest-grid-id = 0;\n\t\t}\n\n\t\tif(rec[3] != \"true\" && rec[0] == \"0\")\n\t\t{\n\t\t\tpagediv.style.display = \"none\";\n\t\t}\n\t}\n}\n</script><script>function maximizeWindow(){try{\r\nvar currentDialog = SP.UI.ModalDialog.get_childDialog();\r\nif(currentDialog != null){\r\nif(!currentDialog.$S_0){\r\ncurrentDialog.$z();\r\n}}}catch(e){}\r\n}\r\nExecuteOrDelayUntilScriptLoaded(maximizeWindow, 'sp.ui.dialog.js');\r\ninitmb();function clickTab(){\r\ntry{\r\nvar wp = document.getElementById('MSOZoneCell_WebPart');\r\nfireEvent(wp, 'mouseup');\r\nsetTimeout(\"clickbrowse()\",1000);\r\n}catch(e){}\r\n}\r\nfunction clickbrowse(){\r\ntry{\r\nvar wp2 = document.getElementById('Ribbon.Read-title').firstChild;\r\nfireEvent(wp2, 'click');\r\n}catch(e){}\r\n}\r\nfunction fireEvent(element,event){\n                                if (document.createEventObject){\n                                    // dispatch for IE\n                                    var evt = document.createEventObject();\n                                    return element.fireEvent('on'+event,evt)\n                                }\n                                else{\n                                    // dispatch for firefox + others\n                                    var evt = document.createEvent(\"HTMLEvents\");\n                                    evt.initEvent(event, true, true ); // event type,bubbling,cancelable\n                                    return !element.dispatchEvent(evt);\n                                }\n                            }\r\nsetTimeout(\"clickTab()\", 100);</script>"));
        }

        [TestMethod]
        public void RenderGantt_GivenArguments_RowLimitGreaterThanZero_HasSearchResultsFalse_EnableContentReporting_ConfirmOutput()
        {
            // Arrange
            SetupShims();
            ShimSPView.AllInstances.RowLimitGet = (_) => 10;
            _testablePrivate.SetField("bHasSearchResults", false);
            ((GridGanttSettings)_testablePrivate.GetField("gSettings")).EnableContentReporting = true;
            ShimHttpRequest.AllInstances.ItemGetString = (_,__) => queryString[0];

            // Act
            _testablePrivate.Invoke("renderGantt",
                new object[] { writer, web });

            // Assert
            _testablePrivate.ShouldSatisfyAllConditions(
                () => writeCount.ShouldBe(158),
                () => writerContent.ToString().Length.ShouldBe(25715),
                () => writerContent.ToString().ShouldBe("<script type=\"text/javascript\" src=\"_layouts/epmlive/modal/modal.js\"></script> <div id=\"leftUpperDiv\"><div id=\"searchloadtest-grid-id\" style=\"\">\r\n<div id=\"searchdivtest-grid-id\" style=\"\">\r\n<script language=\"javascript\">\r\nvar searchfieldstest-grid-id = {}\r\nfunction switchsearchtest-grid-id()\n            {\n                var searcher = document.getElementById('searchtest-grid-id');\n                var searchtext = document.getElementById('searchtexttest-grid-id');\n                var searchchoice = document.getElementById('searchchoicetest-grid-id');\n                var searchtypechoice = document.getElementById('searchtypetest-grid-id');\n                var searchfield = searcher.options[searcher.selectedIndex].value;\n                var sList = searchfieldstest-grid-id[searchfield];\n                if(sList) {\n                    searchtext.style.display='none';\n                    searchchoice.style.display='';\n                    searchchoice.options.length = 0;\n                    searchtypechoice.options[2].selected = true;\n                    searchtypechoice.disabled = true;\n                    for(var i=0; i < sList.length; i++) {\n                        var d = sList[i];\n                        searchchoice.options.add(new Option(d, d));\n                        if(d=='test-search-string') {\n                            searchchoice.options[searchchoice.options.length-1].selected = true;\n                        } \n                    } \n                } else {\n                    searchtext.style.display='';\n                    searchchoice.style.display='none';\n                    searchtypechoice.disabled = false;\n                }\n            }\r\nfunction unSearchtest-grid-id(){\r\n                var unsearch = document.getElementById('unsearchtest-grid-id');\r\n                unsearch.style.display=\"none\";\r\n                var searchtext = document.getElementById('searchtexttest-grid-id');\r\n                searchtext.value = '';\r\n                GridUnSearch('test-grid-id');\r\n            }\r\nfunction doSearchtest-grid-id(){\r\n                var searcher = document.getElementById('searchtest-grid-id');\r\n                var unsearch = document.getElementById('unsearchtest-grid-id');\r\n                unsearch.style.display=\"table-cell\";\r\n                var searchchoice = document.getElementById('searchchoicetest-grid-id');\r\n                var searchtext = document.getElementById('searchtexttest-grid-id');\r\n                var searchtypechoice = document.getElementById('searchtypetest-grid-id');\r\n                var searchfield = searcher.options[searcher.selectedIndex].value;\r\n                var searchtype = searchtypechoice.options[searchtypechoice.selectedIndex].value;\r\n                var sList = searchfieldstest-grid-id[searchfield];\r\n                var searchvalue = \"\";\r\n                if(sList){\r\n                    searchvalue = searchchoice.options[searchchoice.selectedIndex].value;\r\n                } else { \r\n                    searchvalue = searchtext.value;\r\n                }\r\n                \r\n                GridSearch('test-grid-id', searcher.options[searcher.selectedIndex].value, searchvalue, searchtype);\r\n                \r\n            }\r\nfunction enablesearchertest-grid-id(){\r\n            }\r\nfunction searchKeyPresstest-grid-id(e){\r\n                if(e.keyCode == 13) { \r\n                    doSearchtest-grid-id();\r\n                }\r\n                return false;\r\n            }\r\n</script>\r\n<div id=\"search\" style=\"width:100%; height:40px;\" class=\"ms-listviewtable\"><table><tr><td style=\"color: #A3A3A3; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 14px;\">\r\nSearch: <select id=\"searchtest-grid-id\" onChange=\"switchsearchtest-grid-id();\" class=\"form-control\">\r\n                \r\n            </select>&nbsp;&nbsp;<select id=\"searchtypetest-grid-id\" class=\"form-control\">\r\n                <option value=\"1\" selected>Contains</option>\r\n                <option value=\"8\" >Begins With</option>\r\n                <option value=\"2\" >Equals</option>\r\n                <option value=\"3\" >Does Not Equal</option>\r\n                <option value=\"4\" >Greater Than</option>\r\n                <option value=\"5\" >Greater Than or Equal</option>\r\n                <option value=\"6\" >Less Than</option>\r\n                <option value=\"7\" >Less Than or Equal</option>\r\n            </select>\r\n&nbsp;&nbsp;</td><td>\r\n<div style=\"border: 1px solid #CCC;width: 200px;height: 30px;\">\n                <div id=\"unsearchtest-grid-id\" class=\"\" style=\"padding-left:4px;display: table-cell;min-width: 12px;align:top\">\n                    <img alt=\"Clear Search\" src=\"/_layouts/epmlive/images/unsearch.png\" style=\"padding-bottom:2px\" onclick=\"unSearchtest-grid-id()\"/>\n                </div>\n                <div style=\"display: table-cell\">\n                    <input type=\"text\" id=\"searchtexttest-grid-id\" value=\"test-search-string\" style=\"border: 0px; width:100%; margin-top:-5px; height:24px; font-family: 'Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;font-size:13px\" onkeypress=\"searchKeyPresstest-grid-id(event);\"/>\n                    <select id=\"searchchoicetest-grid-id\" style=\"border: 0px; width:100%\">\n                    </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                </div>\n                <div class=\"\" style=\"padding-right:2px; padding-left:10px;padding-top:5px;display: table-cell;min-width: 10px;cursor:pointer\">\n                    <img onclick=\"doSearchtest-grid-id()\" src=\"/_layouts/epmlive/images/find_icon.png\"/>\n                </div>\n            </div>\r\n</td></tr></table>\r\n</div>\r\n<script language=\"javascript\">switchsearchtest-grid-id();</script>\r\n</div>\r\n</div>\r\n</div><div id=\"rightUpperDiv\" ><table id=pagetabletest-grid-id><tr><td><div style=\"margin:0px;\"><div id=\"pagedivtest-grid-id\"></div></td><td><div id=\"viewalldivtest-grid-id\" style=\"display:none;margin:0px 3px 0 0;\" class=\"jPaginate\"><a onclick=\"ViewAllPages('test-grid-id');\" style=\"color: rgb(102, 102, 102); background-color: rgb(255, 255, 255); border: 1px solid rgb(219, 219, 219);\">View All</a></div></td></tr></table></div><div  width=\"100%\" id=\"loadinggridtest-grid-id\" align=\"center\"></div><div style=\"height: 100px;overflow:hidden;\" id=\"gridoutertest-grid-id\"><div id=\"griddivtest-grid-id\" style=\"width:100%;height:100%\">\r\n</div>\r\n</div><script language=\"javascript\">\r\nepmdebug=true\r\nfunction LoadGridtest-grid-id(){ LoadGrid('test-grid-id');}\r\nSP.SOD.executeOrDelayUntilScriptLoaded(loadMenutest-grid-id, 'EPMLive.js');\r\nfunction NextPagetest-grid-id(){\r\nif(mygridtest-grid-id.PAGElastItem != 0){\r\nGrids[\"GanttGridtest-grid-id\"].Data.Data.Url = DataUrltest-grid-id + '&Page=' + mygridtest-grid-id.PAGElastItem;\r\nGrids[\"GanttGridtest-grid-id\"].Reload();\r\n}}\r\nfunction PreviousPagetest-grid-id(){\r\nif(mygridtest-grid-id.PAGEfItemHide != mygridtest-grid-id.PAGEfirstItem){\r\nGrids[\"GanttGridtest-grid-id\"].Data.Data.Url = DataUrltest-grid-id + '&Page=' + mygridtest-grid-id.PAGEfirstItem;\r\nGrids[\"GanttGridtest-grid-id\"].Reload();\r\n}}\r\nTGSetEvent(\"OnReady\", \"GanttGridtest-grid-id\", GridOnReady);\r\nTGSetEvent(\"OnLoaded\", \"GanttGridtest-grid-id\", GridOnLoaded);\r\nDataUrltest-grid-id = 'http://fake.url/_layouts/epmlive/getganttitems.aspx?data='\r\nOnlyGrid = false;\r\nArrGantts.push('GanttGridtest-grid-id');\r\nmygridtest-grid-id = new Object();\r\nmygridtest-grid-id.RibbonBehavior='';\r\nmygridtest-grid-id.GridHeight=400;\r\nmygridtest-grid-id.GanttStart='';\r\nmygridtest-grid-id.DecimalSeparator='.';\r\nmygridtest-grid-id.GroupSeparator=',';\r\nmygridtest-grid-id.Searcher='';\r\nmygridtest-grid-id.Qualifier='';\r\nmygridtest-grid-id.ForceSearch=true;\r\nmygridtest-grid-id.loaded = false\r\nmygridtest-grid-id.CurPage = 1;\r\nmygridtest-grid-id.Cols = ''\r\nmygridtest-grid-id.LinkType = ''\r\nvar myDataProcessortest-grid-id = new Object();\r\nmygridtest-grid-id.Params = \"\";\r\nmygridtest-grid-id.PageSize = '10';\r\nmygridtest-grid-id.UseReporting = true;\r\ncurPagetest-grid-id = 1;\r\nmygridtest-grid-id._epkview = '';\r\nmygridtest-grid-id._useparent = false;\r\nmygridtest-grid-id._curPlanner = '';\r\nmygridtest-grid-id._epkurl = '';\r\nmygridtest-grid-id._epkcostview = '';\r\nmygridtest-grid-id.canribbon = true;\r\nmygridtest-grid-id.addFocusedCommands = function($arr){\r\nreturn $arr;}\r\nmygridtest-grid-id.getGlobalCommands = function($arr){return $arr;}\r\nmygridtest-grid-id.canHandleCommand = function($Grid, commandId){\r\nreturn false;}\r\nmygridtest-grid-id.handleCommand = function($Grid, commandId, properites){if(typeof(properties) != 'undefined')return properties;}\r\nmygridtest-grid-id._webpartid = '';\r\nmygridtest-grid-id._outlookexport = '';\r\nmygridtest-grid-id._gridMode = '';\r\nmygridtest-grid-id._hasTemplateList = false;\r\nmygridtest-grid-id._newmenumode = 0;\r\nmygridtest-grid-id._newitemurl = 'test-server-url';\r\nmygridtest-grid-id._newfolder = false;\r\nmygridtest-grid-id._newmenu = \"<Button Id=\\'Ribbon.ListItem.New.NewListItem\\' Command=\\'NewItem\\' CommandValueId=\\'NewListItem\\' LabelText=\\'New Item\\' Description=\\'Create a New Item\\' Image32by32=\\'/_layouts/0/images/formatmap32x32.png\\' CommandType=\\'OptionSelection\\' Image32by32Top=\\'-160\\' Image32by32Left=\\'-384\\'/>\"\r\nmygridtest-grid-id._modifylist = false;\r\nmygridtest-grid-id._listperms = false;\r\nmygridtest-grid-id._shownewmenu = true;\r\nmygridtest-grid-id._allowedit = false;\r\nmygridtest-grid-id._listid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._webid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._listname = '';\r\nmygridtest-grid-id._viewid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._viewurl = 'http://fake.url/http://fake.url';\r\nmygridtest-grid-id._siteurl = '';\r\nmygridtest-grid-id._webrelurl = 'test-server-url';\r\nmygridtest-grid-id._viewname = 'dummy';\r\nmygridtest-grid-id._basetype = 'GenericList';\r\nmygridtest-grid-id._templatetype = '0';\r\nmygridtest-grid-id._newrow = false;\r\nmygridtest-grid-id._rolluplists = '';\r\nmygridtest-grid-id._brollups = false;\r\nmygridtest-grid-id._requestList = false;\r\nmygridtest-grid-id._usepopup = false;\r\nmygridtest-grid-id._lookupfield = 'true';\r\nmygridtest-grid-id._lookupfieldlist = 'true';\r\nmygridtest-grid-id._excell = 'test-server-url\\u002f_vti_bin\\u002fowssvr.dll?CS=65001\\u0026Using=_layouts\\u002fquery.iqy\\u0026List=\\u00257B00000000\\u00252D0000\\u00252D0000\\u00252D0000\\u00252D000000000000\\u00257D\\u0026View=\\u00257B00000000\\u00252D0000\\u00252D0000\\u00252D0000\\u00252D000000000000\\u00257D\\u0026RootFolder=http:\\u0026CacheControl=1';\r\nmygridtest-grid-id._gridid = 'test-grid-id';\r\nmygridtest-grid-id._formmenus = \"\";\r\nmygridtest-grid-id.setRowHidden = function(rowid){\n                                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                                            grid.HideRow(grid.GetRowById(rowid), true, false);\n                                                                            };\r\nmygridtest-grid-id.getTitles = function(){\n                                                                        var titles = \"\";\n                                                                        try{\n                                                                        var grid = Grids.GanttGridtest-grid-id;\n                                                                        var sRows = grid.GetSelRows();\n                                                                        var fRow = grid.FRow;\n\n                                                                        for(var sRow in sRows)\n                                                                        {\n                                                                            var row = sRows[sRow];\n                                                                            if(row.itemid != \"\" && row.id != \"indexOf\")\n                                                                            {\n                                                                                titles += \",\" + row.Title;\n                                                                            }\n                                                                        }\n\n                                                                        //if(fRow)\n                                                                        //    titles += \",\" + fRow.Title;\n\n                                                                        if(titles != \"\" && titles[0] == ',')\n                                                                            titles = titles.substring(1);\n                                                                        return titles;\n                                                                        }catch(e){}\n                                                                        };\r\nmygridtest-grid-id.getCheckedItems = function(){\n                                                \n                                 var ids = \"\";\n                                try{\n                                var grid = Grids.GanttGridtest-grid-id;\n\n                                var sRows = grid.GetSelRows();\n                                for(var sRow in sRows)\n                                {\n                                    var row = sRows[sRow];\n    \n                                    if(row.itemid != \"\" && row.id != \"indexOf\" && row.id != \"Header\")\n                                    {\n                                        ids += \",\" + row.itemid;\n                                    }\n                                }\n\n                                if(ids != \"\" && ids[0] == ',')\n                                    ids = ids.substring(1);\n                                return ids;\n                                }catch(e){return \"\";}\n                                };\r\nmygridtest-grid-id.getCheckedIds = function(){\n\n                                                                                    var ids = \"\";\n                                                                                    try{\n                                                                                    var grid = Grids.GanttGridtest-grid-id;\n\n                                                                                    var sRows = grid.GetSelRows();\n                                                                                    for(var sRow in sRows)\n                                                                                    {\n                                                                                        var row = sRows[sRow];\n    \n                                                                                        if(row.itemid != \"\" && row.id != \"indexOf\")\n                                                                                        {\n                                                                                            ids += \",\" + row.webid + \".\" + row.listid + \".\" + row.itemid;\n                                                                                        }\n                                                                                    }\n\n                                                                                    if(ids != \"\" && ids[0] == ',')\n                                                                                        ids = ids.substring(1);\n                                                                                    return ids;\n                                                                                    }catch(e){return \"\";}\n                                                                                    };\r\nmygridtest-grid-id.getCheckedRowIds = function()\n                                                        {\n                                                            try{\n                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                            return grid.FRow.id;\n                                                            }catch(e){}\n                                                        };\r\nmygridtest-grid-id.getSelectedRowId = function()\n                                                        {\n                                                            try{\n                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                            if(!grid.FRow)\n                                                            {\n                                                                var sRows = grid.GetSelRows();\n                                                                return sRows[0].id;\n                                                            }\n                                                            else\n                                                                return grid.FRow.id;\n                                                            }catch(e){}\n                                                        };\r\nmygridtest-grid-id.getUserData = function(rowid, key){  \n                                                                    try\n                                                                    {\n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    var row = grid.GetRowById(rowid);\n                                                                    return grid.GetValue(row, key);\n                                                                    }catch(e){}\n                                                                    };\r\nmygridtest-grid-id.getRowById = function(rowid){  \n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    return grid.GetRowById(rowid); \n                                                                    };\r\nmygridtest-grid-id.setRowHidden = function(row, hide){  \n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    if(hide)\n                                                                        grid.RemoveRow(row); \n                                                                    };\r\nmygridtest-grid-id.editStop = function(){  }\r\nfunction newItemtest-grid-id()\n                                    {\n                                                \n\t                                    var wurl = mygridtest-grid-id._newitemurl;\n\n                                        if(mygridtest-grid-id._newmenumode == '3')\n                                        {\n                                            newAppPopup(mygridtest-grid-id._defaultct);\n                                        }\n                                        else\n                                        {\n                                            if(wurl.indexOf('?') > 0)\n                                                wurl = wurl + '&GetLastID=true';\n                                            else\n                                                wurl = wurl + '?GetLastID=true';\n\n\t                                        if(false)\n\t                                        {\n\t\t                                        function NewItemCallback(dialogResult, returnValue)\n                                                {\n                                                    if(dialogResult){GridNewItem('test-grid-id',returnValue);}\n                                                }\n\n\t\t                                        var options = { url: wurl, width: 700, dialogReturnValueCallback:NewItemCallback };\n\n\t\t                                        SP.UI.ModalDialog.showModalDialog(options);\n\t                                        }\n\t                                        else\n\t                                        {\n\t\t                                        location.href = wurl;\n\t                                        }\n                                        }\n                                    }\r\n</script>\r\n<div id=\"dlgSavingtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Saving Items...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<div id=\"dlgRefreshtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Refreshing Data...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<div id=\"dlgErrortest-grid-id\" class=\"dialog\">\n    <table width=\"100%\" height=\"100%\" cellpadding=\"0\" cellspacing=\"3\">\n\t\t<tr>\n\t\t\t<td class=\"ms-sectionheader\"><H3 class=\"ms-standardheader\">Error: </h3></td>\n\t\t</tr>\n        <tr height=\"100%\">\n            <td align=\"left\"valign=\"top\">\n                <div id=\"dlgErrorTexttest-grid-id\" style=\"overflow: auto;height=90%;width=100%\" class=\"ms-descriptiontext\"></div><br>\n            </td>\n        </tr>\n        <tr>\n\t\t\t<td align=\"right\">\n\t\t\t\t<input type=\"button\" class=\"ms-input\" value=\"Close\" onClick=\"hm('dlgErrortest-grid-id');\">\n\t\t\t</td>\n\t\t</tr>\n    </table>\n</div>\n\n<div id=\"editItemtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\" height=\"100%\" id=\"tblEditItem\" cellpadding=\"0\" cellspacing=\"0\">\n        <tr height=\"100%\">\n            <td align=\"center\" bgcolor=\"FFFFFF\">\n                <div id=\"editItemLoadtest-grid-id\">\n                    <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/>\n                </div>\n                <iframe id=\"frmEditFrametest-grid-id\" width=\"100%\" height=\"100%\" frameborder=\"0\" src=\"http://fake.url/_layouts/epmlive/blank.gif\">\n                    \n                </iframe>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<div id=\"dlgPosting\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Posting Data...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<script>\n\nvar bPageSetuptest-grid-id;\nvar firstItemtest-grid-id;\nvar lastItemtest-grid-id;\nvar fItemHidetest-grid-id;\n\nfunction setupPagetest-grid-id(records, UseReporting, PageSize)\n{\n\n\tvar pages = Math.ceil(records / PageSize);\n\n\tvar prev = document.getElementById(\"PagePrevioustest-grid-id\");\n\tvar next = document.getElementById(\"PageNexttest-grid-id\");\n\tvar pagediv = document.getElementById(\"pagedivtest-grid-id\");\n\n\tif(UseReporting)\n\t{\n\t\tif(pages > 1)\n\t\t{\n\t\t\tif(!bPageSetuptest-grid-id)\n\t\t\t{\n\t\t\t\tbPageSetuptest-grid-id = true;\n\n\t\t\t\t$(\"#pagedivtest-grid-id\").paginate({\n\t\t\t\t\tcount \t\t: pages,\n\t\t\t\t\tstart \t\t: 1,\n\t\t\t\t\tdisplay     : 12,\n\t\t\t\t\tborder\t\t\t\t\t: true,\n\t\t\t\t\tborder_color\t\t\t: '#CCCCCC',\n\t\t\t\t\ttext_color  \t\t\t: '#666666',\n\t\t\t\t\tbackground_color    \t: '#DDDDDD',\t\n\t\t\t\t\tborder_hover_color\t\t: '#878787',\n\t\t\t\t\ttext_hover_color  \t\t: '#ffffff',\n\t\t\t\t\tbackground_hover_color\t: '#9B9B9B', \n\t\t\t\t\trotate      : false,\n\t\t\t\t\timages\t\t: false,\n\t\t\t\t\tmouse\t\t: 'press',\n\t\t\t\t\tonChange\t: ChangePagetest-grid-id\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpagediv.style.display = \"none\";\n\t\t}\n\t}\n\telse\n\t{\n\t\tpagediv.style.display = \"inline-block\";\n\n\t\tvar rec = records.split('|');\n\t\tfirstItemtest-grid-id = parseInt(rec[2]) * -1;\n\t\tlastItemtest-grid-id = rec[1];\n\n\t\tif(rec[0] == \"0\" || fItemHidetest-grid-id == firstItemtest-grid-id)\n\t\t{\n\n\t\t\tprev.style.background = \"#EFEFEF\";\n\n\t\t\tfItemHidetest-grid-id = firstItemtest-grid-id;\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tprev.style.background = \"#DDDDDD\";\n\t\t}\n\n\t\tif(rec[3] == \"true\")\n\t\t\tnext.style.background = \"#DDDDDD\";\n\t\telse\n\t\t{\n\t\t\tprev.style.background = \"#EFEFEF\";\n\t\t\tlastItemtest-grid-id = 0;\n\t\t}\n\n\t\tif(rec[3] != \"true\" && rec[0] == \"0\")\n\t\t{\n\t\t\tpagediv.style.display = \"none\";\n\t\t}\n\t}\n}\n</script><script>function maximizeWindow(){try{\r\nvar currentDialog = SP.UI.ModalDialog.get_childDialog();\r\nif(currentDialog != null){\r\nif(!currentDialog.$S_0){\r\ncurrentDialog.$z();\r\n}}}catch(e){}\r\n}\r\nExecuteOrDelayUntilScriptLoaded(maximizeWindow, 'sp.ui.dialog.js');\r\ninitmb();function clickTab(){\r\ntry{\r\nvar wp = document.getElementById('MSOZoneCell_WebPart');\r\nfireEvent(wp, 'mouseup');\r\nsetTimeout(\"clickbrowse()\",1000);\r\n}catch(e){}\r\n}\r\nfunction clickbrowse(){\r\ntry{\r\nvar wp2 = document.getElementById('Ribbon.Read-title').firstChild;\r\nfireEvent(wp2, 'click');\r\n}catch(e){}\r\n}\r\nfunction fireEvent(element,event){\n                                if (document.createEventObject){\n                                    // dispatch for IE\n                                    var evt = document.createEventObject();\n                                    return element.fireEvent('on'+event,evt)\n                                }\n                                else{\n                                    // dispatch for firefox + others\n                                    var evt = document.createEvent(\"HTMLEvents\");\n                                    evt.initEvent(event, true, true ); // event type,bubbling,cancelable\n                                    return !element.dispatchEvent(evt);\n                                }\n                            }\r\nsetTimeout(\"clickTab()\", 100);</script>"));
        }

        [TestMethod]
        public void RenderGantt_GivenArguments_GridViewSessionPageNotZero_EnableContentReportingFalse_OnlyGrid_ConfirmOutput()
        {
            // Arrange
            SetupShims();
            ShimSPView.AllInstances.RowLimitGet = (_) => 10;
            _testablePrivate.SetField("bHasSearchResults", false);
            _testablePrivate.SetField("OnlyGrid", true);
            ((GridGanttSettings)_testablePrivate.GetField("gSettings")).EnableContentReporting = false;
            ShimGridViewSession.AllInstances.PageGet = (_) => 1;

            // Act
            _testablePrivate.Invoke("renderGantt",
                new object[] { writer, web });

            // Assert
            _testablePrivate.ShouldSatisfyAllConditions(
                () => writeCount.ShouldBe(159),
                () => writerContent.ToString().Length.ShouldBe(26257),
                () => writerContent.ToString().ShouldBe("<script type=\"text/javascript\" src=\"_layouts/epmlive/modal/modal.js\"></script> <div id=\"leftUpperDiv\"><div id=\"searchloadtest-grid-id\" style=\"\">\r\n<div id=\"searchdivtest-grid-id\" style=\"\">\r\n<script language=\"javascript\">\r\nvar searchfieldstest-grid-id = {}\r\nfunction switchsearchtest-grid-id()\n            {\n                var searcher = document.getElementById('searchtest-grid-id');\n                var searchtext = document.getElementById('searchtexttest-grid-id');\n                var searchchoice = document.getElementById('searchchoicetest-grid-id');\n                var searchtypechoice = document.getElementById('searchtypetest-grid-id');\n                var searchfield = searcher.options[searcher.selectedIndex].value;\n                var sList = searchfieldstest-grid-id[searchfield];\n                if(sList) {\n                    searchtext.style.display='none';\n                    searchchoice.style.display='';\n                    searchchoice.options.length = 0;\n                    searchtypechoice.options[2].selected = true;\n                    searchtypechoice.disabled = true;\n                    for(var i=0; i < sList.length; i++) {\n                        var d = sList[i];\n                        searchchoice.options.add(new Option(d, d));\n                        if(d=='test-search-string') {\n                            searchchoice.options[searchchoice.options.length-1].selected = true;\n                        } \n                    } \n                } else {\n                    searchtext.style.display='';\n                    searchchoice.style.display='none';\n                    searchtypechoice.disabled = false;\n                }\n            }\r\nfunction unSearchtest-grid-id(){\r\n                var unsearch = document.getElementById('unsearchtest-grid-id');\r\n                unsearch.style.display=\"none\";\r\n                var searchtext = document.getElementById('searchtexttest-grid-id');\r\n                searchtext.value = '';\r\n                GridUnSearch('test-grid-id');\r\n            }\r\nfunction doSearchtest-grid-id(){\r\n                var searcher = document.getElementById('searchtest-grid-id');\r\n                var unsearch = document.getElementById('unsearchtest-grid-id');\r\n                unsearch.style.display=\"table-cell\";\r\n                var searchchoice = document.getElementById('searchchoicetest-grid-id');\r\n                var searchtext = document.getElementById('searchtexttest-grid-id');\r\n                var searchtypechoice = document.getElementById('searchtypetest-grid-id');\r\n                var searchfield = searcher.options[searcher.selectedIndex].value;\r\n                var searchtype = searchtypechoice.options[searchtypechoice.selectedIndex].value;\r\n                var sList = searchfieldstest-grid-id[searchfield];\r\n                var searchvalue = \"\";\r\n                if(sList){\r\n                    searchvalue = searchchoice.options[searchchoice.selectedIndex].value;\r\n                } else { \r\n                    searchvalue = searchtext.value;\r\n                }\r\n                \r\n                GridSearch('test-grid-id', searcher.options[searcher.selectedIndex].value, searchvalue, searchtype);\r\n                \r\n            }\r\nfunction enablesearchertest-grid-id(){\r\n            }\r\nfunction searchKeyPresstest-grid-id(e){\r\n                if(e.keyCode == 13) { \r\n                    doSearchtest-grid-id();\r\n                }\r\n                return false;\r\n            }\r\n</script>\r\n<div id=\"search\" style=\"width:100%; height:40px;\" class=\"ms-listviewtable\"><table><tr><td style=\"color: #A3A3A3; font-family: 'Open Sans', Helvetica, Arial, sans-serif; font-size: 14px;\">\r\nSearch: <select id=\"searchtest-grid-id\" onChange=\"switchsearchtest-grid-id();\" class=\"form-control\">\r\n                \r\n            </select>&nbsp;&nbsp;<select id=\"searchtypetest-grid-id\" class=\"form-control\">\r\n                <option value=\"1\" selected>Contains</option>\r\n                <option value=\"8\" >Begins With</option>\r\n                <option value=\"2\" >Equals</option>\r\n                <option value=\"3\" >Does Not Equal</option>\r\n                <option value=\"4\" >Greater Than</option>\r\n                <option value=\"5\" >Greater Than or Equal</option>\r\n                <option value=\"6\" >Less Than</option>\r\n                <option value=\"7\" >Less Than or Equal</option>\r\n            </select>\r\n&nbsp;&nbsp;</td><td>\r\n<div style=\"border: 1px solid #CCC;width: 200px;height: 30px;\">\n                <div id=\"unsearchtest-grid-id\" class=\"\" style=\"padding-left:4px;display: table-cell;min-width: 12px;align:top\">\n                    <img alt=\"Clear Search\" src=\"/_layouts/epmlive/images/unsearch.png\" style=\"padding-bottom:2px\" onclick=\"unSearchtest-grid-id()\"/>\n                </div>\n                <div style=\"display: table-cell\">\n                    <input type=\"text\" id=\"searchtexttest-grid-id\" value=\"test-search-string\" style=\"border: 0px; width:100%; margin-top:-5px; height:24px; font-family: 'Segoe UI','Segoe',Tahoma,Helvetica,Arial,sans-serif;font-size:13px\" onkeypress=\"searchKeyPresstest-grid-id(event);\"/>\n                    <select id=\"searchchoicetest-grid-id\" style=\"border: 0px; width:100%\">\n                    </select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                </div>\n                <div class=\"\" style=\"padding-right:2px; padding-left:10px;padding-top:5px;display: table-cell;min-width: 10px;cursor:pointer\">\n                    <img onclick=\"doSearchtest-grid-id()\" src=\"/_layouts/epmlive/images/find_icon.png\"/>\n                </div>\n            </div>\r\n</td></tr></table>\r\n</div>\r\n<script language=\"javascript\">switchsearchtest-grid-id();</script>\r\n</div>\r\n</div>\r\n</div><div id=\"rightUpperDiv\" ><table id=pagetabletest-grid-id><tr><td><div id=\"pagedivtest-grid-id\" style=\"display:none;margin:5px 0 5px 0;\"><div id=\"PagePrevioustest-grid-id\" style=\"height:18px;width:70px;border:1px solid #CACACA;float:left;padding-left:5px;background-color:#EFEFEF\" onClick=\"javascript:PreviousPagetest-grid-id()\"><a href=\"javascript:void(0);\" style=\"text-decoration:none;color:#666\">&lt; Previous</a></div> <div id=\"PageNexttest-grid-id\" style=\"height:18px;width:70px;border:1px solid #CACACA;float:left;margin-left:10px;padding-right:5px;text-align:right;background-color:#EFEFEF\" onClick=\"javascript:NextPagetest-grid-id()\"><a style=\"text-decoration:none;color:#666\" href=\"javascript:void(0);\">Next &gt;</a></div></div></td></tr></table></div><div  width=\"100%\" id=\"loadinggridtest-grid-id\" align=\"center\"></div><div style=\"height: 100px;overflow:hidden;\" id=\"gridoutertest-grid-id\"><div id=\"griddivtest-grid-id\" style=\"width:100%;height:100%\">\r\n</div>\r\n</div><script language=\"javascript\">\r\nepmdebug=false\r\nfunction LoadGridtest-grid-id(){ LoadGrid('test-grid-id');}\r\nSP.SOD.executeOrDelayUntilScriptLoaded(loadMenutest-grid-id, 'EPMLive.js');\r\nfunction NextPagetest-grid-id(){\r\nif(mygridtest-grid-id.PAGElastItem != 0){\r\nGrids[\"GanttGridtest-grid-id\"].Data.Data.Url = DataUrltest-grid-id + '&Page=' + mygridtest-grid-id.PAGElastItem;\r\nGrids[\"GanttGridtest-grid-id\"].Reload();\r\n}}\r\nfunction PreviousPagetest-grid-id(){\r\nif(mygridtest-grid-id.PAGEfItemHide != mygridtest-grid-id.PAGEfirstItem){\r\nGrids[\"GanttGridtest-grid-id\"].Data.Data.Url = DataUrltest-grid-id + '&Page=' + mygridtest-grid-id.PAGEfirstItem;\r\nGrids[\"GanttGridtest-grid-id\"].Reload();\r\n}}\r\nTGSetEvent(\"OnReady\", \"GanttGridtest-grid-id\", GridOnReady);\r\nTGSetEvent(\"OnLoaded\", \"GanttGridtest-grid-id\", GridOnLoaded);\r\nDataUrltest-grid-id = 'http://fake.url/_layouts/epmlive/getganttitems.aspx?data='\r\nOnlyGrid = true;\r\nArrGantts.push('GanttGridtest-grid-id');\r\nmygridtest-grid-id = new Object();\r\nmygridtest-grid-id.RibbonBehavior='';\r\nmygridtest-grid-id.GridHeight=400;\r\nmygridtest-grid-id.GanttStart='';\r\nmygridtest-grid-id.DecimalSeparator='.';\r\nmygridtest-grid-id.GroupSeparator=',';\r\nmygridtest-grid-id.Searcher='';\r\nmygridtest-grid-id.Qualifier='';\r\nmygridtest-grid-id.ForceSearch=true;\r\nmygridtest-grid-id.loaded = false\r\nmygridtest-grid-id.CurPage = 1;\r\nmygridtest-grid-id.Cols = ''\r\nmygridtest-grid-id.LinkType = ''\r\nvar myDataProcessortest-grid-id = new Object();\r\nmygridtest-grid-id.Params = \"\";\r\nmygridtest-grid-id.PageSize = '10';\r\nmygridtest-grid-id.UseReporting = false;\r\ncurPagetest-grid-id = 0;\r\nmygridtest-grid-id._epkview = '';\r\nmygridtest-grid-id._useparent = false;\r\nmygridtest-grid-id._curPlanner = '';\r\nmygridtest-grid-id._epkurl = '';\r\nmygridtest-grid-id._epkcostview = '';\r\nmygridtest-grid-id.canribbon = true;\r\nmygridtest-grid-id.addFocusedCommands = function($arr){\r\nreturn $arr;}\r\nmygridtest-grid-id.getGlobalCommands = function($arr){return $arr;}\r\nmygridtest-grid-id.canHandleCommand = function($Grid, commandId){\r\nreturn false;}\r\nmygridtest-grid-id.handleCommand = function($Grid, commandId, properites){if(typeof(properties) != 'undefined')return properties;}\r\nmygridtest-grid-id._webpartid = '';\r\nmygridtest-grid-id._outlookexport = '';\r\nmygridtest-grid-id._gridMode = '';\r\nmygridtest-grid-id._hasTemplateList = false;\r\nmygridtest-grid-id._newmenumode = 0;\r\nmygridtest-grid-id._newitemurl = 'test-server-url';\r\nmygridtest-grid-id._newfolder = false;\r\nmygridtest-grid-id._newmenu = \"<Button Id=\\'Ribbon.ListItem.New.NewListItem\\' Command=\\'NewItem\\' CommandValueId=\\'NewListItem\\' LabelText=\\'New Item\\' Description=\\'Create a New Item\\' Image32by32=\\'/_layouts/0/images/formatmap32x32.png\\' CommandType=\\'OptionSelection\\' Image32by32Top=\\'-160\\' Image32by32Left=\\'-384\\'/>\"\r\nmygridtest-grid-id._modifylist = false;\r\nmygridtest-grid-id._listperms = false;\r\nmygridtest-grid-id._shownewmenu = true;\r\nmygridtest-grid-id._allowedit = false;\r\nmygridtest-grid-id._listid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._webid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._listname = '';\r\nmygridtest-grid-id._viewid = '00000000-0000-0000-0000-000000000000';\r\nmygridtest-grid-id._viewurl = 'http://fake.url/http://fake.url';\r\nmygridtest-grid-id._siteurl = '';\r\nmygridtest-grid-id._webrelurl = 'test-server-url';\r\nmygridtest-grid-id._viewname = 'dummy';\r\nmygridtest-grid-id._basetype = 'GenericList';\r\nmygridtest-grid-id._templatetype = '0';\r\nmygridtest-grid-id._newrow = false;\r\nmygridtest-grid-id._rolluplists = '';\r\nmygridtest-grid-id._brollups = false;\r\nmygridtest-grid-id._requestList = false;\r\nmygridtest-grid-id._usepopup = false;\r\nmygridtest-grid-id._lookupfield = '';\r\nmygridtest-grid-id._lookupfieldlist = '';\r\nmygridtest-grid-id._excell = 'test-server-url\\u002f_vti_bin\\u002fowssvr.dll?CS=65001\\u0026Using=_layouts\\u002fquery.iqy\\u0026List=\\u00257B00000000\\u00252D0000\\u00252D0000\\u00252D0000\\u00252D000000000000\\u00257D\\u0026View=\\u00257B00000000\\u00252D0000\\u00252D0000\\u00252D0000\\u00252D000000000000\\u00257D\\u0026RootFolder=http:\\u0026CacheControl=1';\r\nmygridtest-grid-id._gridid = 'test-grid-id';\r\nmygridtest-grid-id._formmenus = \"\";\r\nmygridtest-grid-id.setRowHidden = function(rowid){\n                                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                                            grid.HideRow(grid.GetRowById(rowid), true, false);\n                                                                            };\r\nmygridtest-grid-id.getTitles = function(){\n                                                                        var titles = \"\";\n                                                                        try{\n                                                                        var grid = Grids.GanttGridtest-grid-id;\n                                                                        var sRows = grid.GetSelRows();\n                                                                        var fRow = grid.FRow;\n\n                                                                        for(var sRow in sRows)\n                                                                        {\n                                                                            var row = sRows[sRow];\n                                                                            if(row.itemid != \"\" && row.id != \"indexOf\")\n                                                                            {\n                                                                                titles += \",\" + row.Title;\n                                                                            }\n                                                                        }\n\n                                                                        //if(fRow)\n                                                                        //    titles += \",\" + fRow.Title;\n\n                                                                        if(titles != \"\" && titles[0] == ',')\n                                                                            titles = titles.substring(1);\n                                                                        return titles;\n                                                                        }catch(e){}\n                                                                        };\r\nmygridtest-grid-id.getCheckedItems = function(){\n                                                \n                                 var ids = \"\";\n                                try{\n                                var grid = Grids.GanttGridtest-grid-id;\n\n                                var sRows = grid.GetSelRows();\n                                for(var sRow in sRows)\n                                {\n                                    var row = sRows[sRow];\n    \n                                    if(row.itemid != \"\" && row.id != \"indexOf\" && row.id != \"Header\")\n                                    {\n                                        ids += \",\" + row.itemid;\n                                    }\n                                }\n\n                                if(ids != \"\" && ids[0] == ',')\n                                    ids = ids.substring(1);\n                                return ids;\n                                }catch(e){return \"\";}\n                                };\r\nmygridtest-grid-id.getCheckedIds = function(){\n\n                                                                                    var ids = \"\";\n                                                                                    try{\n                                                                                    var grid = Grids.GanttGridtest-grid-id;\n\n                                                                                    var sRows = grid.GetSelRows();\n                                                                                    for(var sRow in sRows)\n                                                                                    {\n                                                                                        var row = sRows[sRow];\n    \n                                                                                        if(row.itemid != \"\" && row.id != \"indexOf\")\n                                                                                        {\n                                                                                            ids += \",\" + row.webid + \".\" + row.listid + \".\" + row.itemid;\n                                                                                        }\n                                                                                    }\n\n                                                                                    if(ids != \"\" && ids[0] == ',')\n                                                                                        ids = ids.substring(1);\n                                                                                    return ids;\n                                                                                    }catch(e){return \"\";}\n                                                                                    };\r\nmygridtest-grid-id.getCheckedRowIds = function()\n                                                        {\n                                                            try{\n                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                            return grid.FRow.id;\n                                                            }catch(e){}\n                                                        };\r\nmygridtest-grid-id.getSelectedRowId = function()\n                                                        {\n                                                            try{\n                                                            var grid = Grids.GanttGridtest-grid-id;\n                                                            if(!grid.FRow)\n                                                            {\n                                                                var sRows = grid.GetSelRows();\n                                                                return sRows[0].id;\n                                                            }\n                                                            else\n                                                                return grid.FRow.id;\n                                                            }catch(e){}\n                                                        };\r\nmygridtest-grid-id.getUserData = function(rowid, key){  \n                                                                    try\n                                                                    {\n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    var row = grid.GetRowById(rowid);\n                                                                    return grid.GetValue(row, key);\n                                                                    }catch(e){}\n                                                                    };\r\nmygridtest-grid-id.getRowById = function(rowid){  \n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    return grid.GetRowById(rowid); \n                                                                    };\r\nmygridtest-grid-id.setRowHidden = function(row, hide){  \n                                                                    var grid = Grids.GanttGridtest-grid-id;\n                                                                    if(hide)\n                                                                        grid.RemoveRow(row); \n                                                                    };\r\nmygridtest-grid-id.editStop = function(){  }\r\nfunction newItemtest-grid-id()\n                                    {\n                                                \n\t                                    var wurl = mygridtest-grid-id._newitemurl;\n\n                                        if(mygridtest-grid-id._newmenumode == '3')\n                                        {\n                                            newAppPopup(mygridtest-grid-id._defaultct);\n                                        }\n                                        else\n                                        {\n                                            if(wurl.indexOf('?') > 0)\n                                                wurl = wurl + '&GetLastID=true';\n                                            else\n                                                wurl = wurl + '?GetLastID=true';\n\n\t                                        if(false)\n\t                                        {\n\t\t                                        function NewItemCallback(dialogResult, returnValue)\n                                                {\n                                                    if(dialogResult){GridNewItem('test-grid-id',returnValue);}\n                                                }\n\n\t\t                                        var options = { url: wurl, width: 700, dialogReturnValueCallback:NewItemCallback };\n\n\t\t                                        SP.UI.ModalDialog.showModalDialog(options);\n\t                                        }\n\t                                        else\n\t                                        {\n\t\t                                        location.href = wurl;\n\t                                        }\n                                        }\n                                    }\r\n</script>\r\n<div id=\"dlgSavingtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Saving Items...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<div id=\"dlgRefreshtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Refreshing Data...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<div id=\"dlgErrortest-grid-id\" class=\"dialog\">\n    <table width=\"100%\" height=\"100%\" cellpadding=\"0\" cellspacing=\"3\">\n\t\t<tr>\n\t\t\t<td class=\"ms-sectionheader\"><H3 class=\"ms-standardheader\">Error: </h3></td>\n\t\t</tr>\n        <tr height=\"100%\">\n            <td align=\"left\"valign=\"top\">\n                <div id=\"dlgErrorTexttest-grid-id\" style=\"overflow: auto;height=90%;width=100%\" class=\"ms-descriptiontext\"></div><br>\n            </td>\n        </tr>\n        <tr>\n\t\t\t<td align=\"right\">\n\t\t\t\t<input type=\"button\" class=\"ms-input\" value=\"Close\" onClick=\"hm('dlgErrortest-grid-id');\">\n\t\t\t</td>\n\t\t</tr>\n    </table>\n</div>\n\n<div id=\"editItemtest-grid-id\" class=\"dialog\">\n    <table width=\"100%\" height=\"100%\" id=\"tblEditItem\" cellpadding=\"0\" cellspacing=\"0\">\n        <tr height=\"100%\">\n            <td align=\"center\" bgcolor=\"FFFFFF\">\n                <div id=\"editItemLoadtest-grid-id\">\n                    <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/>\n                </div>\n                <iframe id=\"frmEditFrametest-grid-id\" width=\"100%\" height=\"100%\" frameborder=\"0\" src=\"http://fake.url/_layouts/epmlive/blank.gif\">\n                    \n                </iframe>\n            </td>\n        </tr>\n    </table>\n</div>\n\n<div id=\"dlgPosting\" class=\"dialog\">\n    <table width=\"100%\">\n        <tr>\n            <td align=\"center\" class=\"ms-sectionheader\">\n                <img src=\"_layouts/images/gears_anv4.gif\" style=\"vertical-align: middle;\"/><br />\n                <H3 class=\"ms-standardheader\">Posting Data...</h3>\n            </td>\n        </tr>\n    </table>\n</div> \n\n<script>\n\nvar bPageSetuptest-grid-id;\nvar firstItemtest-grid-id;\nvar lastItemtest-grid-id;\nvar fItemHidetest-grid-id;\n\nfunction setupPagetest-grid-id(records, UseReporting, PageSize)\n{\n\n\tvar pages = Math.ceil(records / PageSize);\n\n\tvar prev = document.getElementById(\"PagePrevioustest-grid-id\");\n\tvar next = document.getElementById(\"PageNexttest-grid-id\");\n\tvar pagediv = document.getElementById(\"pagedivtest-grid-id\");\n\n\tif(UseReporting)\n\t{\n\t\tif(pages > 1)\n\t\t{\n\t\t\tif(!bPageSetuptest-grid-id)\n\t\t\t{\n\t\t\t\tbPageSetuptest-grid-id = true;\n\n\t\t\t\t$(\"#pagedivtest-grid-id\").paginate({\n\t\t\t\t\tcount \t\t: pages,\n\t\t\t\t\tstart \t\t: 1,\n\t\t\t\t\tdisplay     : 12,\n\t\t\t\t\tborder\t\t\t\t\t: true,\n\t\t\t\t\tborder_color\t\t\t: '#CCCCCC',\n\t\t\t\t\ttext_color  \t\t\t: '#666666',\n\t\t\t\t\tbackground_color    \t: '#DDDDDD',\t\n\t\t\t\t\tborder_hover_color\t\t: '#878787',\n\t\t\t\t\ttext_hover_color  \t\t: '#ffffff',\n\t\t\t\t\tbackground_hover_color\t: '#9B9B9B', \n\t\t\t\t\trotate      : false,\n\t\t\t\t\timages\t\t: false,\n\t\t\t\t\tmouse\t\t: 'press',\n\t\t\t\t\tonChange\t: ChangePagetest-grid-id\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpagediv.style.display = \"none\";\n\t\t}\n\t}\n\telse\n\t{\n\t\tpagediv.style.display = \"inline-block\";\n\n\t\tvar rec = records.split('|');\n\t\tfirstItemtest-grid-id = parseInt(rec[2]) * -1;\n\t\tlastItemtest-grid-id = rec[1];\n\n\t\tif(rec[0] == \"0\" || fItemHidetest-grid-id == firstItemtest-grid-id)\n\t\t{\n\n\t\t\tprev.style.background = \"#EFEFEF\";\n\n\t\t\tfItemHidetest-grid-id = firstItemtest-grid-id;\n\n\t\t}\n\t\telse\n\t\t{\n\t\t\tprev.style.background = \"#DDDDDD\";\n\t\t}\n\n\t\tif(rec[3] == \"true\")\n\t\t\tnext.style.background = \"#DDDDDD\";\n\t\telse\n\t\t{\n\t\t\tprev.style.background = \"#EFEFEF\";\n\t\t\tlastItemtest-grid-id = 0;\n\t\t}\n\n\t\tif(rec[3] != \"true\" && rec[0] == \"0\")\n\t\t{\n\t\t\tpagediv.style.display = \"none\";\n\t\t}\n\t}\n}\n</script><script>function maximizeWindow(){try{\r\nvar currentDialog = SP.UI.ModalDialog.get_childDialog();\r\nif(currentDialog != null){\r\nif(!currentDialog.$S_0){\r\ncurrentDialog.$z();\r\n}}}catch(e){}\r\n}\r\nExecuteOrDelayUntilScriptLoaded(maximizeWindow, 'sp.ui.dialog.js');\r\ninitmb();function clickTab(){\r\ntry{\r\nvar wp = document.getElementById('MSOZoneCell_WebPart');\r\nfireEvent(wp, 'mouseup');\r\nsetTimeout(\"clickbrowse()\",1000);\r\n}catch(e){}\r\n}\r\nfunction clickbrowse(){\r\ntry{\r\nvar wp2 = document.getElementById('Ribbon.Read-title').firstChild;\r\nfireEvent(wp2, 'click');\r\n}catch(e){}\r\n}\r\nfunction fireEvent(element,event){\n                                if (document.createEventObject){\n                                    // dispatch for IE\n                                    var evt = document.createEventObject();\n                                    return element.fireEvent('on'+event,evt)\n                                }\n                                else{\n                                    // dispatch for firefox + others\n                                    var evt = document.createEvent(\"HTMLEvents\");\n                                    evt.initEvent(event, true, true ); // event type,bubbling,cancelable\n                                    return !element.dispatchEvent(evt);\n                                }\n                            }\r\nsetTimeout(\"clickTab()\", 100);</script><style>\n                                #MSOZoneCell_WebPartWPQ2{display:none !important;}\n                                .ms-webpartzone-cell {margin: auto !important}\n                                </style>\r\n"));
        }
    }
}
