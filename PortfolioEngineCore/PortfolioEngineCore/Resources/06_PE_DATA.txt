If NOT Exists (Select * From EPG_COST_CATEGORY_RATE_VALUES)
Begin
   Declare @RPCalendar int
   Select @RPCalendar=ADM_PORT_COMMITMENTS_CB_ID From EPG_ADMIN
   if (@RPCalendar=0 or @RPCalendar is NULL) set @RPCalendar=1
   
	Delete From EPG_COST_CATEGORY_RATE_VALUES
	Insert Into EPG_COST_CATEGORY_RATE_VALUES (BC_UID,BC_EFFECTIVE_DATE,BC_RATE)
	Select BA_BC_UID,p.PRD_START_DATE,BA_RATE From EPGP_COST_BREAKDOWN_ATTRIBS a
	 Join EPG_PERIODS p On p.PRD_ID=a.BA_PRD_ID and p.CB_ID=@RPCalendar
	 Join EPGP_COST_CATEGORIES c On c.BC_UID=a.BA_BC_UID
	Where a.CB_ID=@RPCalendar and BA_RATETYPE_UID = 0 and BA_RATE>0 and c.MC_UID=0 Order by BA_BC_UID,BA_PRD_ID

	-- Need to set Effective Date for first entry for each BC_UID to NULL as it is the Base Rate
	Declare @BCUID int, @prevBCUID int, @EffectiveDate Datetime
	Declare rcursor CURSOR 
	Forward_Only
	For
	Select BC_UID,BC_EFFECTIVE_DATE From EPG_COST_CATEGORY_RATE_VALUES Order by BC_UID,BC_EFFECTIVE_DATE
	Open rcursor
	Fetch Next From rcursor
	  Into @BCUID,@EffectiveDate
	  Update EPG_COST_CATEGORY_RATE_VALUES Set BC_EFFECTIVE_DATE=NULL Where BC_UID=@BCUID and BC_EFFECTIVE_DATE=@EffectiveDate
		   Set @prevBCUID=@BCUID
	While @@FETCH_STATUS=0
	  Begin
		 Fetch Next From rcursor
		 Into @BCUID,@EffectiveDate
		 If @@FETCH_STATUS=0 And (@prevBCUID<>@BCUID)
		 Begin
			Update EPG_COST_CATEGORY_RATE_VALUES Set BC_EFFECTIVE_DATE=NULL Where BC_UID=@BCUID and BC_EFFECTIVE_DATE=@EffectiveDate
		 End
		 Set @prevBCUID=@BCUID
	  End
	Close rcursor 
	Deallocate rcursor
End



delete from EPG_PERMISSIONS;

insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (99999999,1000,1,'Admin',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3009,1001,2,'A01 Base and Timesheet SysAdmin',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3008,1002,2,'A02 Timesheet App Admin',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3025,1003,2,'A03 Portfolio, Resource, and Capacity SysAdmin',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3002,1004,2,'A04 Manage Status Date and Personal Items',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3042,1005,2,'A05 PMO App Admin',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3003,1006,2,'A06 DBA Utilities',null,1);

insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (99999999,2000,1,'Base',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3001,2001,2,'B01 Delegates and Personal Planner',null,1);

insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (99999999,3000,1,'Portfolio and Projects',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3010,3001,2,'P01 View Portfolio',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3011,3002,2,'P02 View Portfolio Item Details',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3012,3003,2,'P03 Edit Portfolio Item',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3013,3004,2,'P04 Create Portfolio Item',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3014,3005,2,'P05 Edit Cost - requires P03',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3015,3006,2,'P06 Edit Stage - requires P03',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3016,3007,2,'P07 Manage SharePoint Site',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3018,3009,2,'P09 Work Items - requires P03',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3019,3010,2,'P10 Edit Security - requires P03',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3020,3011,2,'P11 Close Portfolio Item - requires P03',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3021,3012,2,'P12 Model Cost Values against Targets',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3022,3013,2,'P13 Cost Type Analyzer',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3023,3014,2,'P14 Optimizer',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3024,3015,2,'P22 View/Upload Project Schedules',null,0);

insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (99999999,4000,1,'Resources',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3028,4001,2,'R01 Resource Center',null,1);

insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (99999999,5000,1,'Capacity/Demand',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3027,5001,2,'C01 View Resource Plans',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3026,5002,2,'C02 Edit Resource Plan',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3040,5003,2,'C03 Edit Res Plans for All Portfolio Items',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3041,5004,2,'C04 Edit Res Plans for All Departments',null,1);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3043,5006,2,'C05 Resource Plans Analyzer',null,1);

insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (99999999,7000,1,'Timesheets',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3004,7002,2,'T01 Timesheet',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3006,7004,2,'T02 Department Timesheet Approval - requires T01',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3007,7005,2,'T03 Project Timesheet Approval - requires T01',null,0);

insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (99999999,9000,1,'User Defined',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3029,9001,2,'U01 User Button 1',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3030,9002,2,'U02 User Button 2',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3031,9003,2,'U03 User Button 3',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3032,9004,2,'U04 User Button 4',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3033,9005,2,'U05 User Button 5',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3034,9006,2,'U06 User Button 6',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3035,9007,2,'U07 User Button 7',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3036,9008,2,'U08 User Button 8',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3037,9009,2,'U09 User Button 9',null,0);
insert into EPG_PERMISSIONS (PERM_UID,PERM_ID,PERM_LEVEL,PERM_NAME,PERM_NOTES,PERM_WEINCLUDE) values (3038,9010,2,'U010 User Button 10',null,0);

if exists (select * from EPG_GROUP_PERMISSIONS where PERM_UID=3021)
begin

  Delete From EPG_GROUP_PERMISSIONS Where PERM_UID=3023;
  Insert Into EPG_GROUP_PERMISSIONS (GROUP_ID,PERM_UID)
       Select GROUP_ID, 3023 From EPG_GROUP_PERMISSIONS Where PERM_UID=3021;

end